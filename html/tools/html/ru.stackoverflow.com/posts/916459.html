<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>&#1053;&#1077;&#1103;&#1089;&#1085;&#1086;&#1077; &#1087;&#1086;&#1074;&#1077;&#1076;&#1077;&#1085;&#1080;&#1077; &#1072;&#1090;&#1088;&#1080;&#1073;&#1091;&#1090;&#1072; OptionalAttribute | RuSO Archive </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="&#1053;&#1077;&#1103;&#1089;&#1085;&#1086;&#1077; &#1087;&#1086;&#1074;&#1077;&#1076;&#1077;&#1085;&#1080;&#1077; &#1072;&#1090;&#1088;&#1080;&#1073;&#1091;&#1090;&#1072; OptionalAttribute | RuSO Archive ">
    <meta name="generator" content="docfx 2.40.12.0">
    
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" class="svg" src="../../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">

<p><i><a href="https://github.com/MSDN-WhiteKnight/ruso-archive/">RuSO Archive</a></i></p>
<h1>Неясное поведение атрибута OptionalAttribute</h1>
<p><a href="https://ru.stackoverflow.com/questions/916459/%d0%9d%d0%b5%d1%8f%d1%81%d0%bd%d0%be%d0%b5-%d0%bf%d0%be%d0%b2%d0%b5%d0%b4%d0%b5%d0%bd%d0%b8%d0%b5-%d0%b0%d1%82%d1%80%d0%b8%d0%b1%d1%83%d1%82%d0%b0-optionalattribute">Source</a> - by <a href="https://ru.stackoverflow.com/users/206435/%e3%83%92%e3%83%9f%e3%82%b3">ヒミコ</a></p>
<blockquote>
<p>Для начала приведу простой пример кода:</p>
<pre><code>int CopyFromBitmap
(
#if UNI
    [In, Optional] Point2U *destPoint,
    [In, MarshalAs(UnmanagedType.IUnknown)] object bitmapObject,
    [In, Optional] RectU *srcRect
#else
    [In, Optional] ref Point2U destPoint,
    [In, MarshalAs(UnmanagedType.IUnknown)] object bitmapObject,
    [In, Optional] ref RectU srcRect
#endif
);
</code></pre>
<p>Каким образом необязательный параметр, идет перед обязательным но, при этом ничего не сообщается, ни ошибок, ни предупреждений.</p>
<p>Выходной код выглядит так:</p>
<p><a href="https://i.stack.imgur.com/aCYCy.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/aCYCy.png" alt="Странное определение"></a></p>
<p>Как такое вообще возможно?</p>
</blockquote>
<h2>Answer 916655</h2>
<p><a href="https://ru.stackoverflow.com/a/916655/">Source</a> - by <a href="https://ru.stackoverflow.com/users/240512/msdn-whiteknight">MSDN.WhiteKnight</a></p>
<blockquote>
<p>Магия. В .NET есть два способа задания необязательных параметров:</p>
<ol>
<li><p>Указывая значение по умолчанию средствами языка, например в C# <code>void Test(int x, int y, int z=0)</code>. При этом способе все необязательные параметры должны быть указаны в конце списка аргументов, это проверяется при компиляции метода.</p></li>
<li><p>Способ с [Optional], который можно применять в любых языках, даже если они не поддерживают синтаксис значения по умолчанию. Значение по умолчанию будет Type.Missing. При данном способе можно указать необязательные аргументы до обязательных. Однако, пропустить эти аргументы можно будет только при использовании именованных аргументов (проверка осуществляется при компиляции вызова метода):</p></li>
</ol>
<p>
<pre><code>void Test([Optional] int x, int y, [Optional]int z)
{
     Console.WriteLine("{0} {1} {2}", x, y, z);
} 

Test(2);   // =&gt; CS7036 Отсутствует аргумент, соответствующий требуемому формальному параметру "y"
Test(y:2); // =&gt; 0 2 0
</code></pre>
<p>Ничего специфичного для COM Interop на этот раз вроде нет.</p>
</blockquote>
<hr>
<p><i>Content is retrieved from StackExchange API. </i></p>
<p><i>Auto-generated by ruso-archive tools. </i></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>RuSO Archive (published from sources in <a href="https://github.com/MSDN-WhiteKnight/ruso-archive">GitHub repository</a>). Content licensed under <a href="https://github.com/MSDN-WhiteKnight/ruso-archive/blob/master/LICENSE">CC-BY-SA 4.0</a>.<br>Generated by <strong>DocFX</strong></span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
