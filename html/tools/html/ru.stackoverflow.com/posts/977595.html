<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>&#1040;&#1085;&#1072;&#1083;&#1086;&#1075; frexp (&#1080;&#1079; &#1057;++ math.h) &#1074; &#1057;# | RuSO Archive </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="&#1040;&#1085;&#1072;&#1083;&#1086;&#1075; frexp (&#1080;&#1079; &#1057;++ math.h) &#1074; &#1057;# | RuSO Archive ">
    <meta name="generator" content="docfx 2.40.12.0">
    
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" class="svg" src="../../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">

<p><i><a href="https://github.com/MSDN-WhiteKnight/ruso-archive/">RuSO Archive</a></i></p>
<h1>Аналог frexp (из С++ math.h) в С#</h1>
<p><a href="https://ru.stackoverflow.com/questions/977595/%d0%90%d0%bd%d0%b0%d0%bb%d0%be%d0%b3-frexp-%d0%b8%d0%b7-%d0%a1-math-h-%d0%b2-%d0%a1">Source</a> - by <a href="https://ru.stackoverflow.com/users/285080/cyberhatter">CyberHatter</a></p>
<blockquote>
<p>Пытаюсь перенести проект с C++ на C#, однако в System.Math C# отсутствует функция разложения на экспоненту и мантиссу (frexp в C++). Существует ли полный аналог в этом языке?</p>
<p>Здесь нашёл написанный вручную метод разложения, только мантисса получается типа long и метод возвращает string:
<a href="https://stackoverflow.com/questions/389993/extracting-mantissa-and-exponent-from-double-in-c-sharp">https://stackoverflow.com/questions/389993/extracting-mantissa-and-exponent-from-double-in-c-sharp</a> - в итоге, например, n=10.0 frexp разложит на 0.625*2^4, а эта функция на 5*2^1.</p>
</blockquote>
<h2>Answer 977604</h2>
<p><a href="https://ru.stackoverflow.com/a/977604/">Source</a> - by <a href="https://ru.stackoverflow.com/users/9784/zergatul">Zergatul</a></p>
<blockquote>
<p>Аналогов нет, так что придется писать самим. Я взял за основу код с ответа, на который вы сослались, и немного доделал его. Там мантисса получается типа лонг потому что внутри бинарного представления там действительно целое чисто стоит на месте мантиссы. В моем коде я дополнительно уменьшаю мантиссу, что бы получить результат согласно спецификации функции <code>frexp</code>:</p>
<pre><code>static void frexp(double value, out double mantissa, out int exponent)
{
    long bits = BitConverter.DoubleToInt64Bits(value);
    bool negative = (bits &amp; (1L &lt;&lt; 63)) != 0;
    exponent = (int)((bits &gt;&gt; 52) &amp; 0x7FFL);
    long mantissaLong = bits &amp; 0xFFFFFFFFFFFFFL;

    if (exponent == 0)
    {
        exponent++;
    }
    else
    {
        mantissaLong = mantissaLong | (1L &lt;&lt; 52);
    }

    exponent -= 1075;

    if (mantissaLong == 0)
    {
        mantissa = 0;
        exponent = 0;
        return;
    }

    while ((mantissaLong &amp; 1) == 0)
    {
        mantissaLong &gt;&gt;= 1;
        exponent++;
    }

    mantissa = mantissaLong;
    while (mantissa &gt;= 1)
    {
        mantissa /= 2;
        exponent++;
    }

    if (negative)
        mantissa = -mantissa;
}
</code></pre>
<p>Несколько тестов:</p>
<pre><code>void TestNum(double value)
{
    double mantissa;
    int exponent;
    frexp(value, out mantissa, out exponent);
    Console.WriteLine($"{value} = {mantissa} * 2^{exponent}");
}

TestNum(0);
TestNum(10);
TestNum(-100);
TestNum(1024);
TestNum(double.MaxValue);
</code></pre>
<p>Результат:</p>
<pre><code>0 = 0 * 2^0
10 = 0,625 * 2^4
-100 = -0,78125 * 2^7
1024 = 0,5 * 2^11
1,79769313486232E+308 = 1 * 2^1024
</code></pre>
<p>В последнем выводит 1, хотя в дебагере видно, что там <code>0,99999999999999989</code>. Такова специфика работы <code>double.ToString</code>.</p>
</blockquote>
<h2>Answer 977715</h2>
<p><a href="https://ru.stackoverflow.com/a/977715/">Source</a> - by <a href="https://ru.stackoverflow.com/users/261244/yaroslav">Yaroslav</a></p>
<blockquote>
<p>В дополнение к первому ответу @Zergatul</p>
<p>Код на С#</p>
<pre><code>class Program
{
    static void Main(string[] args)
    {
        Double x = 10;
        Double y = 0;
        y = GetFrexp(x, out Int32 n);

        Console.WriteLine($"{y.ToString("R")} = frexp({x}, 2^{n})");
        Console.ReadKey();
    }

    public static Double GetFrexp(Double value, out Int32 exponent)
    {
        return Frexp(value, out exponent);
    }

    [DllImport("Math.dll", SetLastError = true, CallingConvention = CallingConvention.Cdecl)]
    private extern static Double Frexp([MarshalAs(UnmanagedType.R8)] Double value, 
                                       [MarshalAs(UnmanagedType.I4)] out Int32 exponent);
}
</code></pre>
<p>Код на C++</p>
<p>MathLibrary.h</p>
<pre><code>#ifdef MATHLIBRARY_EXPORTS
#define MATHLIBRARY_API __declspec(dllexport)
#else
#define MATHLIBRARY_API __declspec(dllimport)
#endif

#include &lt;string&gt;
#include &lt;math.h&gt;
#include &lt;stdio.h&gt;

namespace MathFunc
{
    extern "C" MATHLIBRARY_API double Frexp(double x, int* expptr);
}
</code></pre>
<p>MathLibrary.cpp</p>
<pre><code>#include "pch.h"
#include &lt;math.h&gt;
#include &lt;stdio.h&gt;
#include "MathLibrary.h"
#include &lt;stdexcept&gt;

using namespace std;

namespace MathFunc
{
    double Frexp(double x, int* expptr)
    {
         return frexp(x, expptr);
    }
}
</code></pre>
<p>Инструкция по созданию dll: <a href="https://docs.microsoft.com/en-us/cpp/build/walkthrough-creating-and-using-a-dynamic-link-library-cpp?view=vs-2019" rel="nofollow noreferrer">Пошаговое руководство. Создание и использование собственной библиотеки динамических ссылок (C++)</a></p>
</blockquote>
<h2>Answer 977872</h2>
<p><a href="https://ru.stackoverflow.com/a/977872/">Source</a> - by <a href="https://ru.stackoverflow.com/users/240512/msdn-whiteknight">MSDN.WhiteKnight</a></p>
<blockquote>
<p>Если на то пошло, можно и напрямую вызвать функцию frexp из CRT:</p>
<pre><code>[DllImport("msvcrt.dll", CallingConvention = CallingConvention.Cdecl)]
static extern double frexp(double x,ref int expptr);

static void Main(string[] args)
{
    double x = 1024;            
    int exp=0;
    double m = frexp(x, ref exp);
    Console.WriteLine("{0} = {1} * 2^{2}",x,m,exp);
}
</code></pre>
<p>msvcrt.dll - это версия Microsoft CRT, поставляемая с Windows и используемая некоторыми библиотеками в ее составе (любое .NET приложение автоматически грузит ее при старте, поэтому ее использование не привносит никаких дополнительных зависимостей). Поскольку она является недокументированной, возможно, имеет смысл вместо нее использовать версию CRT из определенного Visual C++ Redistrubutable, например msvcr110.dll для Visual C++ 2012.  </p>
</blockquote>
<hr>
<p><i>Content is retrieved from StackExchange API. </i></p>
<p><i>Auto-generated by ruso-archive tools. </i></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>RuSO Archive (published from sources in <a href="https://github.com/MSDN-WhiteKnight/ruso-archive">GitHub repository</a>). Content licensed under <a href="https://github.com/MSDN-WhiteKnight/ruso-archive/blob/master/LICENSE">CC-BY-SA 4.0</a>.<br>Generated by <strong>DocFX</strong></span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
