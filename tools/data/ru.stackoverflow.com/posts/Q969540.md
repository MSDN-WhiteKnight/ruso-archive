---
title: "Ожидание окончания потока при закрытии приложения"
se.owner.user_id: 333766
se.owner.display_name: "Vladislav Sokolov"
se.owner.link: "https://ru.stackoverflow.com/users/333766/vladislav-sokolov"
se.link: "https://ru.stackoverflow.com/questions/969540/%d0%9e%d0%b6%d0%b8%d0%b4%d0%b0%d0%bd%d0%b8%d0%b5-%d0%be%d0%ba%d0%be%d0%bd%d1%87%d0%b0%d0%bd%d0%b8%d1%8f-%d0%bf%d0%be%d1%82%d0%be%d0%ba%d0%b0-%d0%bf%d1%80%d0%b8-%d0%b7%d0%b0%d0%ba%d1%80%d1%8b%d1%82%d0%b8%d0%b8-%d0%bf%d1%80%d0%b8%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d1%8f"
se.question_id: 969540
se.post_type: question
se.score: 1
---
<p>Запускаю поток, в котором есть цикл while(true). В цикле есть </p>

<pre><code>while (form.trigger == "pause")
{
    if (form.trigger_status == "start")
    {
        Action action_trigger = () =&gt; form.textBox1.Text = "Поток приостановлен \r\n" + form.textBox1.Text;
        form.textBox1.Invoke(action_trigger);
        form.trigger_status = "pause";
    }
    Thread.Sleep(1000);
}
</code></pre>

<p>В цикле парсится информация. Очень важно, чтобы парсинг не повторялся. В БД я уже всё расставил и обозначил контрольные точки для запуска и остановки парсинга. Но, когда я закрываю приложение, само собой, в БД может не записаться информация, которая очень важна для меня. Поэтому, нажав на свойства формы в конструкторе форм, я создал в событиях FormClosing функцию close_app. В нём я написал следующее:</p>

<pre><code>Form1 form = Application.OpenForms["Form1"] as Form1;
form.trigger = "pause";
while (form.trigger_status == "start")
{
    Thread.Sleep(1000);
}
form.myThread.Abort();
form.myThread.Join();
</code></pre>

<p>Но, почему-то в потоке не доходит до </p>

<pre><code>while (form.trigger == "pause")
</code></pre>

<p>Соответственно, не меняется triger_status и не закрывается приложение. В чём может быть проблема? </p>
