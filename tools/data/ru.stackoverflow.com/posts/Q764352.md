---
title: "Как отловить нажатие клавиш в WPF-приложении, когда оно свёрнуто?"
se.owner.user_id: 195735
se.owner.display_name: "klutch1991"
se.owner.link: "https://ru.stackoverflow.com/users/195735/klutch1991"
se.link: "https://ru.stackoverflow.com/questions/764352/%d0%9a%d0%b0%d0%ba-%d0%be%d1%82%d0%bb%d0%be%d0%b2%d0%b8%d1%82%d1%8c-%d0%bd%d0%b0%d0%b6%d0%b0%d1%82%d0%b8%d0%b5-%d0%ba%d0%bb%d0%b0%d0%b2%d0%b8%d1%88-%d0%b2-wpf-%d0%bf%d1%80%d0%b8%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d0%b8-%d0%ba%d0%be%d0%b3%d0%b4%d0%b0-%d0%be%d0%bd%d0%be-%d1%81%d0%b2%d1%91%d1%80%d0%bd%d1%83%d1%82%d0%be"
se.question_id: 764352
se.post_type: question
se.score: 5
---
<p>Имеется <strong>WPF</strong>-приложение (аудио-проигрыватель). Необходимо добавить возможность отлавливать нажатие определённых клавиш, даже когда приложение свёрнуто. Например, при нажатии <em>Num4</em> - останавливать вопроизведение, при нажатии других клавиш (в зависимости от настроек - продолжать воспроизведение музыки и т.п.). 
Пробовал реализовать через функцию <code>GetAsyncKeyState(int vkey)</code> из <code>user32.dll</code>, но мне это не совсем подходит, вот пример кода:</p>

<pre><code>public static class KeyState
{
    public static void Wait(Key key, Action&lt;KeyStates&gt; action)
    {
        var asyncOperation = AsyncOperationManager.CreateOperation(null);
        SendOrPostCallback callBack = state =&gt; action((KeyStates) state);
        ThreadPool.QueueUserWorkItem(state =&gt;
        {
            var vk = KeyInterop.VirtualKeyFromKey(key);                
            var prev = ((GetAsyncKeyState(vk) &amp; 0x8000) == 0x8000);
            if (prev)
            {
                asyncOperation.Post(callBack, KeyStates.Down);
            }
            while (true)
            {
                var res = ((GetAsyncKeyState(vk) &amp; 0x8000) == 0x8000);
                if (res != prev &amp;&amp; res)
                {
                    asyncOperation.Post(callBack, KeyStates.Down);
                }
                prev = res;
            }
        });
    }

    [DllImport("user32.dll", CharSet = CharSet.Auto, ExactSpelling = true)]
    private static extern short GetAsyncKeyState(int vkey);
}
</code></pre>

<p>Проблема здесь в том, что мне не только нужно <strong>отловить</strong> нажатие клавиши, но и п<strong>редотвратить "продвижение"</strong> нажатия клавиши далее. Т.е. нажатие клавиши должно перехватываться моим приложением и не попадать в другие (например, в текстовый редактор).
Буду благодарен за помощь. Если кто-нибудь ещё и подскажет как это корректно реализовать для приложения, которое развертывается через <em>ClickOnce</em>, было бы вообще шикарно. Спасибо! </p>
