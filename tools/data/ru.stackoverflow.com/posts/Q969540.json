{"tags":["c#","winforms","многопоточность"],"owner":{"reputation":79,"user_id":333766,"user_type":"registered","profile_image":"https://lh5.googleusercontent.com/-BuSrtkwzdCA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcfR9Do5Au4j_EEBD_eqjPP7BdVrg/mo/photo.jpg?sz=128","display_name":"Vladislav Sokolov","link":"https://ru.stackoverflow.com/users/333766/vladislav-sokolov"},"is_answered":true,"view_count":87,"accepted_answer_id":970291,"answer_count":2,"score":1,"last_activity_date":1555413396,"creation_date":1555247126,"last_edit_date":1555302041,"question_id":969540,"link":"https://ru.stackoverflow.com/questions/969540/%d0%9e%d0%b6%d0%b8%d0%b4%d0%b0%d0%bd%d0%b8%d0%b5-%d0%be%d0%ba%d0%be%d0%bd%d1%87%d0%b0%d0%bd%d0%b8%d1%8f-%d0%bf%d0%be%d1%82%d0%be%d0%ba%d0%b0-%d0%bf%d1%80%d0%b8-%d0%b7%d0%b0%d0%ba%d1%80%d1%8b%d1%82%d0%b8%d0%b8-%d0%bf%d1%80%d0%b8%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d1%8f","title":"Ожидание окончания потока при закрытии приложения","body":"<p>Запускаю поток, в котором есть цикл while(true). В цикле есть </p>\n\n<pre><code>while (form.trigger == \"pause\")\n{\n    if (form.trigger_status == \"start\")\n    {\n        Action action_trigger = () =&gt; form.textBox1.Text = \"Поток приостановлен \\r\\n\" + form.textBox1.Text;\n        form.textBox1.Invoke(action_trigger);\n        form.trigger_status = \"pause\";\n    }\n    Thread.Sleep(1000);\n}\n</code></pre>\n\n<p>В цикле парсится информация. Очень важно, чтобы парсинг не повторялся. В БД я уже всё расставил и обозначил контрольные точки для запуска и остановки парсинга. Но, когда я закрываю приложение, само собой, в БД может не записаться информация, которая очень важна для меня. Поэтому, нажав на свойства формы в конструкторе форм, я создал в событиях FormClosing функцию close_app. В нём я написал следующее:</p>\n\n<pre><code>Form1 form = Application.OpenForms[\"Form1\"] as Form1;\nform.trigger = \"pause\";\nwhile (form.trigger_status == \"start\")\n{\n    Thread.Sleep(1000);\n}\nform.myThread.Abort();\nform.myThread.Join();\n</code></pre>\n\n<p>Но, почему-то в потоке не доходит до </p>\n\n<pre><code>while (form.trigger == \"pause\")\n</code></pre>\n\n<p>Соответственно, не меняется triger_status и не закрывается приложение. В чём может быть проблема? </p>\n"}