{"owner":{"reputation":16058,"user_id":240512,"user_type":"registered","profile_image":"https://i.stack.imgur.com/Ew6lG.png?s=128&g=1","display_name":"MSDN.WhiteKnight","link":"https://ru.stackoverflow.com/users/240512/msdn-whiteknight"},"is_accepted":false,"score":0,"last_activity_date":1547121182,"creation_date":1547121182,"answer_id":930493,"question_id":930444,"body":"<p>Вот так это можно сделать с помощью OLE DB:</p>\n\n<pre><code>using System;\nusing System.Data;\nusing System.IO;\nusing System.Collections.Generic;\nusing System.Data.OleDb;\nusing System.Text;\n\nnamespace ConsoleApp1\n{\n    class Program\n    {\n        //находит максимальную длину элемента для всех столбцов DataTable\n        static int[] maxlen(DataTable dt) \n        {\n            int[] res = new int[dt.Columns.Count];\n\n            for (int i = 0; i &lt; dt.Columns.Count; i++)\n            {\n                res[i] = 0;\n                foreach (DataRow row in dt.Rows)\n                {\n                    string s = row[i].ToString();\n                    if (s.Length &gt; res[i]) res[i] = s.Length;\n                }\n            }\n            return res;\n        }\n\n        //выводит таблицу в текстовый файл\n        static void print(DataTable dt, StreamWriter wr)\n        {\n            int[] len = maxlen(dt);\n\n            foreach (DataRow row in dt.Rows)\n            {\n                for (int i = 0; i &lt; row.ItemArray.Length; i++)\n                {\n                    string s = row[i].ToString().PadLeft(len[i]);\n                    wr.Write(s + \" | \");\n                }\n                wr.WriteLine();\n            }\n        }\n\n        static void Main(string[] args)\n        {\n            string xlspath = \"c:\\\\test\\\\test.xls\";\n            string txtpath = \"c:\\\\test\\\\test.txt\";\n\n            string strConn = string.Empty;\n            string sheetName = string.Empty;\n\n            var builder = new OleDbConnectionStringBuilder(\"Provider=Microsoft.Jet.OLEDB.4.0;Extended Properties='Excel 8.0;HDR=No;IMEX=1;'\");\n            builder.DataSource = xlspath;\n            strConn = builder.ConnectionString;\n\n            OleDbConnection conn = new OleDbConnection(strConn);\n            using (conn)\n            {\n                conn.Open();\n\n                //получаем список листов\n                DataTable dtSchema = conn.GetOleDbSchemaTable(OleDbSchemaGuid.Tables, new object[] { null, null, null, \"TABLE\" });\n\n                FileStream fs = new FileStream(txtpath, FileMode.Create);\n                using (fs)\n                {\n                    StreamWriter wr = new StreamWriter(fs, Encoding.UTF8);\n                    using (wr)\n                    {\n                        foreach (DataRow row in dtSchema.Rows)\n                        {\n                            //выводим имя файла\n                            sheetName = row.Field&lt;string&gt;(\"TABLE_NAME\");\n                            wr.WriteLine(\"* Лист \"+ sheetName);\n                            wr.WriteLine();\n\n                            //получаем содержимое листа\n                            DataTable tbContainer = new DataTable();\n                            OleDbDataAdapter oda = new OleDbDataAdapter(string.Format(\"select * from [{0}]\", sheetName), conn);\n                            oda.Fill(tbContainer);\n\n                            //выводим таблицу\n                            print(tbContainer, wr);\n                            wr.WriteLine();\n                        }                        \n                    }\n                }                \n            }\n\n            Console.Write(\"OK\");\n            Console.ReadKey();\n        }\n    }\n}\n</code></pre>\n\n<p>Данный пример не требует наличия Excel или какого-то другого ПО на целевой машине, но:</p>\n\n<ol>\n<li><p>Работает только в Windows (2000+).</p></li>\n<li><p>Работает только в 32-битных приложениях.</p></li>\n<li><p>Имеет проблемы с чтением данных в случае, когда один столбец содержит в основном числовые значения + несколько текстовых значений (текстовые могут иногда не прочитаться).</p></li>\n</ol>\n\n<p>Последняя проблема может быть решена установкой следующих значений в реестре на целевых машинах:</p>\n\n<pre><code>[HKEY_LOCAL_MACHINE\\SOFTWARE\\WOW6432Node\\Microsoft\\Jet\\4.0\\Engines\\Excel]\nImportMixedTypes = Text\nTypeGuessRows = 0\n</code></pre>\n"}