---
title: "Как адаптировать код под поиск устройств в сети?"
se.owner.user_id: 325490
se.owner.display_name: "sddvxd"
se.owner.link: "https://ru.stackoverflow.com/users/325490/sddvxd"
se.link: "https://ru.stackoverflow.com/questions/962254/%d0%9a%d0%b0%d0%ba-%d0%b0%d0%b4%d0%b0%d0%bf%d1%82%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d1%82%d1%8c-%d0%ba%d0%be%d0%b4-%d0%bf%d0%be%d0%b4-%d0%bf%d0%be%d0%b8%d1%81%d0%ba-%d1%83%d1%81%d1%82%d1%80%d0%be%d0%b9%d1%81%d1%82%d0%b2-%d0%b2-%d1%81%d0%b5%d1%82%d0%b8"
se.question_id: 962254
se.post_type: question
se.score: 2
---
<p>Есть код, который почти полностью был скопирован из <a href="https://docs.microsoft.com/ru-ru/windows/desktop/WNet/enumerating-network-resources" rel="nofollow noreferrer">статьи MSDN:</a></p>

<pre><code>BOOL WINAPI EnumResources(LPNETRESOURCE lpNR = nullptr){
    HANDLE hNetEnum;
    DWORD dwResultOpen = WNetOpenEnum(RESOURCE_CONTEXT,
                                      NULL,
                                      0,
                                      lpNR,
                                      &amp;hNetEnum);

    if(dwResultOpen != NO_ERROR)
        return FALSE;

    constexpr DWORD numOfResources = 2048;
    DWORD count = -1;
    DWORD cbBuffer = numOfResources * sizeof (NETRESOURCE);
    DWORD dwResultEnum = 0;
    LPNETRESOURCE lpNRlocal = new NETRESOURCE[numOfResources];

    do{
        dwResultEnum = WNetEnumResource(hNetEnum, &amp;count, lpNRlocal, &amp;cbBuffer);
        if(dwResultEnum == NO_ERROR){
            for(int i = 0; i &lt; count; ++i){
                cout &lt;&lt; "Resource found!: " &lt;&lt; lpNRlocal[i].lpLocalName &lt;&lt; endl;
                if(RESOURCEUSAGE_CONTAINER == (lpNRlocal[i].dwUsage &amp; RESOURCEUSAGE_CONTAINER))
                    if(!EnumResources(&amp;lpNRlocal[i]))
                        cout &lt;&lt; "error enum resources\n";
            }
        }

    }while(dwResultEnum != ERROR_NO_MORE_ITEMS);

    delete [] lpNRlocal;
    CloseHandle(hNetEnum);
    return TRUE;
}
</code></pre>

<p>Проблема в том, что этот код выполняется долго, а как выполняется - дает просто список контейнеров (хотя надеялся больше типов будет). Подскажите пожалуйста, у кого был опыт работы с данными функциями - как адаптировать код выше, чтобы он выводил ip адреса устройств в локальной сети?</p>
