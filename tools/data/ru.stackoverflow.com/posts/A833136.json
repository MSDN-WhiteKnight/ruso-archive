{"owner":{"reputation":16068,"user_id":240512,"user_type":"registered","profile_image":"https://i.stack.imgur.com/Ew6lG.png?s=128&g=1","display_name":"MSDN.WhiteKnight","link":"https://ru.stackoverflow.com/users/240512/msdn-whiteknight"},"is_accepted":false,"score":1,"last_activity_date":1527218973,"creation_date":1527218973,"answer_id":833136,"question_id":832066,"body":"<p>Для того, чтобы получить значения этих свойств для процесса, нужно иметь в отношении него право доступа PROCESS_QUERY_LIMITED_INFORMATION. Приложение всегда имеет это право в отношении других процессов того же пользователя, но для процессов других пользователей это право можно получить только при определенных условиях:</p>\n\n<ul>\n<li><p>Запускающий пользователь должен иметь привилегии отладки (SeDebugPrivilege). По умолчанию эти привилегии доступны группе \"Администраторы\", но могут быть назначены другим пользователям. Для простоты иногда говорят \"права администратора\".</p></li>\n<li><p>При включенном UAC нужно также повышение уровня привилегий (т.е., явное указание, что программа работает с правами администратора).</p></li>\n</ul>\n\n<p>Если программа всегда должна запускаться с повышенными привилегиями, можно создать манифест и указать в нем это:</p>\n\n<pre><code>&lt;trustInfo xmlns=\"urn:schemas-microsoft-com:asm.v2\"&gt;\n    &lt;security&gt;\n      &lt;requestedPrivileges xmlns=\"urn:schemas-microsoft-com:asm.v3\"&gt;        \n        &lt;requestedExecutionLevel  level=\"requireAdministrator\" uiAccess=\"false\" /&gt;        \n      &lt;/requestedPrivileges&gt;\n    &lt;/security&gt;\n&lt;/trustInfo&gt; \n</code></pre>\n\n<p>Для теста создадим простую программу для отображения времени работы всех процессов:</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Text;\nusing System.IO;\nusing System.Diagnostics;\n\nnamespace ConsoleApplication1\n{\n    class Program\n    {\n        [STAThread]\n        static void Main(string[] args)\n        {\n            var processes = Process.GetProcesses();\n\n            uint c_error = 0;\n\n            foreach (Process pr in processes)\n            {\n                using (pr)\n                {\n                    Console.Write(pr.ProcessName.PadLeft(25));\n                    try\n                    {\n                        Console.Write(\"\\tRunning: \" + DateTime.Now.Subtract(pr.StartTime).TotalHours.ToString(\"F3\") + \" hours \");\n                    }\n                    catch (Exception ex)\n                    {\n                        Console.Write(\"\\t\" + ex.Message);\n                        c_error++;\n                    }\n\n                    try\n                    {\n                        Console.Write(\"\\tHasExited: \" + pr.HasExited.ToString());\n                    }\n                    catch (Exception ex)\n                    {\n                        Console.Write(\"\\t\" + ex.Message);\n                        c_error++;\n                    }\n                    Console.WriteLine();\n                }\n            }\n\n            Console.WriteLine();\n            Console.WriteLine(\"Processes: {0}, Errors: {1}\",\n                processes.Length, c_error);\n\n            Console.ReadKey();\n        }\n    }    \n}\n</code></pre>\n\n<p>Результаты запуска без повышенных привилегий:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"true\" data-console=\"false\" data-babel=\"false\">\r\n<div class=\"snippet-code snippet-currently-hidden\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>ConsoleApplication1.vshost      Running: 0,004 hours    HasExited: False\r\n                  audiodg       Running: 0,003 hours    Отказано в доступе\r\n                  browser       Running: 0,482 hours    HasExited: False\r\n                  wininit       Отказано в доступе      Отказано в доступе\r\n             aswidsagenta       Отказано в доступе      Отказано в доступе\r\n                  browser       Running: 0,128 hours    HasExited: False\r\n                  svchost       Отказано в доступе      Отказано в доступе\r\n                    csrss       Отказано в доступе      Отказано в доступе\r\n                      MDM       Отказано в доступе      Отказано в доступе\r\n                  taskmgr       Running: 0,493 hours    HasExited: False\r\n                  svchost       Отказано в доступе      Отказано в доступе\r\n                  svchost       Отказано в доступе      Отказано в доступе\r\n                 igfxTray       Running: 0,501 hours    HasExited: False\r\n                  svchost       Отказано в доступе      Отказано в доступе\r\n    PresentationFontCache       Отказано в доступе      Отказано в доступе\r\n                   igfxHK       Running: 0,501 hours    HasExited: False\r\n                WDExpress       Running: 0,224 hours    HasExited: False\r\n                  svchost       Отказано в доступе      Отказано в доступе\r\n                   igfxEM       Running: 0,501 hours    HasExited: False\r\n                      lsm       Отказано в доступе      Отказано в доступе\r\n                 AvastSvc       Отказано в доступе      Отказано в доступе\r\n                  svchost       Отказано в доступе      Отказано в доступе\r\n                  conhost       Running: 0,205 hours    HasExited: False\r\n                 iusb3mon       Running: 0,504 hours    HasExited: False\r\n                  browser       Running: 0,213 hours    HasExited: False\r\n                      LMS       Отказано в доступе      Отказано в доступе\r\n                 explorer       Running: 0,511 hours    HasExited: False\r\n                  svchost       Отказано в доступе      Отказано в доступе\r\n                      dwm       Running: 0,511 hours    HasExited: False\r\n                  AvastUI       Running: 0,504 hours    HasExited: False\r\n           igfxCUIService       Отказано в доступе      Отказано в доступе\r\n                    csrss       Отказано в доступе      Отказано в доступе\r\n                  spoolsv       Отказано в доступе      Отказано в доступе\r\n                  svchost       Отказано в доступе      Отказано в доступе\r\n                  browser       Running: 0,482 hours    HasExited: False\r\n                  MSBuild       Running: 0,205 hours    HasExited: False\r\n                    lsass       Отказано в доступе      Отказано в доступе\r\n                  browser       Running: 0,481 hours    HasExited: False\r\n                  conhost       Running: 0,000 hours    HasExited: False\r\n                 services       Отказано в доступе      Отказано в доступе\r\n       DiscSoftBusService       Отказано в доступе      Отказано в доступе\r\n            SearchIndexer       Отказано в доступе      Отказано в доступе\r\n                 wmpnetwk       Отказано в доступе      Отказано в доступе\r\n                  svchost       Отказано в доступе      Отказано в доступе\r\n              jhi_service       Отказано в доступе      Отказано в доступе\r\n          GISGKH Payments       Running: 0,505 hours    HasExited: False\r\n                  browser       Running: 0,475 hours    HasExited: False\r\n                  browser       Running: 0,478 hours    HasExited: False\r\n                   DTLite       Running: 0,505 hours    HasExited: False\r\n                  svchost       Отказано в доступе      Отказано в доступе\r\n           service_update       Отказано в доступе      Отказано в доступе\r\n                 winlogon       Отказано в доступе      Отказано в доступе\r\n                  browser       Running: 0,482 hours    HasExited: False\r\n      ConsoleApplication1       Running: 0,000 hours    HasExited: False\r\n           service_update       Отказано в доступе      Отказано в доступе\r\n                  browser       Running: 0,310 hours    HasExited: False\r\n                  browser       Running: 0,477 hours    HasExited: False\r\n                sqlwriter       Отказано в доступе      Отказано в доступе\r\n                     smss       Отказано в доступе      Отказано в доступе\r\n                 unsecapp       Отказано в доступе      Отказано в доступе\r\n                  svchost       Отказано в доступе      Отказано в доступе\r\n                  svchost       Отказано в доступе      Отказано в доступе\r\n                   System       Отказано в доступе      Отказано в доступе\r\n                 taskhost       Running: 0,512 hours    HasExited: False\r\n                     Idle       Отказано в доступе      Отказано в доступе\r\n\r\nProcesses: 65, Errors: 75</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>С повышенными привилегиями:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"true\" data-console=\"false\" data-babel=\"false\">\r\n<div class=\"snippet-code snippet-currently-hidden\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>ConsoleApplication1.vshost      Running: 0,039 hours    HasExited: False\r\n                  audiodg       Running: 0,038 hours    Отказано в доступе\r\n                  browser       Running: 0,517 hours    HasExited: False\r\n                  wininit       Running: 0,559 hours    HasExited: False\r\n             aswidsagenta       Running: 0,549 hours    HasExited: False\r\n                  browser       Running: 0,163 hours    HasExited: False\r\n                  svchost       Running: 0,556 hours    HasExited: False\r\n                    csrss       Running: 0,559 hours    HasExited: False\r\n                      MDM       Running: 0,554 hours    HasExited: False\r\n                  taskmgr       Running: 0,528 hours    HasExited: False\r\n                  svchost       Running: 0,554 hours    HasExited: False\r\n                  svchost       Running: 0,553 hours    HasExited: False\r\n                 igfxTray       Running: 0,536 hours    HasExited: False\r\n                  svchost       Running: 0,557 hours    HasExited: False\r\n    PresentationFontCache       Running: 0,537 hours    HasExited: False\r\n                   igfxHK       Running: 0,536 hours    HasExited: False\r\n                WDExpress       Running: 0,259 hours    HasExited: False\r\n                  svchost       Running: 0,557 hours    HasExited: False\r\n                   igfxEM       Running: 0,536 hours    HasExited: False\r\n                      lsm       Running: 0,559 hours    HasExited: False\r\n                 AvastSvc       Running: 0,556 hours    HasExited: False\r\n                  dllhost       Running: 0,000 hours    HasExited: False\r\n                  svchost       Running: 0,552 hours    HasExited: False\r\n                  conhost       Running: 0,240 hours    HasExited: False\r\n                 iusb3mon       Running: 0,539 hours    HasExited: False\r\n                  browser       Running: 0,247 hours    HasExited: False\r\n                      LMS       Running: 0,519 hours    HasExited: False\r\n                 explorer       Running: 0,546 hours    HasExited: False\r\n                  svchost       Running: 0,553 hours    HasExited: False\r\n                      dwm       Running: 0,546 hours    HasExited: False\r\n                  AvastUI       Running: 0,539 hours    HasExited: False\r\n           igfxCUIService       Running: 0,556 hours    HasExited: False\r\n                    csrss       Running: 0,561 hours    HasExited: False\r\n                  spoolsv       Running: 0,554 hours    HasExited: False\r\n                  svchost       Running: 0,557 hours    HasExited: False\r\n                  browser       Running: 0,517 hours    HasExited: False\r\n                  MSBuild       Running: 0,240 hours    HasExited: False\r\n                    lsass       Running: 0,559 hours    HasExited: False\r\n                  browser       Running: 0,516 hours    HasExited: False\r\n                 services       Running: 0,559 hours    HasExited: False\r\n       DiscSoftBusService       Running: 0,538 hours    HasExited: False\r\n      ConsoleApplication1       Running: 0,000 hours    HasExited: False\r\n            SearchIndexer       Running: 0,536 hours    HasExited: False\r\n                 wmpnetwk       Running: 0,535 hours    HasExited: False\r\n                  svchost       Running: 0,557 hours    HasExited: False\r\n              jhi_service       Running: 0,519 hours    HasExited: False\r\n          GISGKH Payments       Running: 0,539 hours    HasExited: False\r\n                  browser       Running: 0,510 hours    HasExited: False\r\n                  browser       Running: 0,513 hours    HasExited: False\r\n                   DTLite       Running: 0,540 hours    HasExited: False\r\n                  svchost       Running: 0,554 hours    HasExited: False\r\n           service_update       Running: 0,553 hours    HasExited: False\r\n                 winlogon       Running: 0,559 hours    HasExited: False\r\n                  browser       Running: 0,517 hours    HasExited: False\r\n                  dllhost       Running: 0,000 hours    HasExited: False\r\n           service_update       Running: 0,553 hours    HasExited: False\r\n                  browser       Running: 0,345 hours    HasExited: False\r\n                  browser       Running: 0,512 hours    HasExited: False\r\n                sqlwriter       Running: 0,553 hours    HasExited: False\r\n                     smss       Running: 0,562 hours    HasExited: False\r\n                 unsecapp       Running: 0,541 hours    HasExited: False\r\n                  svchost       Running: 0,557 hours    HasExited: False\r\n                  svchost       Running: 0,557 hours    HasExited: False\r\n                  conhost       Running: 0,000 hours    HasExited: False\r\n                   System       Running: 0,562 hours    Отказано в доступе\r\n                 taskhost       Running: 0,547 hours    HasExited: False\r\n                     Idle       Отказано в доступе      Отказано в доступе\r\n\r\nProcesses: 67, Errors: 4</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Как можно увидеть, при обычном запуске ошибку выдает на всех системных процессах, а при запуске с повышенными привилегиями - только на защищенных процессах (audiodg и System).</p>\n"}