---
title: "Почему функция CreateThread запускает функцию сразу после создания?"
se.owner.user_id: 330678
se.owner.display_name: "Ilya  Pakhmutov"
se.owner.link: "https://ru.stackoverflow.com/users/330678/ilya-pakhmutov"
se.link: "https://ru.stackoverflow.com/questions/1036663/%d0%9f%d0%be%d1%87%d0%b5%d0%bc%d1%83-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d1%8f-createthread-%d0%b7%d0%b0%d0%bf%d1%83%d1%81%d0%ba%d0%b0%d0%b5%d1%82-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d1%8e-%d1%81%d1%80%d0%b0%d0%b7%d1%83-%d0%bf%d0%be%d1%81%d0%bb%d0%b5-%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d0%bd%d0%b8%d1%8f"
se.question_id: 1036663
se.post_type: question
se.score: 1
---
<p>возникла проблема с распараллеливанием вывода на экран консоли:</p>

<p>История: исполнение <code>WriteConsoleOutputW</code> занимает с каждым последующим обновлением занимает все больше времени, при чем размер буфера не меняется. Изначально была идея вынести вывод в отдельный поток, но оно все еще занимает 74-76 мс, что невероятно долго. Последнее что пришло в голову - разделить буфер на несколько частей и выводить их в нескольких потоках.</p>

<pre><code>self-&gt;ThreadPool[0] = CreateThread(
        NULL,
        0,
        &amp;PassToRender1,
        self,
        0,
        &amp;self-&gt;ThreadPoolID[0]);

    self-&gt;ThreadPool[1] = CreateThread(
        NULL,
        0,
        &amp;PassToRender2,
        self,
        0,
        &amp;self-&gt;ThreadPoolID[1]);
</code></pre>

<pre><code>void _OutputToScreen(struct Window *self)
{
    WaitForMultipleObjects(2, self-&gt;ThreadPool, true, INFINITE);
}

DWORD VTHREAD PassToRender1(struct Window *self)
{
    WriteConsoleOutputW(
        self-&gt;hOut, 
        *self-&gt;ppBuffer, 
        (COORD) { (short)self-&gt;Width, (short)self-&gt;Height/2 }, 
        (COORD) { 0, 0 }, 
        &amp;self-&gt;rWindowRect
    );
}
DWORD VTHREAD PassToRender2(struct Window *self)
{
    SMALL_RECT rect = self-&gt;rWindowRect;
    rect.Top = rect.Bottom / 2;

    WriteConsoleOutputW(
        self-&gt;hOut,
        *self-&gt;ppBuffer,
        (COORD) { (short)self-&gt;Width, (short)self-&gt;Height/2 }, 
        (COORD) { 0, (short)self-&gt;Height / 2 }, 
        &amp;rect
    );
}
</code></pre>

<p>Однако как я выяснил <code>CreateThread</code> запускает функции сразу после создания, а я бы хотел, чтобы я мог обращаться к потокам по вызову функций, при том не пересоздавая потоки, что дорого по времени. </p>

<p>Есть ли какие-нибудь варианты как сделать запуск по вызову?</p>

<p>Дополнение: Вот что я рендерю
<a href="https://i.stack.imgur.com/z4ni7.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/z4ni7.png" alt="введите сюда описание изображения"></a></p>
