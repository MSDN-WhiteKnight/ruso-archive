---
title: "Конвертировать BSTR* retVal что бы вывести string в printf"
se.owner.user_id: 196672
se.owner.display_name: "koly86"
se.owner.link: "https://ru.stackoverflow.com/users/196672/koly86"
se.link: "https://ru.stackoverflow.com/questions/949439/%d0%9a%d0%be%d0%bd%d0%b2%d0%b5%d1%80%d1%82%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d1%82%d1%8c-bstr-retval-%d1%87%d1%82%d0%be-%d0%b1%d1%8b-%d0%b2%d1%8b%d0%b2%d0%b5%d1%81%d1%82%d0%b8-string-%d0%b2-printf"
se.question_id: 949439
se.post_type: question
se.score: 1
---
<p>на шарпе написана DLL вызывается в С++, в DLL передаю строку и обратно должен получить строку, но как ее вывести на экран. </p>

<p>строчка </p>

<pre><code>printf("%s\n", retVal); //not working
</code></pre>

<p>С++ проект</p>

<pre><code>int main() {
    CoInitialize(NULL);   //Initialize all COM Components
    MyInterop::IMyDotNetInterfacePtr pDotNetCOMPtr;
    HRESULT hRes =
            pDotNetCOMPtr.CreateInstance(MyInterop::CLSID_MyDotNetClass);
    if (hRes == S_OK) {
        BSTR str;
        BSTR* retVal = NULL;
        _bstr_t bstr1("This is the test string.");

        BSTR bstr;

        bstr = bstr1.copy();
        pDotNetCOMPtr-&gt;ShowCOMDialog();
        pDotNetCOMPtr-&gt;ComeToMe(bstr, retVal);
        printf("%s\n", retVal); //not working
        //call .NET COM exported function ShowDialog ()
    }
    CoUninitialize();
    return 0;
}
</code></pre>

<p>С# DLL</p>

<pre><code>public string ComeToMe(string str) {
    System.Windows.Forms.MessageBox.Show(str);
    switch (str) {
        case "Hi":
            return "Hi world";
            break;
    }

    return "Nothing to Show";
}
</code></pre>
