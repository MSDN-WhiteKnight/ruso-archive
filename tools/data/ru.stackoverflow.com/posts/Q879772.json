{"tags":["c#","winapi","клавиатура","keyboardhook"],"owner":{"reputation":73,"user_id":308892,"user_type":"registered","profile_image":"https://lh3.googleusercontent.com/-xR2QuNaTieg/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPCtJvSPi6mL96AakDnkcA6kd_OLg/mo/photo.jpg?sz=128","display_name":"InvertSOD","link":"https://ru.stackoverflow.com/users/308892/invertsod"},"is_answered":true,"view_count":237,"answer_count":1,"score":4,"last_activity_date":1573210762,"creation_date":1536599425,"last_edit_date":1573210762,"question_id":879772,"link":"https://ru.stackoverflow.com/questions/879772/%d0%9a%d0%b0%d0%ba-%d0%be%d1%82%d0%bb%d0%be%d0%b2%d0%b8%d1%82%d1%8c-%d0%b2%d1%81%d0%b5-%d0%ba%d0%bb%d0%b0%d0%b2%d0%b8%d1%88%d0%b8-%d1%87%d0%b5%d1%80%d0%b5%d0%b7-%d0%bd%d0%b8%d0%b7%d0%ba%d0%be%d1%83%d1%80%d0%be%d0%b2%d0%bd%d0%b5%d0%b2%d1%8b%d0%b9-%d1%85%d1%83%d0%ba","title":"Как отловить все клавиши через низкоуровневый хук?","body":"<p>Как отловить в <code>HookCallback</code> все клавиши с проверкой по шифтам и.т.п?\nОбычный <code>(Keys) Marshal.ReadInt32 (lParam)</code> просто пишет большими буквами.</p>\n\n<pre><code>public delegate IntPtr LowLevelKeyboardProc(int nCode, IntPtr wParam, IntPtr lParam);\nprivate static readonly LowLevelKeyboardProc _proc = HookCallback;\n\nprivate static IntPtr _hookID = IntPtr.Zero;\n\nprivate static IntPtr HookCallback(int nCode, IntPtr wParam, IntPtr lParam)\n{\n  if (nCode &gt;= 0 &amp;&amp; wParam == (IntPtr)WM_KEYDOWN)\n  {\n    try\n    {\n       Console.WriteLine((Keys)Marshal.ReadInt32(lParam));\n    }\n    catch (AccessViolationException ex) { Console.WriteLine($\"Error: {ex.ToString()}\"); }\n  }\n  return NativeMethods.CallNextHookEx(_hookID, nCode, wParam, lParam);\n}\n</code></pre>\n\n<p>У меня есть идея занести список клавиш в <code>List&lt;Keys&gt;</code> и оттуда как-то делать проверку. </p>\n\n<p>Но может у Вас есть идеи по лучше?! ( <em>желательно с примером</em> )</p>\n"}