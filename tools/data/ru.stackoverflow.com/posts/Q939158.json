{"tags":["c#","сервер"],"owner":{"reputation":345,"user_id":294599,"user_type":"registered","profile_image":"https://www.gravatar.com/avatar/0b2e2dc5af15ffe0fce1cb7c7945685b?s=128&d=identicon&r=PG&f=1","display_name":"Mart","link":"https://ru.stackoverflow.com/users/294599/mart"},"is_answered":true,"view_count":52,"accepted_answer_id":939417,"answer_count":2,"score":1,"last_activity_date":1549009256,"creation_date":1548949416,"question_id":939158,"link":"https://ru.stackoverflow.com/questions/939158/%d0%91%d0%b5%d0%b7-%d0%bf%d1%80%d0%b8%d1%87%d0%b8%d0%bd%d1%8b-%d0%b7%d0%b0%d0%ba%d1%80%d1%8b%d0%b2%d0%b0%d0%b5%d1%82%d1%81%d1%8f-%d0%ba%d0%be%d0%bd%d1%81%d0%be%d0%bb%d1%8c%d0%bd%d0%be%d0%b5-%d0%bf%d1%80%d0%b8%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d0%b5-%d1%81-%d1%81%d0%b5%d1%80%d0%b2%d0%b5%d1%80%d0%be%d0%bc-tcplistener-%d0%bd%d0%b0-windows","title":"Без причины закрывается консольное приложение с сервером TcpListener на Windows 7","body":"<p>Запускаю консольное приложение с простеньким сервером на Windows 7. Первые несколько часов работает норм. А потом неожиданно консольное приложение закрывается, даже без сообщения об ошибке. Что я не так сделал?</p>\n\n<pre><code>namespace Server_Smen_IP\n{\n    class Server\n    {\n        TcpListener Listener;\n        public Server(int Port)\n        {\n            Listener = new TcpListener(IPAddress.Any, Port);\n            Listener.Start();\n            new Client(Listener.AcceptTcpClient());\n            while (true)\n            {\n                TcpClient Client = Listener.AcceptTcpClient();\n                Thread Thread = new Thread(new ParameterizedThreadStart(ClientThread));\n                Thread.Start(Client);\n            }\n        }\n        ~Server()\n        {\n            if (Listener != null)\n            {\n                Listener.Stop();\n            }\n        }\n        static void Main(string[] args)\n        {\n            new Server(80);\n        }\n        static void ClientThread(Object StateInfo)\n        {\n            new Client((TcpClient)StateInfo);\n        }\n\n    class Client\n    {\n        public Client(TcpClient Client)\n        {\n            string Request = \"\";\n            byte[] Buffer = new byte[1024];\n            int Count;\n            while ((Count = Client.GetStream().Read(Buffer, 0, Buffer.Length)) &gt; 0)\n            {\n                Request += Encoding.ASCII.GetString(Buffer, 0, Count);\n                if (Request.IndexOf(\"\\r\\n\\r\\n\") &gt;= 0 || Request.Length &gt; 4096)\n                {\n                    break;\n                }\n            }\n            string Html = Моя_Процедура_Над_Телом_запроса(Request)\n            string Str = \"HTTP/1.1 200 OK\\nContent-type: text/html\\nContent-Length:\" + Html.Length.ToString() + \"\\n\\n\" + Html;\n            byte[] Buff = Encoding.ASCII.GetBytes(Str);\n            Client.GetStream().Write(Buff, 0, Buff.Length);\n            Client.Close();\n        }\n    }\n}\n</code></pre>\n"}