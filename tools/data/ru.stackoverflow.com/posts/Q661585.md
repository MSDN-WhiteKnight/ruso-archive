---
title: "Рисование на окне другого приложения с помощью WinAPI"
se.owner.user_id: 203050
se.owner.display_name: "ANU CHEEKI BREEKI"
se.owner.link: "https://ru.stackoverflow.com/users/203050/anu-cheeki-breeki"
se.link: "https://ru.stackoverflow.com/questions/661585/%d0%a0%d0%b8%d1%81%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5-%d0%bd%d0%b0-%d0%be%d0%ba%d0%bd%d0%b5-%d0%b4%d1%80%d1%83%d0%b3%d0%be%d0%b3%d0%be-%d0%bf%d1%80%d0%b8%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d1%8f-%d1%81-%d0%bf%d0%be%d0%bc%d0%be%d1%89%d1%8c%d1%8e-winapi"
se.question_id: 661585
se.post_type: question
se.score: 7
---
<p>Нужно написать на С# программу, которая будет определять над каким окном Windows сейчас находится курсор и обводить это окно рамкой (указывая пользователю, над каким элементом находится курсор, ведь в WinApi, окном является не только само окно, содержащее в себе множество других элементов, но и эти элементы тоже являются окнами).  </p>

<p>Handler окна под курсором получить легко:  </p>

<pre><code>...
Point point;
WinApi.GetCursorPos(out point);
WinApi.WindowFromPoint(point);
...
</code></pre>

<p>Но вот нарисовать что то на окне не выходит, хоть убейте.  </p>

<pre><code>public static void drawSelectionRectangle(IntPtr handler)
{
    Rectangle rectangle;
    WinApi.GetWindowRect(handler, out rectangle);

    WinApi.PAINTSTRUCT paintProperties;
    IntPtr paintContext = WinApi.BeginPaint(handler, out paintProperties);

    IntPtr pen = WinApi.CreatePen(WinApi.PenStyle.PS_SOLID, 5, (uint) ColorTranslator.ToWin32(Color.Red));
    WinApi.SelectObject(paintContext, pen);

    WinApi.Rectangle(paintContext, rectangle.Left, rectangle.Top, rectangle.Right, rectangle.Bottom);

    WinApi.ValidateRect(handler, IntPtr.Zero);
    WinApi.EndPaint(handler, ref paintProperties);
}
</code></pre>

<p><code>drawSelectionRectangle(IntPtr handler)</code> вызывал и одиночно (по нажатию кнопки) и в цикле (так как предполагал, что отрисовка может выполнятся за один кадр, после чего, исчезать). Ни так ни так не работает.  </p>

<p>Подскажите, пожалуйста, в чем проблема... Скоро курсовой сдавать, а ничего не готово :(</p>
