{"owner":{"reputation":16058,"user_id":240512,"user_type":"registered","profile_image":"https://i.stack.imgur.com/Ew6lG.png?s=128&g=1","display_name":"MSDN.WhiteKnight","link":"https://ru.stackoverflow.com/users/240512/msdn-whiteknight"},"is_accepted":true,"score":2,"last_activity_date":1506090332,"last_edit_date":1506090332,"creation_date":1505678026,"answer_id":719696,"question_id":718965,"body":"<p>На c# не знаю, как это сделать. На с++/cli вот самое лучшее, чего удалось добиться:</p>\n\n<pre><code>System::Drawing::Bitmap ^ ExtractBitmap2(ID3D11Texture2D* d3dtex, ID3D11Device* pDevice) \n{\nSystem::Diagnostics::Stopwatch ^ sw =gcnew System::Diagnostics::Stopwatch();\nInt32 t1,t2;\nHRESULT hr;\n\nHBITMAP hBitmapTexture = NULL;\nHGDIOBJ hBitmap;\n\nD3D11_TEXTURE2D_DESC desc;\nID3D11Texture2D* pNewTexture = NULL;\n\nD3D11_TEXTURE2D_DESC description;\n\nsw-&gt;Start();\nt1=sw-&gt;ElapsedMilliseconds;\nd3dtex-&gt;GetDesc(&amp;desc);\nd3dtex-&gt;GetDesc(&amp;description);\n\ndescription.BindFlags = 0;\ndescription.CPUAccessFlags = D3D11_CPU_ACCESS_READ | D3D11_CPU_ACCESS_WRITE;\ndescription.Usage = D3D11_USAGE_STAGING;\ndescription.MiscFlags = 0;  \n\nif (FAILED(pDevice-&gt;CreateTexture2D(&amp;description, NULL, &amp;pNewTexture)))\n{\nConsole::WriteLine(\"CreateTexture2D failed!\");\nreturn nullptr;\n}\n\nID3D11DeviceContext* ctx = NULL;\npDevice-&gt;GetImmediateContext(&amp;ctx);\n\nctx-&gt;CopyResource(pNewTexture, d3dtex);\n\nD3D11_MAPPED_SUBRESOURCE resource;\nUINT subresource = D3D11CalcSubresource(0, 0, 0);\nctx-&gt;Map(pNewTexture, subresource, D3D11_MAP_READ_WRITE, 0, &amp;resource);\n\n// Copy from texture to bitmap buffer.\nuint8_t* sptr = reinterpret_cast&lt;uint8_t*&gt;(resource.pData);\nuint8_t* dptr = new uint8_t[desc.Width*desc.Height * 4];\nUINT* p = NULL;\nint i;\nuint32_t x;\n\nt2=sw-&gt;ElapsedMilliseconds;\nConsole::WriteLine(\"init time \"+Convert::ToString(t2-t1));\n\nt1=sw-&gt;ElapsedMilliseconds;\nfor (size_t h = 0; h &lt; desc.Height; ++h)\n{\nsize_t msize = std::min&lt;size_t&gt;(desc.Width * 4, resource.RowPitch);\nmemcpy_s(dptr, desc.Width * 4, sptr, msize);    \n////\nsptr += resource.RowPitch;\ndptr += desc.Width * 4;\n}\n\nt2=sw-&gt;ElapsedMilliseconds;\nConsole::WriteLine(\"copy time \"+Convert::ToString(t2-t1));\n\ndptr -= desc.Width*desc.Height * 4;\n\nt1=sw-&gt;ElapsedMilliseconds;\n\nSystem::Drawing::Bitmap ^ bmp=gcnew System::Drawing::Bitmap(desc.Width,desc.Height,desc.Width*4,\nSystem::Drawing::Imaging::PixelFormat::Format32bppRgb,(IntPtr)dptr);\n\nt2=sw-&gt;ElapsedMilliseconds;\nConsole::WriteLine(\"convert time \"+Convert::ToString(t2-t1));\n\nreturn bmp;\n\n}\n</code></pre>\n\n<p>Время: 15-17 мс на Intel Core i3</p>\n"}