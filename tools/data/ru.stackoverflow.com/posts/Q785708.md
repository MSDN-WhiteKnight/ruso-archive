---
title: "Перегрузка операторов, необходимо иметь возможность извлечь реальный адрес локального поля"
se.owner.user_id: 206435
se.owner.display_name: "ヒミコ"
se.owner.link: "https://ru.stackoverflow.com/users/206435/%e3%83%92%e3%83%9f%e3%82%b3"
se.link: "https://ru.stackoverflow.com/questions/785708/%d0%9f%d0%b5%d1%80%d0%b5%d0%b3%d1%80%d1%83%d0%b7%d0%ba%d0%b0-%d0%be%d0%bf%d0%b5%d1%80%d0%b0%d1%82%d0%be%d1%80%d0%be%d0%b2-%d0%bd%d0%b5%d0%be%d0%b1%d1%85%d0%be%d0%b4%d0%b8%d0%bc%d0%be-%d0%b8%d0%bc%d0%b5%d1%82%d1%8c-%d0%b2%d0%be%d0%b7%d0%bc%d0%be%d0%b6%d0%bd%d0%be%d1%81%d1%82%d1%8c-%d0%b8%d0%b7%d0%b2%d0%bb%d0%b5%d1%87%d1%8c-%d1%80%d0%b5%d0%b0%d0%bb%d1%8c%d0%bd%d1%8b%d0%b9-%d0%b0%d0%b4%d1%80%d0%b5%d1%81-%d0%bb%d0%be%d0%ba%d0%b0%d0%bb"
se.question_id: 785708
se.post_type: question
se.score: 3
---
<p>Необходим не указатель на управляемый класс, а указатель на структуру неуправляемого кода, указатель которого я записываю в поле класса (управляемого), далее, я хочу перегрузить оператор <code>&amp;</code> для возможности извлечь адрес указателя, который записан в поле (не адрес управляемого класса). При этом для того что бы не было утечек памяти, и пользователи не могли изменять данное поле, которое нельзя изменять извне/внутри класса. Он должен быть единый на весь жизненный цикл класса.</p>

<p>Ничего не понимаю, если я перегрузил оператор <code>&amp;</code> в библиотеке <a href="/questions/tagged/c%2b%2b-cli" class="post-tag" title="показать вопросы с меткой [c++-cli]" rel="tag">c++-cli</a>, то почему при попытке извлечь реальный адрес указателя, значение которого закрыто от внешнего доступа <em>(нативного указателя <code>void*</code>)</em>, <a href="/questions/tagged/c%23" class="post-tag" title="показать вопросы с меткой [c#]" rel="tag">c#</a> мне вдруг говорит:</p>

<blockquote>
  <p>Не удается получить адрес, определить размер или объявить указатель на управляемый тип ("vlc_instance").</p>
</blockquote>

<p>Пример класса:</p>

<pre><code>public ref class SomePtr
{
private:
    void* m_hide_ptr_;
    SomePtr(): m_hide_ptr_(nullptr)
    {
        m_hide_ptr = get_native_ptr(); // Не указатель на управляемый объект!
    }
    // static // Оставим static на всякий, вдруг кто подумает что что-то не то
    void*&amp; operator &amp;(const SomePtr^ value)
    {
        return value-&gt;m_hide_ptr_;
    }
    ...
}
</code></pre>

<p>Неужели перегрузка оператора тут не поможет?</p>
