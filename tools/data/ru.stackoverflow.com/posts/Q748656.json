{"tags":["c#","реестр","прокси","модемы"],"owner":{"reputation":31,"user_id":274967,"user_type":"registered","profile_image":"https://www.gravatar.com/avatar/a35093561807cb8175121fd4801f3a0e?s=128&d=identicon&r=PG&f=1","display_name":"Максим Молчанов","link":"https://ru.stackoverflow.com/users/274967/%d0%9c%d0%b0%d0%ba%d1%81%d0%b8%d0%bc-%d0%9c%d0%be%d0%bb%d1%87%d0%b0%d0%bd%d0%be%d0%b2"},"is_answered":true,"view_count":171,"answer_count":1,"score":2,"last_activity_date":1511718176,"creation_date":1511440557,"last_edit_date":1511581816,"question_id":748656,"link":"https://ru.stackoverflow.com/questions/748656/%d0%a3%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%b8%d1%82%d1%8c-%d0%bf%d1%80%d0%be%d0%ba%d1%81%d0%b8-%d0%b4%d0%bb%d1%8f-%d0%bc%d0%be%d0%b4%d0%b5%d0%bc%d0%b0-%d0%bd%d0%b0-c-%d1%87%d0%b5%d1%80%d0%b5%d0%b7-%d1%80%d0%b5%d0%b5%d1%81%d1%82%d1%80","title":"Установить прокси для модема на C# (через реестр)","body":"<p>Всем здравствуйте! Подскажите пожалуйста как на C# установить прокси не для локальной сети, а для модема.</p>\n\n<p>Для локальной сети делаю так:</p>\n\n<pre><code>string proxy = \"144.217.174.12:8888\";\nRegistryKey reg_key;\nreg_key = Registry.CurrentUser.OpenSubKey(\"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet Settings\", true);\nreg_key.SetValue(\"ProxyEnable\", 1);\nreg_key.SetValue(\"ProxyServer\", proxy);\n</code></pre>\n\n<p>В настройках браузера в результате:</p>\n\n<p><a href=\"https://i.stack.imgur.com/60xTx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/60xTx.png\" alt=\"\"></a></p>\n\n<p>В реестре в разделе <code>HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings</code>:</p>\n\n<p><a href=\"https://i.stack.imgur.com/232Hn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/232Hn.png\" alt=\"\"></a></p>\n\n<p>Как мне сделать тоже самое только для настроек не локальной сети, а модема?Наверное есть раздел реестра, который отвечает за модемы,подскажите его пожалуйста, потому что код вроде бы будет такой же. Или поправьте,если я что-то не так думаю.\nТо есть здесь:</p>\n\n<p><a href=\"https://i.stack.imgur.com/gijhX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/gijhX.png\" alt=\"введите сюда описание изображения\"></a></p>\n\n<p>Мониторил кучу действий, который браузер делает в реестре, при подключении прокси к модему через окно, удалось выделить следующее:</p>\n\n<p><a href=\"https://i.stack.imgur.com/3QhrY.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3QhrY.png\" alt=\"введите сюда описание изображения\"></a></p>\n\n<p>Код на C# работы с InternetSetOption</p>\n\n<pre><code> class Program\n{\n    public struct Struct_INTERNET_PROXY_INFO\n    {\n        public int dwAccessType;\n        public IntPtr proxy;\n        public IntPtr proxyBypass;\n    }\n\n    [DllImport(\"wininet.dll\", SetLastError = true)]\n    private static extern bool InternetSetOption(IntPtr hInternet,int dwOption,IntPtr lpBuffer,int lpdwBufferLength);\n\n    private static void RefreshIESettings(string strProxy)\n    {\n        const int INTERNET_OPTION_PROXY = 38;\n        const int INTERNET_OPEN_TYPE_PROXY = 3;\n\n        Struct_INTERNET_PROXY_INFO struct_IPI;\n\n        struct_IPI.dwAccessType = INTERNET_OPEN_TYPE_PROXY;\n        struct_IPI.proxy = Marshal.StringToHGlobalAnsi(strProxy);\n        struct_IPI.proxyBypass = Marshal.StringToHGlobalAnsi(\"local\");\n\n        IntPtr intptrStruct = Marshal.AllocCoTaskMem(Marshal.SizeOf(struct_IPI));\n        Marshal.StructureToPtr(struct_IPI, intptrStruct, true);\n        InternetSetOption(IntPtr.Zero, INTERNET_OPTION_PROXY, intptrStruct, Marshal.SizeOf(struct_IPI));\n    }\n    static void Main(string[] args)\n    {\n        RefreshIESettings(\"203.142.34.36:52335\");\n    }   \n}\n</code></pre>\n"}