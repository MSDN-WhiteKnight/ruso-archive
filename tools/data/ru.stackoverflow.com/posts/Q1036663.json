{"tags":["c","windows","многопоточность"],"owner":{"reputation":31,"user_id":330678,"user_type":"registered","profile_image":"https://graph.facebook.com/2283141461942567/picture?type=large","display_name":"Ilya  Pakhmutov","link":"https://ru.stackoverflow.com/users/330678/ilya-pakhmutov"},"is_answered":true,"view_count":74,"accepted_answer_id":1036837,"answer_count":1,"score":1,"last_activity_date":1571847741,"creation_date":1571581680,"last_edit_date":1571847741,"question_id":1036663,"link":"https://ru.stackoverflow.com/questions/1036663/%d0%9f%d0%be%d1%87%d0%b5%d0%bc%d1%83-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d1%8f-createthread-%d0%b7%d0%b0%d0%bf%d1%83%d1%81%d0%ba%d0%b0%d0%b5%d1%82-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d1%8e-%d1%81%d1%80%d0%b0%d0%b7%d1%83-%d0%bf%d0%be%d1%81%d0%bb%d0%b5-%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d0%bd%d0%b8%d1%8f","title":"Почему функция CreateThread запускает функцию сразу после создания?","body":"<p>возникла проблема с распараллеливанием вывода на экран консоли:</p>\n\n<p>История: исполнение <code>WriteConsoleOutputW</code> занимает с каждым последующим обновлением занимает все больше времени, при чем размер буфера не меняется. Изначально была идея вынести вывод в отдельный поток, но оно все еще занимает 74-76 мс, что невероятно долго. Последнее что пришло в голову - разделить буфер на несколько частей и выводить их в нескольких потоках.</p>\n\n<pre><code>self-&gt;ThreadPool[0] = CreateThread(\n        NULL,\n        0,\n        &amp;PassToRender1,\n        self,\n        0,\n        &amp;self-&gt;ThreadPoolID[0]);\n\n    self-&gt;ThreadPool[1] = CreateThread(\n        NULL,\n        0,\n        &amp;PassToRender2,\n        self,\n        0,\n        &amp;self-&gt;ThreadPoolID[1]);\n</code></pre>\n\n<pre><code>void _OutputToScreen(struct Window *self)\n{\n    WaitForMultipleObjects(2, self-&gt;ThreadPool, true, INFINITE);\n}\n\nDWORD VTHREAD PassToRender1(struct Window *self)\n{\n    WriteConsoleOutputW(\n        self-&gt;hOut, \n        *self-&gt;ppBuffer, \n        (COORD) { (short)self-&gt;Width, (short)self-&gt;Height/2 }, \n        (COORD) { 0, 0 }, \n        &amp;self-&gt;rWindowRect\n    );\n}\nDWORD VTHREAD PassToRender2(struct Window *self)\n{\n    SMALL_RECT rect = self-&gt;rWindowRect;\n    rect.Top = rect.Bottom / 2;\n\n    WriteConsoleOutputW(\n        self-&gt;hOut,\n        *self-&gt;ppBuffer,\n        (COORD) { (short)self-&gt;Width, (short)self-&gt;Height/2 }, \n        (COORD) { 0, (short)self-&gt;Height / 2 }, \n        &amp;rect\n    );\n}\n</code></pre>\n\n<p>Однако как я выяснил <code>CreateThread</code> запускает функции сразу после создания, а я бы хотел, чтобы я мог обращаться к потокам по вызову функций, при том не пересоздавая потоки, что дорого по времени. </p>\n\n<p>Есть ли какие-нибудь варианты как сделать запуск по вызову?</p>\n\n<p>Дополнение: Вот что я рендерю\n<a href=\"https://i.stack.imgur.com/z4ni7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/z4ni7.png\" alt=\"введите сюда описание изображения\"></a></p>\n"}