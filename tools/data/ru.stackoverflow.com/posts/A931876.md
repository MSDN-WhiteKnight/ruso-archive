---
title: "Answer 931876"
se.owner.user_id: 17974
se.owner.display_name: "nick_n_a"
se.owner.link: "https://ru.stackoverflow.com/users/17974/nick-n-a"
se.answer_id: 931876
se.question_id: 931706
se.post_type: answer
se.score: 2
se.is_accepted: False
---
<p>Для вставки текста RTF в шаблон я использовал такое приведение</p>

<pre><code>  public static string toRTF(string value)
        {  /*Конвертирует текст, в текст пригодный для RTF документа */
            //                                                                                                             FF
            string syms = @"ЎўЈЈ¤Ґ¦§Ё©Є«¬­®Ї°±Ііґµ¶•ё№є»јЅѕїАБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдежзийклмнопрстуфхцчшщъыьэюя";                      
            string rep_1 = @"0123456789abcdef";
            int j = 0;
            int k = 0;
            while (j &lt; value.Length)
            {
                if (syms.IndexOf(value[j]) &gt;= 0)
                {
                    k = syms.IndexOf(value[j]);
                    value = value.Replace(value[j].ToString(), "\\'" + rep_1[(k / 16) + 10].ToString() + rep_1[k &amp; 15].ToString());
                };
                j++;
            };
            value = value.Replace("\\n", "\\par;");
            return value;
        }
</code></pre>

<p>Да.. пожалуй хранить и копировать таблицу сложно... вариант 2 - без таблицы</p>

<pre><code>  public static string toRTF(string value)
        {  /*Конвертирует текст, в текст пригодный для RTF документа */
            byte[] t = new byte[1];
            int j = 0;                
            while (j &lt; value.Length)
            {
                if (value[j] &gt;= '\x7F')
                {
                    System.Text.Encoding.GetEncoding(1251).GetBytes(value,j,1,t,0);                      
                    value = value.Replace(value[j].ToString(), "\\'" + t[0].ToString('x'));
                };
                j++;
            };
            value = value.Replace("\\n", "\\par;");
            return value;
        }
</code></pre>

<p>Т.е. буква я маленькая имеет код  <code>\'FF</code>. Плюс... шаблон должен содержать метку 1251, т.е. в файле с поддержкой 1251 заголовок должен быть такой</p>

<pre><code> {\rtf1\adeflang1025\ansi\ansicpg1251\
</code></pre>

<p>Еще я заменяю возврат каретки на <code>\par;</code> потому что текст так переносится в rtf. </p>

<p>Текст можно вообще не преобразовывать, оставить как есть и лишь перенести в кодировку 1251, если есть уверенность, что ваш файл будут открывать исключительно в среде windows. Некоторые "неродные" редакторы не понимают файлы без указанного перевода.</p>

<p>P.S. RTF не самый простой формат, не могу рассказать подробно о его деталях. Приведенный код использую в одном из проэктов. Преобразование в heх можно реализовать лучше.. но так уже получилось - не само оптимально. В вики внизу есть ссылка на спецификацию <a href="http://ru.wikipedia.org/wiki/Rich_Text_Format" rel="nofollow noreferrer">http://ru.wikipedia.org/wiki/Rich_Text_Format</a>, если есть сложности - думаю спецификацикация даст ответ на ваши вопросы.</p>
