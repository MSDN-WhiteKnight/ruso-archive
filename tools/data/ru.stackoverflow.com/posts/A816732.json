{"owner":{"reputation":16058,"user_id":240512,"user_type":"registered","profile_image":"https://i.stack.imgur.com/Ew6lG.png?s=128&g=1","display_name":"MSDN.WhiteKnight","link":"https://ru.stackoverflow.com/users/240512/msdn-whiteknight"},"is_accepted":false,"score":1,"last_activity_date":1524203594,"creation_date":1524203594,"answer_id":816732,"question_id":54856,"body":"<p>Для отключения сетевого адаптера можно использовать Setup API (требует привилегий администратора, не работает из-под WOW64):</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;locale.h&gt;\n#include &lt;stdio.h&gt;\n\n#include &lt;Windows.h&gt;\n#include &lt;SetupAPI.h&gt;\n#define INITGUID\n#include &lt;Devpkey.h&gt;\n#include &lt;devguid.h&gt;\n\n#pragma comment(lib,\"Setupapi.lib\")\n\nvoid ErrorMes(LPTSTR lpszFunction) \n{ \n    // Retrieve the system error message for the last-error code\n\n    LPVOID lpMsgBuf;\n    LPVOID lpDisplayBuf;\n    DWORD dw = GetLastError(); \n\n    FormatMessage(\n        FORMAT_MESSAGE_ALLOCATE_BUFFER | \n        FORMAT_MESSAGE_FROM_SYSTEM |\n        FORMAT_MESSAGE_IGNORE_INSERTS,\n        NULL,\n        dw,\n        MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),\n        (LPTSTR) &amp;lpMsgBuf,\n        0, NULL );\n\n    // Display the error message\n\n    lpDisplayBuf = (LPVOID)LocalAlloc(LMEM_ZEROINIT, \n        (lstrlen((LPCTSTR)lpMsgBuf) + lstrlen((LPCTSTR)lpszFunction) + 40) * sizeof(TCHAR)); \n    wprintf(L\"%s failed with error %d: %s\\n\", \n        lpszFunction, dw, lpMsgBuf);     \n\n    LocalFree(lpMsgBuf);\n    LocalFree(lpDisplayBuf);\n}\n\n//* Включает или отключает сетевое соединение *\n//aState: true - включить, false - отключить\n//adapter: имя сетевого адаптера (как в диспетчере устройств)\nvoid EnableConnection(bool aState, wchar_t* adapter)\n{\n    unsigned index;\n    HDEVINFO hDevInfo;\n    SP_DEVINFO_DATA DeviceInfoData;  \n    SP_PROPCHANGE_PARAMS PCHP;\n    TCHAR buf[1024]=L\"\";\n\n    DEVPROPTYPE dpt=0;      \n    BOOL res;\n\n    // Enum all network devices\n    hDevInfo = SetupDiGetClassDevs(&amp;GUID_DEVCLASS_NET, 0, 0, DIGCF_PRESENT);\n    for (index = 0; ; index++) {\n        DeviceInfoData.cbSize = sizeof(DeviceInfoData);\n        if (!SetupDiEnumDeviceInfo(hDevInfo, index, &amp;DeviceInfoData)) {         \n           break;     \n        }\n\n        res=SetupDiGetDeviceProperty(hDevInfo,&amp;DeviceInfoData,\n                        &amp;DEVPKEY_Device_DeviceDesc,&amp;dpt,(PBYTE)buf,1000,NULL,0);//name              \n        if(res==FALSE){ErrorMes(L\"SetupDiGetDeviceProperty\");continue;}\n\n        if(wcscmp(buf,adapter)==0){//device found\n\n            PCHP.ClassInstallHeader.cbSize = sizeof(SP_CLASSINSTALL_HEADER);\n\n            if (SetupDiSetClassInstallParams(hDevInfo,&amp;DeviceInfoData,&amp;PCHP.ClassInstallHeader,sizeof(SP_PROPCHANGE_PARAMS)))\n            {\n                PCHP.ClassInstallHeader.cbSize = sizeof(SP_CLASSINSTALL_HEADER);\n                PCHP.ClassInstallHeader.InstallFunction = DIF_PROPERTYCHANGE;\n                PCHP.HwProfile = 0;\n                PCHP.Scope = DICS_FLAG_CONFIGSPECIFIC;\n                if (aState) PCHP.StateChange = DICS_ENABLE;\n                else  PCHP.StateChange = DICS_DISABLE;\n                SetupDiSetClassInstallParams(hDevInfo,&amp;DeviceInfoData,&amp;PCHP.ClassInstallHeader,sizeof(SP_PROPCHANGE_PARAMS));\n\n                if(SetupDiCallClassInstaller(DIF_PROPERTYCHANGE,hDevInfo,&amp;DeviceInfoData)==0)\n                {\n                    ErrorMes(L\"SetupDiCallClassInstaller\");\n                    if(GetLastError()==ERROR_DI_POSTPROCESSING_REQUIRED)wprintf(L\"ERROR_DI_POSTPROCESSING_REQUIRED\\n\");\n                    if(GetLastError()==ERROR_IN_WOW64)wprintf(L\"SetupDiCallClassInstaller не работает из WOW64\\n\");\n                }\n                else\n                    wprintf(L\"Состояние адаптера успешно изменено.\\n\");\n            }\n            else ErrorMes(L\"SetupDiSetClassInstallParams\");\n            break;\n        }\n    }\n\n    SetupDiDestroyDeviceInfoList(hDevInfo);    \n}\n\n\nint main(void)\n{       \n    setlocale(LC_ALL,\"Russian\");    \n\n    EnableConnection(false,L\"Realtek PCIe GBE Family Controller\");      \n\n    system(\"PAUSE\");    \n    return 0;\n}\n</code></pre>\n\n<p>Для отключения dial-up соединения - функцию <a href=\"https://msdn.microsoft.com/ru-ru/library/windows/desktop/aa377567(v=vs.85).aspx\" rel=\"nofollow noreferrer\">RasHangUp</a></p>\n"}