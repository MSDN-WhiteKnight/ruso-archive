{"tags":["c#","winforms","ms-word"],"owner":{"reputation":331,"user_id":238820,"user_type":"registered","profile_image":"https://www.gravatar.com/avatar/4ff734695595a9d145796e304441a844?s=128&d=identicon&r=PG&f=1","display_name":"olga","link":"https://ru.stackoverflow.com/users/238820/olga"},"is_answered":true,"view_count":235,"answer_count":1,"score":6,"last_activity_date":1528833858,"creation_date":1526976126,"last_edit_date":1528258467,"question_id":831556,"link":"https://ru.stackoverflow.com/questions/831556/%d0%9a%d0%be%d0%b4-%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d0%bd%d0%b8%d1%8f-%d0%b4%d0%be%d0%ba%d1%83%d0%bc%d0%b5%d0%bd%d1%82%d0%b0-word-%d0%b2%d1%8b%d0%b7%d1%8b%d0%b2%d0%b0%d0%b5%d1%82-%d0%be%d1%88%d0%b8%d0%b1%d0%ba%d1%83-%d0%bf%d1%80%d0%be%d0%b2%d0%be%d0%b4%d0%bd%d0%b8%d0%ba%d0%b0-explorer-exe","title":"Код создания документа word вызывает ошибку проводника explorer.exe","body":"<p>Мой код (c# winforms vs2010) после закрытия вызывает появление ошибки проводника \"explorer.exe\" (на компьютерах с winxp и win7):</p>\n\n<p>Подскажите пожалуйста, из-за чего может возникать ошибка проводника?\nПривожу фрагмент кода:</p>\n\n<pre><code>    private void btn_Click(object sender, EventArgs e)\n        {\n            Word.Application word = null;\n            Word.Documents docs = null;\n            Word.Document doc = null;\n            Word.Table oTable1 = null;\n            Word.Table oTable = null;\n            Word.Range oRange = null;\n            Word.Paragraph oParag = null;\n            Word.Paragraph oPara2 = null;\n            Word.Template oTpl = null;\n\n            try\n            {\n                if (Process.GetProcessesByName(\"WINWORD\").Length == 0)\n                {\n                    word = new Word.Application();\n                }\n                else\n                {\n                    word = (Word.Application)System.Runtime.InteropServices.Marshal.GetActiveObject(\"Word.Application\");\n                }\n\n                word.Visible = true;\n                word.WindowState = Word.WdWindowState.wdWindowStateMinimize;\n\n                docs = (Word.Documents)word.Documents;\n                object templateName = @\"c:\\a3.dot\";\n                object missing = Type.Missing;\n                object openVisible = true;\n                object documentType = Word.WdDocumentType.wdTypeDocument;\n                doc = docs.Add(ref templateName, ref missing, ref documentType, ref openVisible);\n                doc.ActiveWindow.WindowState = Word.WdWindowState.wdWindowStateMinimize;\n\n                waitForm = new Form4();\n                waitForm.TopMost = true;\n                waitForm.StartPosition = FormStartPosition.CenterParent;\n                waitForm.Show();\n                if (waitForm.StartPosition == FormStartPosition.CenterParent)\n                {\n                    var x = Location.X + (Width - waitForm.Width) / 2;\n                    var y = Location.Y + (Height - waitForm.Height) / 2;\n                    waitForm.Location = new Point(Math.Max(x, 0), Math.Max(y, 0));\n                }\n                waitForm.Refresh();\n\n//........\n\n                object oRngEnd = word.Selection.GoTo(Word.WdGoToItem.wdGoToLine, Word.WdGoToDirection.wdGoToLast);\n                object oAutoText = \"table\";\n                object objTrue = true;\n                oTpl = (Word.Template)doc.get_AttachedTemplate();\n                oPara2 = doc.Paragraphs.Add(oRngEnd);\n                oPara2.Range.Text = \"\";\n                oPara2.Range.Font.Size = 11;\n                doc.Paragraphs.Add(oRngEnd);\n                doc.Paragraphs.Add(oRngEnd);\n                doc.Paragraphs.Add(oRngEnd);\n                doc.Paragraphs.Add(oRngEnd);\n                oPara2.Range.Select();\n                oTpl.AutoTextEntries.get_Item(ref oAutoText).Insert(word.Selection.Range, ref objTrue);\n\n                word.Selection.GoTo(Word.WdGoToItem.wdGoToLine, Word.WdGoToDirection.wdGoToFirst);\n\n                object oTemplate_null = \"\";\n                doc.set_AttachedTemplate(oTemplate_null);\n\n                doc.ActiveWindow.View.DisplayPageBoundaries = true;\n                doc.ActiveWindow.ActivePane.View.Zoom.PageFit = Word.WdPageFit.wdPageFitBestFit;\n                doc.ActiveWindow.WindowState = Word.WdWindowState.wdWindowStateMaximize;\n\n                waitForm.Close();\n\n                doc.Activate();\n                word.Activate();\n            }\n            catch\n            {\n                waitForm.Close();\n\n                if (oTpl != null) Marshal.FinalReleaseComObject(oTpl); oTpl = null;\n                if (oPara2 != null) Marshal.FinalReleaseComObject(oPara2); oPara2 = null;\n                if (oParag != null) Marshal.FinalReleaseComObject(oParag); oParag = null;\n                if (oRange != null) Marshal.FinalReleaseComObject(oRange); oRange = null;\n                if (oTable != null) Marshal.FinalReleaseComObject(oTable); oTable = null;\n                if (oTable1 != null) Marshal.FinalReleaseComObject(oTable1); oTable1 = null;\n                if (doc != null) Marshal.FinalReleaseComObject(doc); doc = null;\n                if (docs != null) Marshal.FinalReleaseComObject(docs); docs = null;\n                if (word != null) Marshal.FinalReleaseComObject(word); word = null;\n\n                return;\n            }\n            finally\n            {\n                if (oTpl != null) Marshal.FinalReleaseComObject(oTpl); oTpl = null;\n                if (oPara2 != null) Marshal.FinalReleaseComObject(oPara2); oPara2 = null;\n                if (oParag != null) Marshal.FinalReleaseComObject(oParag); oParag = null;\n                if (oRange != null) Marshal.FinalReleaseComObject(oRange); oRange = null;\n                if (oTable != null) Marshal.FinalReleaseComObject(oTable); oTable = null;\n                if (oTable1 != null) Marshal.FinalReleaseComObject(oTable1); oTable1 = null;\n                if (doc != null) Marshal.FinalReleaseComObject(doc); doc = null;\n                if (docs != null) Marshal.FinalReleaseComObject(docs); docs = null;\n                if (word != null) Marshal.FinalReleaseComObject(word); word = null;\n            }\n\n        }\n</code></pre>\n\n<p>Ошибка стала возникать после добавления в приложение работы с Word</p>\n\n<p>Скриншот ошибки:</p>\n\n<p><a href=\"https://i.stack.imgur.com/OEceB.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/OEceB.png\" alt=\"введите сюда описание изображения\"></a></p>\n\n<p>Сведения:</p>\n\n<blockquote>\n  <p>Сигнатура проблемы:<br>\n  Имя события проблемы: APPCRASH<br>\n  Имя приложения: Explorer.EXE<br>\n  Версия приложения: 6.1.7601.17514<br>\n  Отметка времени приложения: 4ce7a144<br>\n  Имя модуля с ошибкой: ntdll.dll<br>\n  Версия модуля с ошибкой: 6.1.7601.18247<br>\n  Отметка времени модуля с ошибкой: 521eaf24<br>\n  Код исключения: c0000005<br>\n  Смещение исключения: 0000000000028389<br>\n  Версия ОС: 6.1.7601.2.1.0.256.48<br>\n  Код языка: 1049<br>\n  Дополнительные сведения 1: 0056<br>\n  Дополнительные сведения 2: 00565d7ce61ebbab216279960a6dd5b6<br>\n  Дополнительные сведения 3: 2480<br>\n  Дополнительные сведения 4: 2480f0afc22eea9532586bc57f7117f6</p>\n</blockquote>\n"}