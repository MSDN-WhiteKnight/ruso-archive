{"tags":["c#",".net","com","ms-access","office-interop"],"owner":{"reputation":22868,"user_id":32793,"user_type":"registered","accept_rate":48,"profile_image":"https://i.stack.imgur.com/6Vktl.jpg?s=128&g=1","display_name":"iluxa1810","link":"https://ru.stackoverflow.com/users/32793/iluxa1810"},"is_answered":true,"view_count":251,"answer_count":1,"score":8,"last_activity_date":1530269379,"creation_date":1472638663,"last_edit_date":1517473274,"question_id":561357,"link":"https://ru.stackoverflow.com/questions/561357/%d0%9a%d0%b0%d0%ba-%d0%b2%d1%8b%d0%bf%d0%be%d0%bb%d0%bd%d0%b8%d1%82%d1%8c-%d0%a1%d0%b6%d0%b0%d1%82%d0%b8%d0%b5-%d0%b8-%d0%b2%d0%be%d1%81%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-access-%d0%b1%d0%b0%d0%b7%d1%8b-%d1%87%d0%b5%d1%80%d0%b5%d0%b7-interop","title":"Как выполнить Сжатие и восстановление Access базы через Interop?","body":"<p>Как выполнить Сжатие и восстановление <strong>Access</strong> базы через <code>Interop</code>?</p>\n\n<p>Есть класс, который содержит метод:</p>\n\n<pre><code>public bool TryCompactAndRepair()\n{\n    string pathToDb = app.CurrentDb().Name;\n    string pathToCompact = Path.Combine(Path.GetDirectoryName(pathToDb), \n        Path.GetFileNameWithoutExtension(pathToDb)) + \n        \"_compact\" + Path.GetExtension(pathToDb);\n\n    db.Close();\n    app.CloseCurrentDatabase();\n    //   Marshal.ReleaseComObject(db);\n    GC.Collect();\n    if (app.CompactRepair(pathToDb, pathToCompact, true))\n    {\n        File.Delete(pathToDb);\n        File.Move(pathToCompact, pathToDb);\n        return true;\n    }\n    else\n    {\n        File.Delete(pathToCompact);\n    }\n    return false;\n}\n</code></pre>\n\n<p>переменная <code>app</code> имеет тип <code>Application</code>.</p>\n\n<p>Почему-то такой метод возвращает различные ошибки:</p>\n\n<ol>\n<li><p>В текущем виде, что-то вроде <em>\"Object no longer set\"</em></p></li>\n<li><p>Если раскоментить <code>Marshal.ReleaseComObject(db);</code> ,то получаю ошибку, что доступ к объекту не доступен.</p></li>\n<li><p>Если вообще не делать Close, то вылетает ошибка, что нельзя сделать сжатие для текущей БД.</p></li>\n</ol>\n\n<p>Подскажите, в чем косяк?</p>\n"}