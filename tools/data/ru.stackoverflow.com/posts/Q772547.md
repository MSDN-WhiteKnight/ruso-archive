---
title: "c#. System.Windows.Forms.WebBrowser и код текста для IFrame"
se.owner.user_id: 193306
se.owner.display_name: "Sergej Loos"
se.owner.link: "https://ru.stackoverflow.com/users/193306/sergej-loos"
se.link: "https://ru.stackoverflow.com/questions/772547/c-system-windows-forms-webbrowser-%d0%b8-%d0%ba%d0%be%d0%b4-%d1%82%d0%b5%d0%ba%d1%81%d1%82%d0%b0-%d0%b4%d0%bb%d1%8f-iframe"
se.question_id: 772547
se.post_type: question
se.score: 1
---
<p>Использую стандартный System.Windows.Forms.WebBrowser для загрузки и отображения одной вебстраницы. WebBrowser эмулирует 11 версию IE. Страница имеет IFrame и отображается нормально.</p>

<p>Мне необходимо получить полный HTML код страницы с содержимым IFrame, но эти элементы пусты. В полноценном IE html-код можно видеть. Текст кода пробую получать следующими двумя способами:</p>

<pre><code>public String HtmlDocumentText {
  get { return webBrowser.DocumentText; }
}

public String DomDocumentText {
  get {
  // REM. http://stackoverflow.com/questions/3640236/converting-htmldocument-domdocument-to-string
  var document = webBrowser.Document;
  var documentAsIHtmlDocument3 = (mshtml.IHTMLDocument3)document.DomDocument;
  var content = documentAsIHtmlDocument3.documentElement.outerHTML;
  return content;
  }
}
</code></pre>

<p>Мне кажется, что проблема заключается в ограничениях безопасности для этого элемента, потому как следующий код вызывает ошибку доступа:</p>

<pre><code>var frames = webBrowser.DocumentTestToDelete.Window.Frames;
var frame1 = webBrowser.DocumentTestToDelete.Window.Frames[0];
var document1 = frame1.Document;
</code></pre>

<p>Ошибка:
    Access Denied (Exception from HRESULT: 0x80070005 (E_ACCESSDENIED)).</p>

<p>Замечу, что мне удалось получить код IFrames при помощи JavaScript:</p>

<pre><code>string jCode = "var iframe = document.getElementById('frame-id'); var innerDoc = iframe.contentDocument || iframe.contentWindow.document; innerDoc.documentElement.innerHTML";
Object html = webBrowser.WebBrowser.Document.InvokeScript("eval", new object[] { jCode });
</code></pre>

<p>Но это не то что надо, хотя я мог бы такой подход использовать, но с большими трудозатратами. Может быть есть способ заставить WebControl отдавать полный html вместе с содержимым IFrame?</p>
