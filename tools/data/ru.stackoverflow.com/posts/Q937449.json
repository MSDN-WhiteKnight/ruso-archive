{"tags":["c#","wpf"],"owner":{"reputation":329,"user_id":309995,"user_type":"registered","profile_image":"https://lh5.googleusercontent.com/-joAlFwRbf8k/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaOi4Mq-jhG6hFZH0z3pzkz8itgcIQ/mo/photo.jpg?sz=128","display_name":"Павел Ериков","link":"https://ru.stackoverflow.com/users/309995/%d0%9f%d0%b0%d0%b2%d0%b5%d0%bb-%d0%95%d1%80%d0%b8%d0%ba%d0%be%d0%b2"},"is_answered":true,"view_count":124,"accepted_answer_id":937988,"answer_count":1,"score":1,"last_activity_date":1548740546,"creation_date":1548617561,"last_edit_date":1548740458,"question_id":937449,"link":"https://ru.stackoverflow.com/questions/937449/%d0%92%d1%8b%d0%b2%d0%be%d0%b4-%d0%bf%d1%83%d1%82%d0%b5%d0%b9-%d0%bd%d0%b5%d1%81%d0%ba%d0%be%d0%bb%d1%8c%d0%ba%d0%b8%d1%85-%d0%b2%d1%8b%d0%b4%d0%b5%d0%bb%d0%b5%d0%bd%d0%bd%d1%8b%d1%85-%d1%84%d0%b0%d0%b9%d0%bb%d0%be%d0%b2-%d0%b2-%d0%bf%d1%80%d0%be%d0%b2%d0%be%d0%b4%d0%bd%d0%b8%d0%ba%d0%b5-%d1%87%d0%b5%d1%80%d0%b5%d0%b7-%d0%bf%d1%80%d0%be%d0%b3%d1%80%d0%b0%d0%bc%d0%bc%d1%83-c","title":"Вывод путей нескольких выделенных файлов в проводнике через программу C#","body":"<p>Я бы хотел, чтобы когда ты выделяешь несколько например фотографий в проводнике и нажимаешь \"Открыть\", то открывалась бы программа, в которой можно было бы работать с информацией об этих файлах.</p>\n\n<p>Пытался уже реализовать такое, но выделив несколько файлов открывалось несколько окон программы.</p>\n\n<p>Сделал небольшую доработку </p>\n\n<p>App.xaml.cs</p>\n\n<pre><code>[DllImport(\"user32.dll\")]\npublic static extern IntPtr SendMessage(IntPtr hWnd, uint Msg, IntPtr wParam, ref COPYDATASTRUCT lParam);\n\n[StructLayout(LayoutKind.Sequential)]\npublic struct COPYDATASTRUCT\n{\n    public IntPtr dwData;\n    public int cbData;\n    public IntPtr lpData;\n}\npublic const uint WM_COPYDATA = 0x004A;\n\nprotected override void OnStartup(StartupEventArgs e)\n{\n    base.OnStartup(e);\n    Process this_process = Process.GetCurrentProcess();\n\n    Process[] other_processes =\n    Process.GetProcessesByName(this_process.ProcessName).Where(pr =&gt; pr.Id != this_process.Id).ToArray();\n\n    foreach (var pr in other_processes)\n    {\n         pr.WaitForInputIdle(1000);\n         IntPtr hWnd = pr.MainWindowHandle;\n         if (hWnd == IntPtr.Zero) continue;\n         string command = e.Args[0] + \" \" + e.Args.Length;\n         var cds = new COPYDATASTRUCT();\n         cds.dwData = (IntPtr)1;\n         cds.cbData = (command.Length + 1) * 2;\n         cds.lpData = Marshal.StringToHGlobalUni(command);\n         SendMessage(hWnd, WM_COPYDATA, IntPtr.Zero, ref cds);\n         Marshal.FreeHGlobal(cds.lpData);\n         Environment.Exit(0);\n    }\n}    \n</code></pre>\n\n<p>И MainWindow.xaml.cs</p>\n\n<pre><code>private IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)\n{\n     if (msg == WM_COPYDATA)\n     {\n         COPYDATASTRUCT data = new COPYDATASTRUCT();\n         data = (COPYDATASTRUCT)Marshal.PtrToStructure(lParam, data.GetType());\n         MessageBox.Show(\"Received command: \" + Marshal.PtrToStringUni(data.lpData));\n     }\n\n     return IntPtr.Zero;\n}\nprivate void Window_Loaded(object sender, RoutedEventArgs e)\n{\n     WindowInteropHelper h = new WindowInteropHelper(this);\n     HwndSource source = HwndSource.FromHwnd(h.Handle);\n     source.AddHook(new HwndSourceHook(WndProc));//регистрируем обработчик сообщений      \n}\n</code></pre>\n\n<p>И все хорошо в принципе, т.к. когда я кликаю по картинке (при открытом окне программы) то выводится в MessageBox.Show ее путь. Но проблема теперь в том, что если я выберу несколько картинок и нажму открыть то раньше бы открылось столько экземпляров сколько картинок. А сейчас MessageBox.Show выведет только путь той картинки которая была выбрана первой.</p>\n"}