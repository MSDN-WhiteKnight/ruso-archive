{"tags":["c#","c++","dll"],"owner":{"reputation":59,"user_id":196672,"user_type":"registered","profile_image":"https://i.stack.imgur.com/px3UG.jpg?s=128&g=1","display_name":"koly86","link":"https://ru.stackoverflow.com/users/196672/koly86"},"is_answered":true,"view_count":57,"answer_count":1,"score":1,"last_activity_date":1551327543,"creation_date":1551134581,"last_edit_date":1551280834,"question_id":949439,"link":"https://ru.stackoverflow.com/questions/949439/%d0%9a%d0%be%d0%bd%d0%b2%d0%b5%d1%80%d1%82%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d1%82%d1%8c-bstr-retval-%d1%87%d1%82%d0%be-%d0%b1%d1%8b-%d0%b2%d1%8b%d0%b2%d0%b5%d1%81%d1%82%d0%b8-string-%d0%b2-printf","title":"Конвертировать BSTR* retVal что бы вывести string в printf","body":"<p>на шарпе написана DLL вызывается в С++, в DLL передаю строку и обратно должен получить строку, но как ее вывести на экран. </p>\n\n<p>строчка </p>\n\n<pre><code>printf(\"%s\\n\", retVal); //not working\n</code></pre>\n\n<p>С++ проект</p>\n\n<pre><code>int main() {\n    CoInitialize(NULL);   //Initialize all COM Components\n    MyInterop::IMyDotNetInterfacePtr pDotNetCOMPtr;\n    HRESULT hRes =\n            pDotNetCOMPtr.CreateInstance(MyInterop::CLSID_MyDotNetClass);\n    if (hRes == S_OK) {\n        BSTR str;\n        BSTR* retVal = NULL;\n        _bstr_t bstr1(\"This is the test string.\");\n\n        BSTR bstr;\n\n        bstr = bstr1.copy();\n        pDotNetCOMPtr-&gt;ShowCOMDialog();\n        pDotNetCOMPtr-&gt;ComeToMe(bstr, retVal);\n        printf(\"%s\\n\", retVal); //not working\n        //call .NET COM exported function ShowDialog ()\n    }\n    CoUninitialize();\n    return 0;\n}\n</code></pre>\n\n<p>С# DLL</p>\n\n<pre><code>public string ComeToMe(string str) {\n    System.Windows.Forms.MessageBox.Show(str);\n    switch (str) {\n        case \"Hi\":\n            return \"Hi world\";\n            break;\n    }\n\n    return \"Nothing to Show\";\n}\n</code></pre>\n"}