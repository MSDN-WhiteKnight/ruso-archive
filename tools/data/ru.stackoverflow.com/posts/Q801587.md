---
title: "Побайтная запись данных в структуру С#"
se.owner.user_id: 290522
se.owner.display_name: "Igor Kassir"
se.owner.link: "https://ru.stackoverflow.com/users/290522/igor-kassir"
se.link: "https://ru.stackoverflow.com/questions/801587/%d0%9f%d0%be%d0%b1%d0%b0%d0%b9%d1%82%d0%bd%d0%b0%d1%8f-%d0%b7%d0%b0%d0%bf%d0%b8%d1%81%d1%8c-%d0%b4%d0%b0%d0%bd%d0%bd%d1%8b%d1%85-%d0%b2-%d1%81%d1%82%d1%80%d1%83%d0%ba%d1%82%d1%83%d1%80%d1%83-%d0%a1"
se.question_id: 801587
se.post_type: question
se.score: 2
---
<p>Есть структура данных (С#) необходимо принимая данные из SerialPort записать их в  структуру побайтно.</p>

<p>Код объявления структуры (VS2010)
Структура упакована побайтно, размер соответствует. </p>

<p>:</p>

<p>// ------------------ telemetry data structures</p>

<pre><code>    [StructLayout(LayoutKind.Sequential, Pack = 1)]
    public struct BMS //  BMS telemetry data
    {
        public ushort voltage;
        public short current;
        public sbyte temperature;
        public byte status;
    }

    [StructLayout(LayoutKind.Sequential, Pack = 1)]
    public struct MOTOR //  Traction MOTOR telemetry data
    {
        sbyte acceleration;
        short current;
        short speed;
        sbyte motor_temp;
        sbyte controller_temp;
        byte status;
    }

    [StructLayout(LayoutKind.Sequential, Pack = 1)]
    public struct GENERATOR //  Gasoline GENERATOR telemetry data
    {
        byte fuel_level;
        short speed; 
        short current;
        ushort voltage;
        sbyte motor_temp;
        sbyte generator_temp;
        sbyte controller_temp;
        byte status;
    }

    [StructLayout(LayoutKind.Sequential, Pack = 1)]
    public struct CABLE_REEL //  CABLE REEL telemetry data
    {
        sbyte force;
        short speed;
        sbyte motor_temp;
        sbyte controller_temp;
        byte status;
    }

    [StructLayout(LayoutKind.Sequential, Pack = 1)]
    public struct UTP_TELEMETRY // UTP-1 telemetry packet struct
    {
        public BMS bms1;
        public BMS bms2;
        public MOTOR left_motor;
        public MOTOR right_motor;
        public GENERATOR generator;
        public CABLE_REEL reel;
    }

    //UTP_TELEMETRY packet;

    int packet_data_len = Marshal.SizeOf(typeof(UTP_TELEMETRY));  // number of bytes for data (45 bytes at the moment)

    // defines exactly as union in C++

    [StructLayout(LayoutKind.Explicit, Size=45)]
    public struct UNION_BUFF
    {
        [FieldOffset(0)]
        public byte buff;
        //public byte[] buff;

        [FieldOffset(0)]
        public UTP_TELEMETRY data_packet;
    }

   public UNION_BUFF data_buffer;
</code></pre>

<p>проект unsafe, разные способы испытал, но не знаю тонкостей работы с указателями С#, ничего не получается. пробовал запись по указателю, по индексу buff[index], еще несколько разных идей и все никак.
Как необходимо организовать запись побайтно в данную структуру?</p>
