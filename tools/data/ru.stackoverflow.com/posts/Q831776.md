---
title: "c#. Winforms. Single-Instance и активация окна при повторном запуске"
se.owner.user_id: 193306
se.owner.display_name: "Sergej Loos"
se.owner.link: "https://ru.stackoverflow.com/users/193306/sergej-loos"
se.link: "https://ru.stackoverflow.com/questions/831776/c-winforms-single-instance-%d0%b8-%d0%b0%d0%ba%d1%82%d0%b8%d0%b2%d0%b0%d1%86%d0%b8%d1%8f-%d0%be%d0%ba%d0%bd%d0%b0-%d0%bf%d1%80%d0%b8-%d0%bf%d0%be%d0%b2%d1%82%d0%be%d1%80%d0%bd%d0%be%d0%bc-%d0%b7%d0%b0%d0%bf%d1%83%d1%81%d0%ba%d0%b5"
se.question_id: 831776
se.post_type: question
se.score: 4
---
<p>Разрабоатываю WinForms  приложение как Single-Instance. При первом вызове запускается как бы «Ядро» приложения, которое затем создает и отображает определенное окно. При последующем запуске приложение проверяет, запущено ли уже приложение и в положительном случае посылает сообщение ядру, передает ему опредленные данные и закрывается. Ядро получает сообщение с параметром, обрабатывает его пределенным образом и создает новую форму и ее оторбражает.
Реализаций подобного есть несколько. Я ипользовал мютексы для проверки существования запущенного приложения и данные передаю при помощи именованных pipes (также пробовал с Remoting). Но есть одна проблема, которая доставляет большое неудобство, а именно, вторая инстанция приложения не получает фокус ввода. Чего я уже только не пробовал, приложение при актвации лишь мигает в таскбаре, а фокус ввода находится там, откуда оно было вызвано.</p>

<p>Я уже и с виндовc API игрался, никак не выходит. Например вызов SetForegroundWindow(HandleRef hWnd) возвращает False. И ничего нельзя сделать.</p>

<p>Как можно решить задачу?</p>

<hr>

<p>Добавление:</p>

<p>Если кто-то захочет помочь, как базис можно использовать например вот эту статью и код. Хотя я использую несколько другой подход, в этом приложении тоже проявляется описанная мною проблема: </p>

<p><a href="http://blogs.microsoft.co.il/maxim/2010/02/13/single-instance-application-manager/" rel="nofollow noreferrer">http://blogs.microsoft.co.il/maxim/2010/02/13/single-instance-application-manager/</a></p>

<p>Просто запускайте приложение из файлового проводника при помощи "Enter", и увидете что фокус ввода при повторном запуске остается в проводнике. Экспериментировать, как я понимаю, нужно здесь:</p>

<pre><code>private static void SingleInstanceCallback(object sender, InstanceCallbackEventArgs args)
{
    if (args == null || _mainFrm == null) return;
    Action&lt;bool&gt; d = (bool x) =&gt;
    {
        _mainFrm.ApendArgs(args.CommandLineArgs);
        _mainFrm.Activate(x);
    };
    _mainFrm.Invoke(d, true);
}
</code></pre>
