---
title: "Answer 977604"
se.owner.user_id: 9784
se.owner.display_name: "Zergatul"
se.owner.link: "https://ru.stackoverflow.com/users/9784/zergatul"
se.answer_id: 977604
se.question_id: 977595
se.post_type: answer
se.score: 2
se.is_accepted: True
---
<p>Аналогов нет, так что придется писать самим. Я взял за основу код с ответа, на который вы сослались, и немного доделал его. Там мантисса получается типа лонг потому что внутри бинарного представления там действительно целое чисто стоит на месте мантиссы. В моем коде я дополнительно уменьшаю мантиссу, что бы получить результат согласно спецификации функции <code>frexp</code>:</p>

<pre><code>static void frexp(double value, out double mantissa, out int exponent)
{
    long bits = BitConverter.DoubleToInt64Bits(value);
    bool negative = (bits &amp; (1L &lt;&lt; 63)) != 0;
    exponent = (int)((bits &gt;&gt; 52) &amp; 0x7FFL);
    long mantissaLong = bits &amp; 0xFFFFFFFFFFFFFL;

    if (exponent == 0)
    {
        exponent++;
    }
    else
    {
        mantissaLong = mantissaLong | (1L &lt;&lt; 52);
    }

    exponent -= 1075;

    if (mantissaLong == 0)
    {
        mantissa = 0;
        exponent = 0;
        return;
    }

    while ((mantissaLong &amp; 1) == 0)
    {
        mantissaLong &gt;&gt;= 1;
        exponent++;
    }

    mantissa = mantissaLong;
    while (mantissa &gt;= 1)
    {
        mantissa /= 2;
        exponent++;
    }

    if (negative)
        mantissa = -mantissa;
}
</code></pre>

<p>Несколько тестов:</p>

<pre><code>void TestNum(double value)
{
    double mantissa;
    int exponent;
    frexp(value, out mantissa, out exponent);
    Console.WriteLine($"{value} = {mantissa} * 2^{exponent}");
}

TestNum(0);
TestNum(10);
TestNum(-100);
TestNum(1024);
TestNum(double.MaxValue);
</code></pre>

<p>Результат:</p>

<pre><code>0 = 0 * 2^0
10 = 0,625 * 2^4
-100 = -0,78125 * 2^7
1024 = 0,5 * 2^11
1,79769313486232E+308 = 1 * 2^1024
</code></pre>

<p>В последнем выводит 1, хотя в дебагере видно, что там <code>0,99999999999999989</code>. Такова специфика работы <code>double.ToString</code>.</p>
