---
title: "Как выполнить Сжатие и восстановление Access базы через Interop?"
se.owner.user_id: 32793
se.owner.display_name: "iluxa1810"
se.owner.link: "https://ru.stackoverflow.com/users/32793/iluxa1810"
se.link: "https://ru.stackoverflow.com/questions/561357/%d0%9a%d0%b0%d0%ba-%d0%b2%d1%8b%d0%bf%d0%be%d0%bb%d0%bd%d0%b8%d1%82%d1%8c-%d0%a1%d0%b6%d0%b0%d1%82%d0%b8%d0%b5-%d0%b8-%d0%b2%d0%be%d1%81%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-access-%d0%b1%d0%b0%d0%b7%d1%8b-%d1%87%d0%b5%d1%80%d0%b5%d0%b7-interop"
se.question_id: 561357
se.post_type: question
se.score: 8
---
<p>Как выполнить Сжатие и восстановление <strong>Access</strong> базы через <code>Interop</code>?</p>

<p>Есть класс, который содержит метод:</p>

<pre><code>public bool TryCompactAndRepair()
{
    string pathToDb = app.CurrentDb().Name;
    string pathToCompact = Path.Combine(Path.GetDirectoryName(pathToDb), 
        Path.GetFileNameWithoutExtension(pathToDb)) + 
        "_compact" + Path.GetExtension(pathToDb);

    db.Close();
    app.CloseCurrentDatabase();
    //   Marshal.ReleaseComObject(db);
    GC.Collect();
    if (app.CompactRepair(pathToDb, pathToCompact, true))
    {
        File.Delete(pathToDb);
        File.Move(pathToCompact, pathToDb);
        return true;
    }
    else
    {
        File.Delete(pathToCompact);
    }
    return false;
}
</code></pre>

<p>переменная <code>app</code> имеет тип <code>Application</code>.</p>

<p>Почему-то такой метод возвращает различные ошибки:</p>

<ol>
<li><p>В текущем виде, что-то вроде <em>"Object no longer set"</em></p></li>
<li><p>Если раскоментить <code>Marshal.ReleaseComObject(db);</code> ,то получаю ошибку, что доступ к объекту не доступен.</p></li>
<li><p>Если вообще не делать Close, то вылетает ошибка, что нельзя сделать сжатие для текущей БД.</p></li>
</ol>

<p>Подскажите, в чем косяк?</p>
