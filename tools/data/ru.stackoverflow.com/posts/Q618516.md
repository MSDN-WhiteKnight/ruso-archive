---
title: "Получение наглядного значения WMI Win32_Processor.Family вместо индекса"
se.owner.user_id: 197563
se.owner.display_name: "omegastripes"
se.owner.link: "https://ru.stackoverflow.com/users/197563/omegastripes"
se.link: "https://ru.stackoverflow.com/questions/618516/%d0%9f%d0%be%d0%bb%d1%83%d1%87%d0%b5%d0%bd%d0%b8%d0%b5-%d0%bd%d0%b0%d0%b3%d0%bb%d1%8f%d0%b4%d0%bd%d0%be%d0%b3%d0%be-%d0%b7%d0%bd%d0%b0%d1%87%d0%b5%d0%bd%d0%b8%d1%8f-wmi-win32-processor-family-%d0%b2%d0%bc%d0%b5%d1%81%d1%82%d0%be-%d0%b8%d0%bd%d0%b4%d0%b5%d0%ba%d1%81%d0%b0"
se.question_id: 618516
se.post_type: question
se.score: 3
---
<p>С помощью приведенного ниже кода я получаю значения свойств <code>Caption</code> и <code>Family</code> для экземпляров класса WMI <code>Win32_Processor</code>, а также получаю массивы в качестве значений квалификаторов <code>Values</code> и <code>ValueMap</code> свойства <code>Family</code> класса <code>Win32_Processor</code>, и составляю из них таблицу соответствия <code>oMap</code>, предназначенную для перевода целочисленного значения свойства в связанное с ним строковое значение:</p>

<pre><code>Const wbemFlagUseAmendedQualifiers = 131072
Set oService = GetObject("winmgmts:{impersonationLevel=impersonate}!\\.\Root\CIMV2")
s = ""
For Each oInstance In oService.InstancesOf("Win32_Processor")
    For Each sName In Array("Caption", "Family")
        s = s &amp; sName &amp; " = " &amp; oInstance.Properties_.Item(sName).Value &amp; vbCrLf
    Next
Next
s = s &amp; vbCrLf
Set oClass = oService.Get("Win32_Processor", wbemFlagUseAmendedQualifiers)
Set oProperty = oClass.Properties_.Item("Family")
aValues = oProperty.Qualifiers_.Item("Values")
aValueMap = oProperty.Qualifiers_.Item("ValueMap")
Set oMap = CreateObject("Scripting.Dictionary")
For i = 0 To UBound(aValues)
    oMap(aValueMap(i)) = aValues(i)
Next
For Each sKey In oMap
    s = s &amp; sKey &amp; " = " &amp; oMap(sKey) &amp; vbCrLf
Next
WScript.Echo s
</code></pre>

<p>Получаю следующий вывод:</p>

<pre class="lang-none prettyprint-override"><code>Caption = Intel64 Family 6 Model 42 Stepping 7
Family = 198

1 = Other
2 = Unknown
3 = 8086
4 = 80286
5 = 80386
6 = 80486
7 = 8087
8 = 80287
9 = 80387
10 = 80487
11 = Pentium(R) brand
12 = Pentium(R) Pro
13 = Pentium(R) II
14 = Pentium(R) processor with MMX(TM) technology
15 = Celeron(TM)
16 = Pentium(R) II Xeon(TM)
17 = Pentium(R) III
18 = M1 Family
19 = M2 Family
24 = K5 Family
25 = K6 Family
26 = K6-2
27 = K6-3
28 = AMD Athlon(TM) Processor Family
29 = AMD(R) Duron(TM) Processor
30 = AMD29000 Family
31 = K6-2+
32 = Power PC Family
33 = Power PC 601
34 = Power PC 603
35 = Power PC 603+
36 = Power PC 604
37 = Power PC 620
38 = Power PC X704
39 = Power PC 750
48 = Alpha Family
49 = Alpha 21064
50 = Alpha 21066
51 = Alpha 21164
52 = Alpha 21164PC
53 = Alpha 21164a
54 = Alpha 21264
55 = Alpha 21364
64 = MIPS Family
65 = MIPS R4000
66 = MIPS R4200
67 = MIPS R4400
68 = MIPS R4600
69 = MIPS R10000
80 = SPARC Family
81 = SuperSPARC
82 = microSPARC II
83 = microSPARC IIep
84 = UltraSPARC
85 = UltraSPARC II
86 = UltraSPARC IIi
87 = UltraSPARC III
88 = UltraSPARC IIIi
96 = 68040
97 = 68xxx Family
98 = 68000
99 = 68010
100 = 68020
101 = 68030
112 = Hobbit Family
120 = Crusoe(TM) TM5000 Family
121 = Crusoe(TM) TM3000 Family
122 = Efficeon(TM) TM8000 Family
128 = Weitek
130 = Itanium(TM) Processor
131 = AMD Athlon(TM) 64 Processor Family
132 = AMD Opteron(TM) Family
144 = PA-RISC Family
145 = PA-RISC 8500
146 = PA-RISC 8000
147 = PA-RISC 7300LC
148 = PA-RISC 7200
149 = PA-RISC 7100LC
150 = PA-RISC 7100
160 = V30 Family
176 = Pentium(R) III Xeon(TM)
177 = Pentium(R) III Processor with Intel(R) SpeedStep(TM) Technology
178 = Pentium(R) 4
179 = Intel(R) Xeon(TM)
180 = AS400 Family
181 = Intel(R) Xeon(TM) processor MP
182 = AMD AthlonXP(TM) Family
183 = AMD AthlonMP(TM) Family
184 = Intel(R) Itanium(R) 2
185 = Intel Pentium M Processor
190 = K7
200 = IBM390 Family
201 = G4
202 = G5
203 = G6
204 = z/Architecture base
250 = i860
251 = i960
260 = SH-3
261 = SH-4
280 = ARM
281 = StrongARM
300 = 6x86
301 = MediaGX
302 = MII
320 = WinChip
350 = DSP
500 = Video Processor
</code></pre>

<p>Пробовал также на другом ПК:</p>

<pre class="lang-none prettyprint-override"><code>Caption = AMD64 Family 21 Model 56 Stepping 1
Family = 72

...
</code></pre>

<p>На MSDN приведено описание стандартных квалификаторов <a href="https://msdn.microsoft.com/en-us/library/aa393650(v=vs.85).aspx" rel="nofollow noreferrer">Standard Qualifiers</a>:</p>

<blockquote>
  <p><strong>ValueMap</strong><br>
  This qualifier can be used alone or in combination with the Values qualifier. When used in combination with the Values qualifier, the location of the value in the ValueMap array provides the location of the corresponding entry in the Values array. Use the ValueMap qualifier only with string and integer values. The syntax for representing an integer value in the value map array is [+|=]digit[*digit]. The content, maximum number of digits, and represented value are constrained by the type of the associated property. For example, uint8 may not be signed, must be less than four digits, and must represent a value less than 256.<br>
  <br>
  <strong>Values</strong><br>
  This property also specifies an array of string values to be mapped to an enumeration property. This qualifier can be applied to either an integer property or a string property, and the mapping can be implicit or explicit. If the mapping is implicit, integer or string property values represent ordinal positions in the Values array. If the mapping is explicit, the property must be an integer, and valid property values are listed in the array defined by the ValueMap qualifier. For more information, see Value Map.<br>
  If a ValueMap qualifier is not present, the Values array is indexed (zero-relative) by using the value in the associated property, method return type, or method parameter. If a ValueMap qualifier is present, the values index is defined by the location of the property value in the value map.<br></p>
</blockquote>

<p>В двух словах там сказано, что если в свойстве присутствуют оба квалификатора, то массив <code>ValueMap</code> содержит все допустимые значения свойства, и позиция в нем элемента, равного значению свойства, определяет позицию соответствующего ему строкового значения в массиве <code>Values</code>, а если присутствует только квалификатор <code>Values</code>, то значение свойства является целочисленным индексом и определяет позицию соответствующего строкового значения в этом массиве.</p>

<p>Проблема заключается в получении надлежащего строкового значения, поскольку квалификатор <code>ValueMap</code> не содержит ни значения <code>198</code>, ни <code>72</code>.</p>
