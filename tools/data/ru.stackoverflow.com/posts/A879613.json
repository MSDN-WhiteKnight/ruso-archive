{"owner":{"reputation":16117,"user_id":240512,"user_type":"registered","profile_image":"https://i.stack.imgur.com/Ew6lG.png?s=128&g=1","display_name":"MSDN.WhiteKnight","link":"https://ru.stackoverflow.com/users/240512/msdn-whiteknight"},"is_accepted":true,"score":0,"last_activity_date":1536580656,"last_edit_date":1536580656,"creation_date":1536579491,"answer_id":879613,"question_id":879269,"body":"<p>Нет, в общем случае устройство по умолчанию не обязано иметь код 0. Получить код можно так:</p>\n\n<pre><code>using NAudio.CoreAudioApi;\nusing System.Runtime.InteropServices;\n/* ... */\n\n[DllImport(\"winmm.dll\")]\npublic static extern uint waveInGetNumDevs();\n\npublic const uint DRV_RESERVED = 0x0800;\npublic const uint DRV_QUERYFUNCTIONINSTANCEID = (DRV_RESERVED + 17);\npublic const uint DRV_QUERYFUNCTIONINSTANCEIDSIZE = (DRV_RESERVED + 18);\npublic const uint DRV_QUERYDEVICEINTERFACE = (DRV_RESERVED + 12);\npublic const uint DRV_QUERYDEVICEINTERFACESIZE = (DRV_RESERVED + 13);\n\n[DllImport(\"winmm.dll\", SetLastError = true, CharSet = CharSet.Auto, EntryPoint = \"waveInMessage\")]\npublic static extern int waveInMessage1(uint hWaveIn, uint msg,\n    ref uint dw1, uint dw2);\n\n[DllImport(\"winmm.dll\", SetLastError = true, CharSet = CharSet.Auto, EntryPoint = \"waveInMessage\")]\npublic static extern int waveInMessage2(uint hWaveIn, uint msg,\n    [MarshalAs(UnmanagedType.LPWStr)] StringBuilder dw1, uint dw2);\n\n//получает ID (номер) устройства записи по умолчанию\n\npublic static uint GetDefaultDeviceId()\n{\n    string endpid = \"\";\n    var enumerator = new MMDeviceEnumerator();\n\n    using (enumerator)\n    {\n        var device = enumerator.GetDefaultAudioEndpoint(DataFlow.Capture, Role.Console);\n        using (device)\n        {\n            endpid = device.ID;\n        }\n    }\n\n    uint num = waveInGetNumDevs();\n    StringBuilder sb;\n    uint size = 0;\n    for (uint i = 0; i &lt; num; i++)\n    {\n        size = 0;\n        waveInMessage1(i, DRV_QUERYFUNCTIONINSTANCEIDSIZE, ref size, 0);\n\n        sb = new StringBuilder((int)size + 10);\n        waveInMessage2(i, DRV_QUERYFUNCTIONINSTANCEID, sb, size);\n        ;\n        if (sb.ToString() == endpid) return i;\n    }\n    throw new ApplicationException(\"Default device not found!\");\n\n}\n</code></pre>\n"}