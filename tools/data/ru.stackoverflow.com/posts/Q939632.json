{"tags":["c#","wmi"],"owner":{"reputation":21,"user_id":213492,"user_type":"registered","profile_image":"https://www.gravatar.com/avatar/96a3729de5d6db69f2254714f27bccf7?s=128&d=identicon&r=PG&f=1","display_name":"Mr.Evgen","link":"https://ru.stackoverflow.com/users/213492/mr-evgen"},"is_answered":false,"view_count":51,"answer_count":1,"score":1,"last_activity_date":1549222327,"creation_date":1549035320,"last_edit_date":1549091359,"question_id":939632,"link":"https://ru.stackoverflow.com/questions/939632/%d0%9f%d0%be%d0%bb%d1%83%d1%87%d0%b8%d1%82%d1%8c-%d0%be%d0%b1%d1%89%d0%b8%d0%b9-%d1%81%d0%b2%d0%be%d0%b1%d0%be%d0%b4%d0%bd%d1%8b%d0%b9-%d0%be%d0%b1%d1%8a%d0%b5%d0%bc-%d0%b4%d0%bb%d1%8f-%d0%ba%d0%b0%d0%b6%d0%b4%d0%be%d0%b3%d0%be-%d0%b4%d0%b8%d1%81%d0%ba%d0%b0-%d1%87%d0%b5%d1%80%d0%b5%d0%b7-wmi-%d0%bd%d0%b0-c","title":"Получить общий свободный объем для каждого диска через WMI на C#","body":"<p>Необходимо через WMI узнать сколько свободного места есть на каждом, физическом HDD. Заранее неизвестно сколько подключено HDD и сколько разделов на каждом диске.\nНабросал такой код. </p>\n\n<pre><code>ManagementObjectSearcher wdSearcher = new ManagementObjectSearcher(\"SELECT * FROM Win32_DiskDrive\");\n\nforeach (ManagementObject drive in wdSearcher.Get())\n{\n    Driver driver = new Driver();\n    driver.Model = drive[\"Model\"].ToString().Trim();\n    driver.Type = drive[\"InterfaceType\"].ToString().Trim();\n    driver.Partitions = byte.Parse(drive[\"Partitions\"].ToString().Trim());\n    driver.TotalSpace = long.Parse(drive[\"Size\"].ToString().Trim());\n}\n\nManagementObjectSearcher lgSearcher = new ManagementObjectSearcher(\"SELECT * FROM Win32_LogicalDisk\");\n\niDriveIndex = 0;\nbyte partitionCount = 1;\n\nforeach (ManagementObject drive in lgSearcher.Get())\n{\n    if (iDriveIndex &gt; DriverList.Count) break;\n\n    if (partitionCount &gt; DriverList[iDriveIndex].Partitions)\n    {\n        iDriveIndex++;\n        partitionCount = 1;\n    }\n\n    long freeSpace = 0;\n\n    try\n    {\n        freeSpace = long.Parse(drive[\"FreeSpace\"].ToString().Trim());\n    }\n    catch\n    { continue; }\n\n    DriverList[iDriveIndex].FreeSpace += freeSpace;\n    partitionCount++;\n}\n</code></pre>\n\n<p>Но проблема в том, что в переменную <code>Partition</code> возвращается число 3 с учетом скрытых разделов. А в <code>Win32_LogicalDisk</code> этих разделов понятное дело нет. </p>\n"}