{"owner":{"reputation":16058,"user_id":240512,"user_type":"registered","profile_image":"https://i.stack.imgur.com/Ew6lG.png?s=128&g=1","display_name":"MSDN.WhiteKnight","link":"https://ru.stackoverflow.com/users/240512/msdn-whiteknight"},"is_accepted":false,"score":0,"last_activity_date":1546195125,"creation_date":1546195125,"answer_id":927170,"question_id":926187,"body":"<p>Не нужно вызывать GetAsyncKeyState в цикле только с целью глобального отлова нажатий клавиатуры или мыши. При таком способе у вас всегда программа либо слишком сильно нагружает процессор, либо недостаточно быстро реагирует на события. Вместо этого, используйте специально для этого предназначенный механизм, Low-level keyboard (mouse) hook:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;Windows.h&gt;\n\nbool state = false;\n\nLRESULT CALLBACK LowLevelKeyboardProc(int nCode, WPARAM wParam, LPARAM lParam)\n{    \n\n    if (nCode == HC_ACTION)\n    {\n        switch (wParam)\n        {\n        case WM_KEYDOWN:\n            PKBDLLHOOKSTRUCT p = (PKBDLLHOOKSTRUCT)lParam;\n            if(p-&gt;vkCode == VK_F12) {               \n                state = !state;             \n            }           \n            break;\n        }\n    }\n    return CallNextHookEx(NULL, nCode, wParam, lParam);\n}\n\nLRESULT CALLBACK LowLevelMouseProc( int    nCode, WPARAM wParam,LPARAM lParam){\n    if (nCode == HC_ACTION)\n    {\n        switch (wParam)\n        {\n        case WM_LBUTTONDOWN:            \n            if(state != false) {\n                //выполнить необходимые действия при нажатии кнопки мыши...             \n            }\n            break;\n        }\n    }\n    return CallNextHookEx(NULL, nCode, wParam, lParam);\n}\n\nint main(int argc, char* argv[])\n{\n\n    printf(\"Press F12 to activate / deactivate the script.\");\n\n    HHOOK hook = SetWindowsHookEx(WH_KEYBOARD_LL, LowLevelKeyboardProc, 0, 0);\n    if(hook == NULL) {\n        printf(\"Failed to install keyboard hook!\\n\");\n        getchar();\n        return 1;\n    }\n\n    hook = SetWindowsHookEx(WH_MOUSE_LL, LowLevelMouseProc, 0, 0);\n    if(hook == NULL) {\n        printf(\"Failed to install mouse hook!\\n\");\n        getchar();\n        return 1;\n    }\n\n    MSG msg;\n    while (!GetMessage(&amp;msg, NULL, NULL, NULL)) {    \n        TranslateMessage(&amp;msg);\n        DispatchMessage(&amp;msg);\n    }       \n\n    return 0;\n}\n</code></pre>\n"}