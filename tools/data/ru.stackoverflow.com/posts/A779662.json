{"owner":{"reputation":16058,"user_id":240512,"user_type":"registered","profile_image":"https://i.stack.imgur.com/Ew6lG.png?s=128&g=1","display_name":"MSDN.WhiteKnight","link":"https://ru.stackoverflow.com/users/240512/msdn-whiteknight"},"is_accepted":false,"score":1,"last_activity_date":1517656104,"creation_date":1517656104,"answer_id":779662,"question_id":764352,"body":"<p>Начиная с Windows Vista можно использовать функцию <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms646309(v=vs.85).aspx\" rel=\"nofollow noreferrer\">RegisterHotKey</a>. Она позволяет зарегистрировать глобальную горячую клавишу и указать окно, которое будет принимать сообщения. Чтобы обработать эти сообщения в WPF приложении, нужно зарегистрировать обработчик через <a href=\"https://msdn.microsoft.com/ru-ru/library/system.windows.interop.hwndsource.addhook(v=vs.110).aspx\" rel=\"nofollow noreferrer\">HwndSource.AddHook</a>. </p>\n\n<p>Пример как обработать событие горячей клавиши и вывести момент ее нажатия в TextBlock:</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Text;\nusing System.Windows;\nusing System.Windows.Controls;\nusing System.Runtime.InteropServices;\nusing System.Windows.Interop;\n\nnamespace WpfHotkey\n{\n    public partial class MainWindow : Window\n    {\n        [DllImport(\"user32.dll\", SetLastError = true)]\n        [return: MarshalAs(UnmanagedType.Bool)]\n        public static extern bool RegisterHotKey(IntPtr hWnd, int id, uint fsModifiers, uint vk);\n\n        //необходимые константы\n        public const int MOD_ALT = 0x1;\n        public const int MOD_CONTROL = 0x2;\n        public const int MOD_SHIFT = 0x4;\n        public const int MOD_WIN = 0x8;\n        public const int WM_HOTKEY = 0x312;\n\n        //несколько примеров виртуальных кодов\n        public const uint VK_F1 = 0x70;\n        public const uint VK_F2 = 0x71;\n        public const uint VK_UP = 0x26;\n        public const uint VK_DOWN = 0x28;\n\n        //обработчик сообщений для окна\n        private IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)\n        {\n\n            if (msg == WM_HOTKEY)\n            {\n                textBlock1.Text += DateTime.Now.ToString() + \" WM_HOTKEY message, ID: 0x\" + wParam.ToString(\"X\");\n                textBlock1.Text += Environment.NewLine;\n                handled = true;\n            }\n\n            return IntPtr.Zero;\n        }\n\n        public MainWindow()\n        {\n            InitializeComponent();            \n        }\n\n\n        private void Window_Loaded(object sender, RoutedEventArgs e)\n        {\n            WindowInteropHelper h = new WindowInteropHelper(this);\n            HwndSource source = HwndSource.FromHwnd(h.Handle);\n            source.AddHook(new HwndSourceHook(WndProc));//регистрируем обработчик сообщений\n\n            bool res = RegisterHotKey(h.Handle, 1, 0, VK_F1);//регистрируем горячую клавишу\n            if (res == false) MessageBox.Show(\"RegisterHotKey failed\");\n        }\n    }\n}\n</code></pre>\n"}