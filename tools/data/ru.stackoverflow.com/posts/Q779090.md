---
title: "Сколько памяти занимают объекты?"
se.owner.user_id: 23355
se.owner.display_name: "Макс Бурцев"
se.owner.link: "https://ru.stackoverflow.com/users/23355/%d0%9c%d0%b0%d0%ba%d1%81-%d0%91%d1%83%d1%80%d1%86%d0%b5%d0%b2"
se.link: "https://ru.stackoverflow.com/questions/779090/%d0%a1%d0%ba%d0%be%d0%bb%d1%8c%d0%ba%d0%be-%d0%bf%d0%b0%d0%bc%d1%8f%d1%82%d0%b8-%d0%b7%d0%b0%d0%bd%d0%b8%d0%bc%d0%b0%d1%8e%d1%82-%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d1%8b"
se.question_id: 779090
se.post_type: question
se.score: 3
---
<p>Провел несколько тестов, и был весьма удивлен... Режим компиляции x64. Первый тест показал 4 байта, здесь все нормально. Второй 32. Ого подумал я. И трейтий 32 WTF ???</p>

<pre><code>static int count = 10000000;

        static void Array_C()
    {
        var size = GC.GetTotalMemory(true);
        var arr = new int[count];

        for (var i = 0; i &lt; count; ++i)
        {
            arr[i] = i;
        }

        var mem = GC.GetTotalMemory(true) - size;

        Console.WriteLine("Выделено памяти: " + mem + ", размер одного объекта: " + Math.Truncate((double)mem / count) + ", код последней " + arr.Last());
    }

    static void Array_E()
    {
        var size = GC.GetTotalMemory(true);
        var arr = new object[count];

        for (var i = 0; i &lt; count; ++i)
        {
            arr[i] = new object();
        }

        var mem = GC.GetTotalMemory(true) - size;

        Console.WriteLine("Выделено памяти: " + mem + ", размер одного объекта: " + Math.Truncate((double)mem / count) + ", код последней " + arr.Last().GetHashCode());
    }

    static void Array_F()
    {
        var size = GC.GetTotalMemory(true);
        var arr = new C[count];

        for (var i = 0; i &lt; count; ++i)
        {
            arr[i] = new C { Val0 = i, Val1 = i };
        }

        var mem = GC.GetTotalMemory(false) - size;

        Console.WriteLine("Выделено памяти: " + mem + ", размер одного объекта: " + Math.Truncate((double)mem / count) + ", код последней " + arr.Last().Val0 + arr.Last().Val1);
    }

[StructLayout(LayoutKind.Sequential, Pack = 1)]
class C
{
    public int Val0;
    public int Val1;
}
</code></pre>

<p>Вопрос даже не в том почему во втором тесте один экземляр занимает 32 байта. А в том почему в третьем тесте экземпляр не занимает 40 байт.</p>
