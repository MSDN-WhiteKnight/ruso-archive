{"tags":["c#",".net","ms-word","office","office-interop"],"owner":{"reputation":22868,"user_id":32793,"user_type":"registered","accept_rate":48,"profile_image":"https://i.stack.imgur.com/6Vktl.jpg?s=128&g=1","display_name":"iluxa1810","link":"https://ru.stackoverflow.com/users/32793/iluxa1810"},"is_answered":true,"view_count":798,"answer_count":5,"score":3,"last_activity_date":1534002714,"creation_date":1522234620,"last_edit_date":1534002714,"question_id":805934,"link":"https://ru.stackoverflow.com/questions/805934/%d0%9e%d0%b1%d1%85%d0%be%d0%b4-%d0%be%d0%b1%d1%8a%d0%b5%d0%b4%d0%b8%d0%bd%d0%b5%d0%bd%d0%bd%d1%8b%d1%85-%d1%8f%d1%87%d0%b5%d0%b5%d0%ba-%d0%b2-word","title":"Обход объединенных ячеек в Word","body":"<p>В общем, в продолжение своей предыдущей темы по парсингу таблиц Word'a с помощью interop я столкнулся с объединенными ячейками.</p>\n\n<p>Как я могу узнать на сколько ячеек произошло объединение, что бы я мог размножить F3 на N строчек?</p>\n\n<p><a href=\"https://i.stack.imgur.com/61hjy.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/61hjy.png\" alt=\"\"></a></p>\n\n<p>Капался в дебаггере в поисках нужного свойства, но что-то не нашел... Да и в интернете поголовно пишут, что такого свойства нет</p>\n\n<p><strong>UPD 1</strong></p>\n\n<p>На одном из ресурсов подкинули вот такую идею(Код на VBA, но легко переписывается на C#):</p>\n\n<pre class=\"lang-vb prettyprint-override\"><code>Sub ParseInExcel()\n    Dim doc As Document, tbl As Table, eObj, eWbk, eWst, eRng, eCell\n    Dim i As Long, j As Long\n    Set doc = ThisDocument\n    Set tbl = doc.Tables(1)\n    tbl.Range.Copy\n    Set eObj = CreateObject(\"Excel.Application\")\n    Set eWbk = eObj.Workbooks.Add\n    Set eWst = eWbk.Sheets(1)\n    eWst.Paste\n    Set eRng = eWst.Cells(1).CurrentRegion\n    For i = 1 To eRng.Rows.Count\n        For j = 1 To eRng.Columns.Count\n            Set eCell = eRng.Cells(i, j)\n            If eCell.MergeCells Then\n                Debug.Print eCell.MergeArea.Cells(1).Value &amp; \" \";\n            Else\n                Debug.Print eCell.Value &amp; \" \";\n            End If\n        Next\n        Debug.Print\n    Next\n    eWbk.Saved = True\n    eWbk.Close\n    Set eWbk = Nothing\n    eObj.Quit\n    Set eObj = Nothing\nEnd Sub\n</code></pre>\n\n<p>Смысл в том, что из Word все копипастится в Excel, а там уже появляются свойства, которые показывают объединение ячеек-<code>MergeRange</code>. Проблема в том, что будет занят буфер обмена(самое проблемное на мой взгляд, так как не смогу работать за ПК в момент работы программы иначе покалечу буфер), а так же в том, что подключается второй всадник апокалипсиса-Excel.</p>\n\n<p>Если Excel знает, как представить таблицу из Word и создать свойства, которые показывают, что некая зона объединена, то значит должен иметься какой-то однозначный алгоритм для вычисления этого средствами Word'a.</p>\n\n<p>Даже при сохранении в html-формате пишется кол-во объединенных колонок и строк.</p>\n\n<p><strong>UPD 2</strong></p>\n\n<p>По объединенным строкам я нашел решение, но по колонкам нет. Накидал <a href=\"https://ru.stackoverflow.com/a/808073/32793\">свое решение</a>, но не думаю, что оно универсально. </p>\n\n<p>Может у кого-то есть еще идеи?</p>\n\n<p>P.S Interop не принципиален, но в приоритете, так как много кода на нем нарисовал.</p>\n\n<p>Если есть решение например для *.DOCX, то я могу сменить формат.</p>\n"}