{"tags":["c#","pinvoke","interop"],"owner":{"reputation":4994,"user_id":206435,"user_type":"registered","accept_rate":78,"profile_image":"https://www.gravatar.com/avatar/aff8ab0e5f74d01facde887535318d53?s=128&d=identicon&r=PG","display_name":"ヒミコ","link":"https://ru.stackoverflow.com/users/206435/%e3%83%92%e3%83%9f%e3%82%b3"},"is_answered":true,"view_count":54,"answer_count":2,"score":4,"last_activity_date":1540178035,"creation_date":1540053818,"last_edit_date":1540054161,"question_id":895676,"link":"https://ru.stackoverflow.com/questions/895676/%d0%9f%d0%b5%d1%80%d0%b5%d0%b4%d0%b0%d1%87%d0%b0-%d0%b4%d0%b5%d0%bb%d0%b5%d0%b3%d0%b0%d1%82%d0%b0-%d0%b2-%d0%bd%d0%b5%d1%83%d0%bf%d1%80%d0%b0%d0%b2%d0%bb%d1%8f%d0%b5%d0%bc%d1%8b%d0%b9-%d0%ba%d0%be%d0%b4-%d0%ba%d0%b0%d0%ba-%d1%83%d0%ba%d0%b0%d0%b7%d0%b0%d1%82%d0%b5%d0%bb%d1%8c-%d0%bd%d0%b0-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d1%8e","title":"Передача делегата в неуправляемый код как указатель на функцию","body":"<p>Имеется неуправляемый метод, который принимает указатель на функцию <code>callback</code>.</p>\n\n<p>Определенный прототип выглядит так:</p>\n\n<pre><code>typedef SDL_HitTestResult (SDLCALL *SDL_HitTest)\n                          (SDL_Window *win, const SDL_Point *area, void *data);\n</code></pre>\n\n<p>Думаю определение делегата должно быть соответственно таким:</p>\n\n<pre><code>delegate HitTestResult HitTestDelegate(IntPtr windowPtr,\n                                       IntPtr pointAreaPtr, IntPtr userData);\n</code></pre>\n\n<p>Но тут теперь возникает вопрос, нужно ли данный делегат помечать как указатель на неуправляемую функцию, т.е. ставить ему атрибут</p>\n\n<pre><code>[UnmanagedFunctionPointer(CallingConvention.Cdecl)]\ndelegate HitTestResult HitTestDelegate(IntPtr windowPtr,\n                                       IntPtr pointAreaPtr, IntPtr userData);\n</code></pre>\n\n<p>Т.к. стоит <code>SDLCALL</code> определнный как <code>__cdecl</code>.</p>\n"}