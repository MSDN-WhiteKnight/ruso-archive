---
title: "Установить прокси для модема на C# (через реестр)"
se.owner.user_id: 274967
se.owner.display_name: "Максим Молчанов"
se.owner.link: "https://ru.stackoverflow.com/users/274967/%d0%9c%d0%b0%d0%ba%d1%81%d0%b8%d0%bc-%d0%9c%d0%be%d0%bb%d1%87%d0%b0%d0%bd%d0%be%d0%b2"
se.link: "https://ru.stackoverflow.com/questions/748656/%d0%a3%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%b8%d1%82%d1%8c-%d0%bf%d1%80%d0%be%d0%ba%d1%81%d0%b8-%d0%b4%d0%bb%d1%8f-%d0%bc%d0%be%d0%b4%d0%b5%d0%bc%d0%b0-%d0%bd%d0%b0-c-%d1%87%d0%b5%d1%80%d0%b5%d0%b7-%d1%80%d0%b5%d0%b5%d1%81%d1%82%d1%80"
se.question_id: 748656
se.post_type: question
se.score: 2
---
<p>Всем здравствуйте! Подскажите пожалуйста как на C# установить прокси не для локальной сети, а для модема.</p>

<p>Для локальной сети делаю так:</p>

<pre><code>string proxy = "144.217.174.12:8888";
RegistryKey reg_key;
reg_key = Registry.CurrentUser.OpenSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings", true);
reg_key.SetValue("ProxyEnable", 1);
reg_key.SetValue("ProxyServer", proxy);
</code></pre>

<p>В настройках браузера в результате:</p>

<p><a href="https://i.stack.imgur.com/60xTx.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/60xTx.png" alt=""></a></p>

<p>В реестре в разделе <code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings</code>:</p>

<p><a href="https://i.stack.imgur.com/232Hn.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/232Hn.png" alt=""></a></p>

<p>Как мне сделать тоже самое только для настроек не локальной сети, а модема?Наверное есть раздел реестра, который отвечает за модемы,подскажите его пожалуйста, потому что код вроде бы будет такой же. Или поправьте,если я что-то не так думаю.
То есть здесь:</p>

<p><a href="https://i.stack.imgur.com/gijhX.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/gijhX.png" alt="введите сюда описание изображения"></a></p>

<p>Мониторил кучу действий, который браузер делает в реестре, при подключении прокси к модему через окно, удалось выделить следующее:</p>

<p><a href="https://i.stack.imgur.com/3QhrY.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/3QhrY.png" alt="введите сюда описание изображения"></a></p>

<p>Код на C# работы с InternetSetOption</p>

<pre><code> class Program
{
    public struct Struct_INTERNET_PROXY_INFO
    {
        public int dwAccessType;
        public IntPtr proxy;
        public IntPtr proxyBypass;
    }

    [DllImport("wininet.dll", SetLastError = true)]
    private static extern bool InternetSetOption(IntPtr hInternet,int dwOption,IntPtr lpBuffer,int lpdwBufferLength);

    private static void RefreshIESettings(string strProxy)
    {
        const int INTERNET_OPTION_PROXY = 38;
        const int INTERNET_OPEN_TYPE_PROXY = 3;

        Struct_INTERNET_PROXY_INFO struct_IPI;

        struct_IPI.dwAccessType = INTERNET_OPEN_TYPE_PROXY;
        struct_IPI.proxy = Marshal.StringToHGlobalAnsi(strProxy);
        struct_IPI.proxyBypass = Marshal.StringToHGlobalAnsi("local");

        IntPtr intptrStruct = Marshal.AllocCoTaskMem(Marshal.SizeOf(struct_IPI));
        Marshal.StructureToPtr(struct_IPI, intptrStruct, true);
        InternetSetOption(IntPtr.Zero, INTERNET_OPTION_PROXY, intptrStruct, Marshal.SizeOf(struct_IPI));
    }
    static void Main(string[] args)
    {
        RefreshIESettings("203.142.34.36:52335");
    }   
}
</code></pre>
