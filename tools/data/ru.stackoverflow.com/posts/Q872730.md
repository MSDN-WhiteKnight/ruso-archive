---
title: "Не открывается .xlsx в datagrid"
se.owner.user_id: 
se.owner.display_name: "user307204"
se.owner.link: ""
se.link: "https://ru.stackoverflow.com/questions/872730/%d0%9d%d0%b5-%d0%be%d1%82%d0%ba%d1%80%d1%8b%d0%b2%d0%b0%d0%b5%d1%82%d1%81%d1%8f-xlsx-%d0%b2-datagrid"
se.question_id: 872730
se.post_type: question
se.score: 1
---
<p>Возникла проблема с WPF: в приложении у меня при нажатии кнопки должен открыться файл с расширением .xlsx и его содержимое перенестись в DataGrid, что не происходит, всё так  пустым и остаётся.</p>

<pre><code>    private void btnOpen_Click(object sender, RoutedEventArgs e)
    {
        try
        {
            OpenFileDialog openFileDialog1 = new OpenFileDialog();
            openFileDialog1.Filter = "XML Files (*.xml; *.xls; *.xlsx; *.xlsm; *.xlsb) |*.xml; *.xls; *.xlsx; *.xlsm; *.xlsb";
            openFileDialog1.FilterIndex = 3;

            openFileDialog1.Multiselect = false;
            openFileDialog1.InitialDirectory = @"Desktop";

            Nullable&lt;bool&gt; result = openFileDialog1.ShowDialog();
            if (result == true)
            {
                string pathName = openFileDialog1.FileName;
                string fileName = System.IO.Path.GetFileNameWithoutExtension(openFileDialog1.FileName);
                DataTable tbContainer = new DataTable();
                string strConn = string.Empty;
                string sheetName = fileName;

                FileInfo file = new FileInfo(pathName);
                if (!file.Exists) { throw new Exception("Error, file doesn't exists!"); }
                string extension = file.Extension;
                switch (extension)
                {
                    case ".xls":
                        strConn = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" + pathName + ";Extended Properties='Excel 8.0;HDR=Yes;IMEX=1;'";
                        break;
                    case ".xlsx":
                        strConn = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + pathName + ";Extended Properties='Excel 12.0;HDR=Yes;IMEX=1;'";
                        break;
                    default:
                        strConn = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" + pathName + ";Extended Properties='Excel 8.0;HDR=Yes;IMEX=1;'";
                        break;
                }
                OleDbConnection cnnxls = new OleDbConnection(strConn);
                OleDbDataAdapter oda = new OleDbDataAdapter(string.Format("select * from [{0}$]", sheetName), cnnxls);
                oda.Fill(tbContainer);

                gridStudents.SetBinding(ItemsControl.ItemsSourceProperty, new Binding { Source = tbContainer });
            }

        }
        catch (Exception)
        {

        }
    }
</code></pre>
