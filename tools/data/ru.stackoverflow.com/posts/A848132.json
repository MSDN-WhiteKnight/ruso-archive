{"owner":{"reputation":16058,"user_id":240512,"user_type":"registered","profile_image":"https://i.stack.imgur.com/Ew6lG.png?s=128&g=1","display_name":"MSDN.WhiteKnight","link":"https://ru.stackoverflow.com/users/240512/msdn-whiteknight"},"is_accepted":true,"score":1,"last_activity_date":1530254773,"last_edit_date":1530254773,"creation_date":1530254442,"answer_id":848132,"question_id":847284,"body":"<ul>\n<li><p>Не используйте <code>String.Format</code> для построения SQL-запросов, это небезопасно. Вместо этого, используйте параметры.</p></li>\n<li><p>Для вызова хранимой процедуры не обязательно составлять запрос EXEC вручную, можно установить тип запроса <code>CommandType.StoredProcedure</code>, тогда достаточно написать имя процедуры</p></li>\n</ul>\n\n<p>Метод для вызова процедуры, возвращающей список строковых значений, можно реализовать как-то так:</p>\n\n<pre><code>using System;\nusing System.Linq;\nusing System.Collections.Generic;\nusing System.Data;\nusing System.Data.SqlClient;\n\npublic static IEnumerable&lt;string&gt; ExecuteProcedure(string sql, params SqlParameter[] args)\n{\n\n    SqlConnection con = new SqlConnection(con_str);\n    con.Open();\n\n    using (con)\n    {\n        SqlCommand cmd = new SqlCommand();\n        cmd.CommandType = CommandType.StoredProcedure;\n        cmd.CommandText = sql;                \n        cmd.Connection = con;\n        for(int i=0;i&lt;args.Length;i++)\n        {\n            cmd.Parameters.Add( args[i]);                    \n        }\n\n        SqlDataReader rd = cmd.ExecuteReader();\n        using (rd)\n        {\n              DataTable dt = new DataTable();\n              dt.Load(rd);\n\n              var results = from myRow in dt.AsEnumerable()\n                              select myRow[0].ToString();\n              return results;\n        }\n    }\n\n}\n</code></pre>\n\n<p>Использование:</p>\n\n<pre><code>var collection = ExecuteProcedure(\"dbo.[Match]\", \n    new SqlParameter(\"FN_Client\", fn), \n    new SqlParameter(\"LN_Client \", ln),\n    new SqlParameter(\"MN_Сlient \",mn));\n\nforeach (var s in collection ) Console.WriteLine(s);\n</code></pre>\n"}