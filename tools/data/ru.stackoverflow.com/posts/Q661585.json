{"tags":["c#","winapi","графика","gdi"],"owner":{"reputation":581,"user_id":203050,"user_type":"registered","accept_rate":78,"profile_image":"https://i.stack.imgur.com/NsNhi.jpg?s=128&g=1","display_name":"ANU CHEEKI BREEKI","link":"https://ru.stackoverflow.com/users/203050/anu-cheeki-breeki"},"is_answered":true,"view_count":832,"accepted_answer_id":661636,"answer_count":1,"score":7,"last_activity_date":1535692318,"creation_date":1493828836,"last_edit_date":1535692318,"question_id":661585,"link":"https://ru.stackoverflow.com/questions/661585/%d0%a0%d0%b8%d1%81%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5-%d0%bd%d0%b0-%d0%be%d0%ba%d0%bd%d0%b5-%d0%b4%d1%80%d1%83%d0%b3%d0%be%d0%b3%d0%be-%d0%bf%d1%80%d0%b8%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d1%8f-%d1%81-%d0%bf%d0%be%d0%bc%d0%be%d1%89%d1%8c%d1%8e-winapi","title":"Рисование на окне другого приложения с помощью WinAPI","body":"<p>Нужно написать на С# программу, которая будет определять над каким окном Windows сейчас находится курсор и обводить это окно рамкой (указывая пользователю, над каким элементом находится курсор, ведь в WinApi, окном является не только само окно, содержащее в себе множество других элементов, но и эти элементы тоже являются окнами).  </p>\n\n<p>Handler окна под курсором получить легко:  </p>\n\n<pre><code>...\nPoint point;\nWinApi.GetCursorPos(out point);\nWinApi.WindowFromPoint(point);\n...\n</code></pre>\n\n<p>Но вот нарисовать что то на окне не выходит, хоть убейте.  </p>\n\n<pre><code>public static void drawSelectionRectangle(IntPtr handler)\n{\n    Rectangle rectangle;\n    WinApi.GetWindowRect(handler, out rectangle);\n\n    WinApi.PAINTSTRUCT paintProperties;\n    IntPtr paintContext = WinApi.BeginPaint(handler, out paintProperties);\n\n    IntPtr pen = WinApi.CreatePen(WinApi.PenStyle.PS_SOLID, 5, (uint) ColorTranslator.ToWin32(Color.Red));\n    WinApi.SelectObject(paintContext, pen);\n\n    WinApi.Rectangle(paintContext, rectangle.Left, rectangle.Top, rectangle.Right, rectangle.Bottom);\n\n    WinApi.ValidateRect(handler, IntPtr.Zero);\n    WinApi.EndPaint(handler, ref paintProperties);\n}\n</code></pre>\n\n<p><code>drawSelectionRectangle(IntPtr handler)</code> вызывал и одиночно (по нажатию кнопки) и в цикле (так как предполагал, что отрисовка может выполнятся за один кадр, после чего, исчезать). Ни так ни так не работает.  </p>\n\n<p>Подскажите, пожалуйста, в чем проблема... Скоро курсовой сдавать, а ничего не готово :(</p>\n"}