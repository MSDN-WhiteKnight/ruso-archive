---
title: "Answer 1005804"
se.owner.user_id: 17974
se.owner.display_name: "nick_n_a"
se.owner.link: "https://ru.stackoverflow.com/users/17974/nick-n-a"
se.answer_id: 1005804
se.question_id: 1005799
se.post_type: answer
se.score: 3
se.is_accepted: True
---
<p>По шапке. Файлы нового экселя xlsx начинаются PK - сигнатурой zip-а <code>50 4B</code>. С такой сигнатурой могут быть не только xlsx а ещё и docx да и zip архивы, нужно вычитывать список упакованых файлов, для уточнения.</p>

<p>Файлы .xls - бывают двух типов, "новые" xls (обычно именно такие встречаются).
Они имеют сигнатуру <code>D0 CF 1 E0 A1 B1 1A E1</code> (на самом деле это сигнатура документа офис, для полее подробной идентификации, т.е. doc и xls будут иметь одинаковую сигнатуру, нужно искать "главное" вложение в biff обвертке, и проверять там сигнатуру, либо по списку файлов biff-обвертки), и соовсем старые (до 7 версии, 6-тая не была в обиходе) имеют сигнатуру <code>09 08</code></p>

<p>Например можно так</p>

<pre><code> byte[] xlsDoc = f(); // Загрузили документ в байты
 if ((xlsDoc[0]==0x50) &amp;&amp; (xlsDoc[1]==0x4B)) {
     // Новый ексель
      } 
 else if ((xlsDoc[0]==0xD0) &amp;&amp; (xlsDoc[1]==0xCF) /*...*/) {
    // Офис 97
 }
 else if ((xlsDoc[0]==9) &amp;&amp; (xlsDoc[1]==8)) {
    // Старый одностраничный
 } else {
    // В других случаях - думаю что мусор
 }
</code></pre>

<p>Т.к. файл может быть большой, то лучше вычитать первые 16 байт, и их проанализировать, а потом вернуть <code>Stream.Position</code> в ноль.</p>

<p>Ещё с excel мне попадались приколы</p>

<ul>
<li>xml <code>&lt;?xml</code> - файл с excel (если в excel сохранить файл как xml)</li>
<li>html excel <code>&lt;html</code>  - часто советуют такой файл делать в интернете javascipt-ом php и т п, - таблица с <code>&lt;td&gt;</code> <code>&lt;tr&gt;</code> тегами и определенными приписками.</li>
</ul>

<p>Ссылки на сигнатуры</p>

<ol>
<li><a href="http://uk.wikipedia.org/wiki/%D0%A1%D0%B8%D0%B3%D0%BD%D0%B0%D1%82%D1%83%D1%80%D0%B0_%D1%84%D0%B0%D0%B9%D0%BB%D1%83_(%D0%BF%D0%B5%D1%80%D0%B5%D0%BB%D1%96%D0%BA)" rel="nofollow noreferrer">http://uk.wikipedia.org/wiki/%D0%A1%D0%B8%D0%B3%D0%BD%D0%B0%D1%82%D1%83%D1%80%D0%B0_%D1%84%D0%B0%D0%B9%D0%BB%D1%83_(%D0%BF%D0%B5%D1%80%D0%B5%D0%BB%D1%96%D0%BA)</a></li>
<li><a href="http://www.filesignatures.net/index.php?page=search&amp;search=XLS&amp;mode=EXT" rel="nofollow noreferrer">http://www.filesignatures.net/index.php?page=search&amp;search=XLS&amp;mode=EXT</a></li>
<li><a href="http://www.filesignatures.net/index.php?page=search&amp;search=XLSX&amp;mode=EXT" rel="nofollow noreferrer">http://www.filesignatures.net/index.php?page=search&amp;search=XLSX&amp;mode=EXT</a></li>
<li><a href="http://en.wikipedia.org/wiki/Microsoft_Excel" rel="nofollow noreferrer">http://en.wikipedia.org/wiki/Microsoft_Excel</a></li>
</ol>
