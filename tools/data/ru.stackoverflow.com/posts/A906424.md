---
title: "Answer 906424"
se.owner.user_id: 287068
se.owner.display_name: "freim"
se.owner.link: "https://ru.stackoverflow.com/users/287068/freim"
se.answer_id: 906424
se.question_id: 906246
se.post_type: answer
se.score: 4
se.is_accepted: False
---
<p>В дополнение к ответу от @MSDN.WhiteKnight стоит упомянуть полезную функцию WinAPI <code>MoveFileEx</code> с флагом <code>MOVEFILE_DELAY_UNTIL_REBOOT</code>. В принципе, одной этой функции достаточно для удаления, и некоторые инсталляторы ее и используют для самоудаления анинсталлера. Проблема с ней только в том, что каталог программы при этом не удаляется (что мы и видим у некоторых приложений).</p>

<p>Для полного удаления вместе с каталогом используется двухступенчатый процесс, как описано в предыдущем ответе:</p>

<ol>
<li>Записать в <code>Temp</code> программу (или батник) удаления.</li>
<li>Запустить ее, при этом удалялка должна уметь дожидаться выхода
запустившего ее анисталлера.</li>
<li>Вызвать <code>MoveFileEx(szDeleterPath, NULL, MOVEFILE_DELAY_UNTIL_REBOOT);</code> для удаления после рестарта системы удалялки из <code>Temp</code>.</li>
<li>Выйти.</li>
</ol>

<p>Вместо вызова <code>MoveFileEx</code> можно удалять через реестр. Для этого в <code>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</code> нужно создать текстовое значение с произвольным именем (например, <code>DeleteMyApp</code>), и строкой <code>cmd /C del "путь_к_программе_удаления"</code>. При следующем рестарте Windows выполнит эту команду и удалит это значение из реестра.</p>
