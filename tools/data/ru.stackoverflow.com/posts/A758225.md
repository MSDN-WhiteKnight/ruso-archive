---
title: "Answer 758225"
se.owner.user_id: 189339
se.owner.display_name: "Denis Bubnov"
se.owner.link: "https://ru.stackoverflow.com/users/189339/denis-bubnov"
se.answer_id: 758225
se.question_id: 758190
se.post_type: answer
se.score: 6
se.is_accepted: False
---
<p>Начнем с того, что у нас будет какая-то информация о процессах (не забываем подключить пространство имен <code>using System.Diagnostics;</code>):</p>

<pre><code>Process[] processList = Process.GetProcesses();
foreach (Process process in processList)
{
    // В process хранится информация о процессе
}
</code></pre>

<p>Метод <a href="https://msdn.microsoft.com/ru-ru/library/system.diagnostics.process.getprocesses(v=vs.110).aspx" rel="noreferrer"><code>GetProcesses</code></a> - возвращает массив компонентов <code>Process</code> для каждого ресурса процесса на локальном компьютере. Собственно, у процесса <a href="https://msdn.microsoft.com/ru-ru/library/system.diagnostics.process(v=vs.110).aspx" rel="noreferrer"><code>Process</code></a> есть свойство <code>Id</code> в котором находится уникальный идентификатор связанного процесса. </p>

<p>После выполнения этого кода у нас есть данные о процессах, и можно перейти к другой части, получение описания процесса и владельца процесса. </p>

<p>Добавим ссылку на сборку <code>System.Management</code> кликаем на проекте, затем через <kbd>Add</kbd>-><kbd>Reference...</kbd> ставим галочку и прописываем <code>using System.Management;</code></p>

<p><a href="https://i.stack.imgur.com/mLBqx.png" rel="noreferrer"><img src="https://i.stack.imgur.com/mLBqx.png" alt="введите сюда описание изображения"></a></p>

<p>Напишем такой метод:</p>

<pre><code>public static List&lt;KeyValuePair&lt;int, string&gt;&gt; GetProcessExtraInformation(int processId)
{
    // запрос получения всех процессов связанных с переданным идентификатором processId
    string query = "Select * From Win32_Process Where ProcessID = " + processId;
    ManagementObjectSearcher searcher = new ManagementObjectSearcher(query);
    ManagementObjectCollection processList = searcher.Get();

    // здесь будет результат    
    List&lt;KeyValuePair&lt;int, string&gt;&gt; result = new List&lt;KeyValuePair&lt;int, string&gt;&gt;();

    foreach (ManagementObject obj in processList)
    {
        var description = @"Не могу получить информацию о процессе";
        // Получим описание процесса, если таковое имеется
        if (obj["ExecutablePath"] != null)
        {
            try
            {
                FileVersionInfo info = FileVersionInfo.GetVersionInfo(obj["ExecutablePath"].ToString());
                description = info.FileDescription;
            }
            catch { }
        }

        // Получить владельца процесса в argList 
        var owner = @"Не могу получить владельца процесса";
        string[] argList = new string[] { string.Empty, string.Empty };
        int returnVal = Convert.ToInt32(obj.InvokeMethod("GetOwner", argList));
        if (returnVal == 0)
        {
            owner = argList[1] + "\\" + argList[0]; // Домен и владелец                    
        }

        result.Add(new KeyValuePair&lt;int, string&gt;(processId, string.Format("Description: '{0}'\nOwner: '{1}'", description, owner)));
    }

    return result;
}
</code></pre>

<p>Да, начальный код перепишем вот так:</p>

<pre><code>Process[] processList = Process.GetProcesses();
foreach (Process process in processList)
{
    // В process хранится информация о процессе
    var processInfo = GetProcessExtraInformation(process.Id);

    foreach (var info in processInfo)
    {
        Console.WriteLine(string.Format("Id: {0}\n{1}", info.Key, info.Value));
    }
    Console.WriteLine();
}

Console.ReadLine();
</code></pre>

<p>В результате получим что-то на подобии вот этого:</p>

<p><a href="https://i.stack.imgur.com/69NiA.png" rel="noreferrer"><img src="https://i.stack.imgur.com/69NiA.png" alt="введите сюда описание изображения"></a></p>

<p>Модернизировал ответ из источника: <a href="https://stackoverflow.com/a/777567/5275890">How do I determine the owner of a process in C#?</a> и дополнил некоторыми деталями результат. Исходя из полученных данных, можно предположить, что процесс с владельцем <strong>SYSTEM</strong> - является системным процессом. Также, следует обратить внимание на домены.</p>

<blockquote>
  <p>Учетная запись локальной системы — это встроенная учетная запись,
  обладающая очень высокими правами доступа. Она имеет обширные права и
  выступает в качестве компьютера сети. Фактическое имя этой учетной
  записи — «<strong>NT AUTHORITY\SYSTEM</strong>».</p>
</blockquote>

<p>Про учетные записи и службы можно почитать к примеру здесь: <a href="https://technet.microsoft.com/ru-ru/library/ms143504(v=sql.100).aspx" rel="noreferrer">Настройка учетных записей служб Windows</a> в разделе <em>Использование стартовых учетных записей для запуска служб SQL Server</em></p>
