{"tags":["c#","ms-access"],"owner":{"reputation":142,"user_id":279254,"user_type":"registered","profile_image":"https://i.stack.imgur.com/iQ9fL.png?s=128&g=1","display_name":"Tema4910","link":"https://ru.stackoverflow.com/users/279254/tema4910"},"is_answered":true,"view_count":301,"accepted_answer_id":890345,"answer_count":2,"score":1,"last_activity_date":1541405669,"creation_date":1538849775,"question_id":889915,"link":"https://ru.stackoverflow.com/questions/889915/%d0%94%d0%be%d0%b1%d0%b0%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d0%b7%d0%b0%d0%bf%d0%b8%d1%81%d0%b5%d0%b9-%d0%b2-%d1%82%d0%b0%d0%b1%d0%bb%d0%b8%d1%86%d1%83-access-%d0%bf%d1%80%d0%b8-%d0%bf%d0%be%d0%bc%d0%be%d1%89%d0%b8-c","title":"Добавление записей в таблицу Access при помощи C#","body":"<p>В моем проекте имеется кнопка \"Добавить запись в Access\". После того, как я записал все необходимые для добавления данные, я нажимаю на кнопку. После этого возникает данная ошибка, если в таблице Access нет каких либо данных (пустая).</p>\n\n<p><a href=\"https://i.stack.imgur.com/pJgeA.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/pJgeA.jpg\" alt=\"введите сюда описание изображения\"></a></p>\n\n<p>P.S. Код прилагается.</p>\n\n<pre><code>using System; \nusing System.Collections.Generic; \nusing System.ComponentModel; \nusing System.Data; \nusing System.Data.OleDb; \nusing System.Drawing; using System.Linq; \nusing System.Text; \nusing System.Threading.Tasks; \nusing System.Windows.Forms;\n\nnamespace Authorization\n{\n    public partial class fGroup : Form\n    {\n        OleDbConnection requireConnect = new OleDbConnection(@\"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=|DataDirectory|\\BD_Primer1.accdb\");\n        BindingSource BindnSource;\n        DataTable DataTab;\n        bool forBtns;\n\n        public fGroup()\n        {\n            InitializeComponent();\n            cbSpecialty.SelectedIndex = 0;\n            LoadDataFromAccess();\n            forBtns = false;\n        }\n\n        void LoadDataFromAccess()\n        {\n            OleDbDataAdapter adapter = new OleDbDataAdapter(\"Select * from Groups\", requireConnect);\n            DataTab = new DataTable();\n            adapter.Fill(DataTab);\n            BindnSource = new BindingSource();\n            BindnSource.DataSource = DataTab;\n\n            bindingNavigator1.BindingSource = BindnSource;\n\n            nCourse.DataBindings.Clear();\n            nCourse.DataBindings.Add(new Binding(\"Text\", BindnSource, \"course\"));\n\n            tbNumberOfGroup.DataBindings.Clear();\n            tbNumberOfGroup.DataBindings.Add(new Binding(\"Text\", BindnSource, \"numberOfGroup\"));\n\n            cbSpecialty.DataBindings.Clear();\n            cbSpecialty.DataBindings.Add(new Binding(\"Text\", BindnSource, \"specialty\"));\n\n            dataAboutGroups.DataSource = BindnSource;\n            dataAboutGroups.Columns[0].Visible = false;\n            dataAboutGroups.Columns[1].HeaderText = \"Курс\";\n            dataAboutGroups.Columns[2].HeaderText = \"Специальность\";\n            dataAboutGroups.Columns[3].HeaderText = \"Номер группы\";\n            dataAboutGroups.Columns[1].AutoSizeMode = DataGridViewAutoSizeColumnMode.Fill;\n            dataAboutGroups.Columns[2].AutoSizeMode = DataGridViewAutoSizeColumnMode.Fill;\n            dataAboutGroups.Columns[3].AutoSizeMode = DataGridViewAutoSizeColumnMode.Fill;\n            dataAboutGroups.RowsDefaultCellStyle.WrapMode = DataGridViewTriState.True;\n        }\n        private void ClearText()\n        {\n            nCourse.Text=\"1\";\n            tbNumberOfGroup.Text = \"\";\n            cbSpecialty.SelectedIndex = 0;\n        }\n        private void addBtn_Click(object sender, EventArgs e)\n        {\n            ClearText();\n            forBtns = true;\n            saveBtn.Enabled = false;\n        }\n\n        private void tbNumberOfGroup_KeyPress(object sender, KeyPressEventArgs e)\n        {\n            if (!Char.IsDigit(e.KeyChar) &amp;&amp; e.KeyChar != 8) e.Handled = true;\n        }\n\n        private void delBtn_Click(object sender, EventArgs e)\n        {\n            if (forBtns)\n            {\n                //отмена\n                ClearText();\n                forBtns = false;\n                saveBtn.Enabled = true;\n                LoadDataFromAccess();\n            }\n            else if (BindnSource.Count &gt; 0)\n            {\n                //удаление\n                int rowPosition = BindnSource.Position;\n                int delId = Convert.ToInt32(((DataRowView)this.BindnSource.Current).Row[\"ID_group\"]);\n                try\n                {\n                    DialogResult result = MessageBox.Show(\n                    \"Вы действительно хотите удалить данную запись\",\n                    \"Удаление\",\n                    MessageBoxButtons.YesNo,\n                    MessageBoxIcon.Question,\n                    MessageBoxDefaultButton.Button1,\n                    MessageBoxOptions.DefaultDesktopOnly);\n                    if (result == DialogResult.No)\n                    {\n                        LoadDataFromAccess();\n                        return;\n                    }\n                    if (result == DialogResult.Yes)\n                    {\n                        requireConnect.Open();\n                        OleDbCommand Delete = new OleDbCommand(\"Delete From Groups where ID_group = @ID\", requireConnect);\n                        Delete.Parameters.AddWithValue(\"@ID\", delId);\n                        Delete.ExecuteNonQuery();\n                    }\n                }\n                finally\n                {\n                    requireConnect.Close();\n                    LoadDataFromAccess();\n                }\n            }\n        }\n\n        private void saveBtn_Click(object sender, EventArgs e)\n        {\n            if (forBtns)\n            {\n                try\n                {\n                    requireConnect.Close();\n                    requireConnect.Open();\n                    OleDbCommand IdCount = new OleDbCommand(\"Select Max(ID_group) from Groups\", requireConnect);\n                    int max = 0;\n                    if (IdCount.ExecuteScalar() != null)  max = Convert.ToInt32(IdCount.ExecuteScalar()); \n                    //добавление новых данных\n                    OleDbCommand Insert = new OleDbCommand(\"INSERT INTO [Groups] VALUES(@ID_group, @course, @specialty, @numberOfGroup)\", requireConnect);\n                    Insert.Parameters.AddWithValue(\"@ID_group\", max + 1);\n                    Insert.Parameters.AddWithValue(\"@course\", nCourse.Text);\n                    Insert.Parameters.AddWithValue(\"@specialty\", cbSpecialty.Text);\n                    Insert.Parameters.AddWithValue(\"@numberOfGroup\", tbNumberOfGroup.Text);\n                    Insert.ExecuteNonQuery();\n                    MessageBox.Show(\n                    \"Запись успешно добавлена\",\n                    \"Сохранение\",\n                    MessageBoxButtons.OK,\n                    MessageBoxIcon.Information,\n                    MessageBoxDefaultButton.Button1,\n                    MessageBoxOptions.DefaultDesktopOnly);\n                    forBtns = false;\n                    saveBtn.Enabled = true;\n                }\n                finally\n                {\n                    requireConnect.Close();\n                    LoadDataFromAccess();\n                }\n            }\n            else if (BindnSource.Count &gt; 0)\n            {\n                //сохранение отредактированных данных\n                int position = BindnSource.Position;\n                int updateId = Convert.ToInt32(((DataRowView)this.BindnSource.Current).Row[\"ID_group\"]);\n                try\n                {\n                    requireConnect.Close();\n                    requireConnect.Open();\n                    OleDbCommand Update = new OleDbCommand(\"UPDATE Groups SET Course=@course, Specialty=@specialty, numberOfGroup=@numberOfGroup WHERE ID_group=@update_ID\", requireConnect);\n                    Update.Parameters.AddWithValue(\"@course\", nCourse.Text);\n                    Update.Parameters.AddWithValue(\"@specialty\", cbSpecialty.Text);\n                    Update.Parameters.AddWithValue(\"@numberOfGroup\", tbNumberOfGroup.Text);\n                    Update.Parameters.AddWithValue(\"@update_ID\", updateId);\n                    Update.ExecuteNonQuery();\n                    MessageBox.Show(\"Запись обновлена\");\n                }\n                finally\n                {\n                    requireConnect.Close();\n                    LoadDataFromAccess();\n                    BindnSource.Position = position;\n                }\n            }\n        }\n\n        private void tbNumberOfGroup_TextChanged(object sender, EventArgs e)\n        {\n            if (this.Text == \"\") saveBtn.Enabled = false;\n            else saveBtn.Enabled = true;\n        }\n    }\n}\n</code></pre>\n"}