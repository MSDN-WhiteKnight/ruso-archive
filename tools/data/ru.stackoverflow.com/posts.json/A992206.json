{"owner":{"reputation":16058,"user_id":240512,"user_type":"registered","profile_image":"https://i.stack.imgur.com/Ew6lG.png?s=128&g=1","display_name":"MSDN.WhiteKnight","link":"https://ru.stackoverflow.com/users/240512/msdn-whiteknight"},"is_accepted":true,"score":0,"last_activity_date":1560403148,"creation_date":1560403148,"answer_id":992206,"question_id":992088,"body":"<p>Чтобы получить имена всех таблиц, не прописывая их в коде, можно сделать запрос к схеме БД. Для этого существует метод <a href=\"https://docs.microsoft.com/ru-ru/dotnet/api/system.data.common.dbconnection.getschema?view=netstandard-2.1\" rel=\"nofollow noreferrer\">DbConnection.GetSchema</a>. Провайдер ADO.NET для SQL Server предоставляет схему <a href=\"https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/sql-server-schema-collections?view=netstandard-2.1#tables\" rel=\"nofollow noreferrer\">Tables</a>, содержащую имена таблиц. </p>\n\n<p>Простейший код вывода всех таблиц БД в ListBox'ах будет выглядеть как-то так:</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Text;\nusing System.Windows.Forms;\nusing System.Threading.Tasks;\nusing System.Data;\nusing System.Data.Common;\nusing System.Data.SqlClient;\nusing System.Linq;\n\nnamespace WindowsFormsApp1\n{\n    public partial class Form1 : Form\n    {        \n        public Form1()\n        {\n            InitializeComponent();            \n        }        \n\n        public static IEnumerable&lt;string&gt; QueryTableNames(DbConnection con)\n        {            \n            //получение списка всех таблиц в БД\n            DataTable dtSchema = con.GetSchema(\"Tables\");\n\n            foreach (DataRow row in dtSchema.Rows)\n            {\n                if ((string)row[\"TABLE_TYPE\"] == \"BASE TABLE\")\n                {\n                    yield return (string)row[\"TABLE_NAME\"];\n                }\n            }\n        }\n\n        public static async Task&lt;DataTable&gt; QueryTable(DbCommand cmd,string name)\n        {             \n            //получение таблицы\n            DbDataReader rd = await cmd.ExecuteReaderAsync();\n            using (rd)\n            {\n                DataTable dt = new DataTable();\n                await Task.Run(() =&gt; { dt.Load(rd); });                                \n                dt.TableName = name;\n                return dt;\n            }            \n        }\n\n        public static void DisplayTables(Control control, IEnumerable&lt;DataTable&gt; tables)\n        {\n            //вывод набора таблиц в указанном элементе управления сontrol\n\n            //создадим FlowLayoutPanel для группировки элементов в столбик\n            FlowLayoutPanel pan = new FlowLayoutPanel();            \n            pan.FlowDirection = FlowDirection.TopDown;            \n            pan.Dock = DockStyle.Fill;\n\n            foreach (DataTable t in tables)\n            {\n                //создадим GroupBox с именем таблицы\n                GroupBox gb = new GroupBox();\n                gb.Text = \"Table [\" + t.TableName+\"]\";\n                gb.Width = 400;\n                gb.Height = 150;\n\n                //создадим ListBox для отображения данных таблицы\n                ListBox lb = new ListBox();                \n                lb.Dock = DockStyle.Fill;\n\n                foreach (DataRow row in t.Rows)\n                {                    \n                    lb.Items.Add(String.Join(\" \", row.ItemArray));\n                }\n\n                gb.Controls.Add(lb);\n                pan.Controls.Add(gb);\n            }\n\n            control.Controls.Clear();\n            control.Controls.Add(pan);\n        }\n\n        public async Task DisplayBase()\n        {\n            string connstr = @\"...\";\n            SqlConnection con = new SqlConnection(connstr);\n\n            using (con)\n            {\n                await con.OpenAsync();\n\n                //загружаем схему\n                IEnumerable&lt;string&gt; table_names = QueryTableNames(con);\n                List&lt;DataTable&gt; tables = new List&lt;DataTable&gt;(table_names.Count());\n                SqlCommand cmd;\n\n                //загружаем данные\n                foreach (string t in table_names)\n                {\n                    cmd = new SqlCommand(\"SELECT * FROM [\" + t + \"]\", con);\n                    tables.Add(await QueryTable(cmd, t));\n                }\n\n                //отображаем данные в элементе panel1\n                panel1.SuspendLayout();\n                DisplayTables(panel1, tables);\n                panel1.ResumeLayout();\n            }\n        }\n\n        private async void Form1_Load(object sender, EventArgs e)\n        {                                    \n            await DisplayBase();              \n        }              \n    }  \n}\n</code></pre>\n"}