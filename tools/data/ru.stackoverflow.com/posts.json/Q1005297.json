{"tags":["c++","visual-c++"],"owner":{"reputation":316,"user_id":271366,"user_type":"registered","profile_image":"https://www.gravatar.com/avatar/b6ed83ad1d797a7b2333c48cb3f6baf2?s=128&d=identicon&r=PG&f=1","display_name":"digital-mag","link":"https://ru.stackoverflow.com/users/271366/digital-mag"},"is_answered":true,"view_count":75,"accepted_answer_id":1005505,"answer_count":1,"score":2,"last_activity_date":1563796262,"creation_date":1563738294,"last_edit_date":1563796262,"question_id":1005297,"link":"https://ru.stackoverflow.com/questions/1005297/%d0%a3%d0%ba%d0%b0%d0%b7%d0%b0%d1%82%d0%b5%d0%bb%d1%8c-%d0%bd%d0%b0-%d1%82%d0%b5%d0%bb%d0%be-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b8","title":"Указатель на тело функции?","body":"<p>Столкнулся я с проблемой изменения кода функции в целях оптимизации (прошу прощения за си-стиль): </p>\n\n<pre><code>    static inline bool ECX_to_EBX(void *ptr) {\n\n        map&lt;byte*, byte&gt; ecxs;\n        ecxs[(((byte*)ptr) + 18)] = 0xBB;\n        ecxs[(((byte*)ptr) + 67)] = 0x5D;\n        ecxs[(((byte*)ptr) + 69)] = 0x53;\n\n        size_t wr;\n        for (map&lt;byte*, byte&gt;::iterator pair_item = ecxs.begin(); pair_item != ecxs.end(); ++pair_item)\n        {\n            WriteProcessMemory(GetCurrentProcess(), pair_item-&gt;first, &amp;pair_item-&gt;second, sizeof(byte), (SIZE_T*)&amp;wr);          \n\n            if (wr == 0) return true;\n#ifdef LOG\n            else MessageBoxA(0, \"\", \"replaced\", 0);\n#endif\n        }\n\n        return 0;\n    }\n</code></pre>\n\n<p>где в <code>ptr</code> ожидается указатель на конкретную функцию, которую я уже разобрал на ассемблерные составляющие и хочу немного подкорректировать (заменить регистр ECX на EBX). Эта конкретная функция выглядит так: </p>\n\n<pre><code>struct MyClass{\n    static void MyFunc();\n}\n</code></pre>\n\n<p>Передаю ее в качестве аргумента:</p>\n\n<pre><code>Utils::ECX_to_EBX(MyClass::MyFunc);\n</code></pre>\n\n<p>Смотрю в памяти, а там не то. Оказывается, что MyClass::MyFunc дает указатель на <code>jmp MyProgram.MyClass::MyFunc</code> вместо указателя на само тело функции. Собственно вопрос, как получить указатель на первый байт тела (без вычисления относительного адреса относительно jmp) и почему я получаю указатель на jmp вместо него? </p>\n\n<p>Это особенность компилятора visual-c++ или какие-то ключи компиляции?</p>\n\n<p>На MinGW я такого казуса не припомню</p>\n"}