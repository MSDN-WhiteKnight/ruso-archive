{"owner":{"reputation":4644,"user_id":287068,"user_type":"registered","profile_image":"https://i.stack.imgur.com/F1Hyn.jpg?s=128&g=1","display_name":"freim","link":"https://ru.stackoverflow.com/users/287068/freim"},"is_accepted":false,"score":4,"last_activity_date":1542220191,"last_edit_date":1542220191,"creation_date":1542193696,"answer_id":906424,"question_id":906246,"body":"<p>В дополнение к ответу от @MSDN.WhiteKnight стоит упомянуть полезную функцию WinAPI <code>MoveFileEx</code> с флагом <code>MOVEFILE_DELAY_UNTIL_REBOOT</code>. В принципе, одной этой функции достаточно для удаления, и некоторые инсталляторы ее и используют для самоудаления анинсталлера. Проблема с ней только в том, что каталог программы при этом не удаляется (что мы и видим у некоторых приложений).</p>\n\n<p>Для полного удаления вместе с каталогом используется двухступенчатый процесс, как описано в предыдущем ответе:</p>\n\n<ol>\n<li>Записать в <code>Temp</code> программу (или батник) удаления.</li>\n<li>Запустить ее, при этом удалялка должна уметь дожидаться выхода\nзапустившего ее анисталлера.</li>\n<li>Вызвать <code>MoveFileEx(szDeleterPath, NULL, MOVEFILE_DELAY_UNTIL_REBOOT);</code> для удаления после рестарта системы удалялки из <code>Temp</code>.</li>\n<li>Выйти.</li>\n</ol>\n\n<p>Вместо вызова <code>MoveFileEx</code> можно удалять через реестр. Для этого в <code>HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce</code> нужно создать текстовое значение с произвольным именем (например, <code>DeleteMyApp</code>), и строкой <code>cmd /C del \"путь_к_программе_удаления\"</code>. При следующем рестарте Windows выполнит эту команду и удалит это значение из реестра.</p>\n"}