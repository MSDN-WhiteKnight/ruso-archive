{"owner":{"reputation":16058,"user_id":240512,"user_type":"registered","profile_image":"https://i.stack.imgur.com/Ew6lG.png?s=128&g=1","display_name":"MSDN.WhiteKnight","link":"https://ru.stackoverflow.com/users/240512/msdn-whiteknight"},"is_accepted":false,"score":5,"last_activity_date":1559019866,"creation_date":1559019866,"answer_id":986381,"question_id":986272,"body":"<p>Начать с того, что это не исключение, а диагностическое сообщение CLR (которое автоматически включено при запуске под отладчиком). Оно действительно может выводиться через раз, так как невозможно автоматически определить каждый выстрел в ногу с некорректным использованием P/Invoke, но ложной тревогой оно является редко.</p>\n\n<p>Как исправить? Сделать то, что написано - привести объявление P/Invoke в соответствие с реальным прототипом функции. Если загрузить с сайта <a href=\"https://www.matrixtsl.com/allcode/resources/\" rel=\"noreferrer\">AllCode</a> пример для С++, в заголовочном файле можно найти такое объявление:</p>\n\n<pre><code>__declspec(dllimport) unsigned char FA_ComOpen( unsigned char Port );\n</code></pre>\n\n<p>Оно уже не соответствует вашему. Во-первых, не указанное соглашение о вызове - это cdecl, а в P/Invoke по умолчанию - stdcall. Во-вторых, Типу unsigned char в C# соответствует byte, а не char. Если предположить, что объявление для С++ правильное, объявление для C# должно выглядеть так:</p>\n\n<pre><code>[DllImport(\"FASlave.dll\", CallingConvention = CallingConvention.Cdecl)]\nstatic extern byte FA_ComOpen(byte Port); \n</code></pre>\n"}