{"tags":["c#","iframe","webbrowser"],"owner":{"reputation":514,"user_id":193306,"user_type":"registered","accept_rate":19,"profile_image":"https://lh3.googleusercontent.com/-_PVhno94Ga0/AAAAAAAAAAI/AAAAAAAAINU/ktc-cgDHWcU/photo.jpg?sz=128","display_name":"Sergej Loos","link":"https://ru.stackoverflow.com/users/193306/sergej-loos"},"is_answered":true,"view_count":227,"answer_count":2,"score":1,"last_activity_date":1516640600,"creation_date":1516292503,"last_edit_date":1516292869,"question_id":772547,"link":"https://ru.stackoverflow.com/questions/772547/c-system-windows-forms-webbrowser-%d0%b8-%d0%ba%d0%be%d0%b4-%d1%82%d0%b5%d0%ba%d1%81%d1%82%d0%b0-%d0%b4%d0%bb%d1%8f-iframe","title":"c#. System.Windows.Forms.WebBrowser и код текста для IFrame","body":"<p>Использую стандартный System.Windows.Forms.WebBrowser для загрузки и отображения одной вебстраницы. WebBrowser эмулирует 11 версию IE. Страница имеет IFrame и отображается нормально.</p>\n\n<p>Мне необходимо получить полный HTML код страницы с содержимым IFrame, но эти элементы пусты. В полноценном IE html-код можно видеть. Текст кода пробую получать следующими двумя способами:</p>\n\n<pre><code>public String HtmlDocumentText {\n  get { return webBrowser.DocumentText; }\n}\n\npublic String DomDocumentText {\n  get {\n  // REM. http://stackoverflow.com/questions/3640236/converting-htmldocument-domdocument-to-string\n  var document = webBrowser.Document;\n  var documentAsIHtmlDocument3 = (mshtml.IHTMLDocument3)document.DomDocument;\n  var content = documentAsIHtmlDocument3.documentElement.outerHTML;\n  return content;\n  }\n}\n</code></pre>\n\n<p>Мне кажется, что проблема заключается в ограничениях безопасности для этого элемента, потому как следующий код вызывает ошибку доступа:</p>\n\n<pre><code>var frames = webBrowser.DocumentTestToDelete.Window.Frames;\nvar frame1 = webBrowser.DocumentTestToDelete.Window.Frames[0];\nvar document1 = frame1.Document;\n</code></pre>\n\n<p>Ошибка:\n    Access Denied (Exception from HRESULT: 0x80070005 (E_ACCESSDENIED)).</p>\n\n<p>Замечу, что мне удалось получить код IFrames при помощи JavaScript:</p>\n\n<pre><code>string jCode = \"var iframe = document.getElementById('frame-id'); var innerDoc = iframe.contentDocument || iframe.contentWindow.document; innerDoc.documentElement.innerHTML\";\nObject html = webBrowser.WebBrowser.Document.InvokeScript(\"eval\", new object[] { jCode });\n</code></pre>\n\n<p>Но это не то что надо, хотя я мог бы такой подход использовать, но с большими трудозатратами. Может быть есть способ заставить WebControl отдавать полный html вместе с содержимым IFrame?</p>\n"}