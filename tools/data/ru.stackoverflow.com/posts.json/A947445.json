{"owner":{"reputation":16137,"user_id":240512,"user_type":"registered","profile_image":"https://i.stack.imgur.com/Ew6lG.png?s=128&g=1","display_name":"MSDN.WhiteKnight","link":"https://ru.stackoverflow.com/users/240512/msdn-whiteknight"},"is_accepted":false,"score":1,"last_activity_date":1550727464,"creation_date":1550727464,"answer_id":947445,"question_id":660695,"body":"<p>В Windows для записи в Excel файлы можно использовать <a href=\"https://docs.microsoft.com/en-us/sql/odbc/microsoft/microsoft-odbc-desktop-database-drivers?view=sql-server-2017\" rel=\"nofollow noreferrer\">ODBC</a>, который позволяет работать с листами Excel как с обычными таблицами в БД.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;tchar.h&gt;\n#include &lt;locale.h&gt;\n#include &lt;Windows.h&gt;\n#include &lt;sqlext.h&gt;\n\nWCHAR szDSN[] = L\"Driver={Microsoft Excel Driver (*.xls)};DSN='';CREATE_DB=\\\"C:\\\\test\\\\newfile.xls\\\";DBQ=C:\\\\test\\\\newfile.xls;READONLY=0;\";\n\nBOOL ExecuteSql(HDBC hDbc, LPWSTR query){\n\n    RETCODE rc;\n    HSTMT hStmt;\n    WCHAR bufstate[10]=L\"\";\n    WCHAR buferr[1024]=L\"\";\n    SQLINTEGER i;\n    SQLSMALLINT cch;\n    BOOL result;\n\n    wprintf(L\"&gt;%s\\n\", query);\n\n    /* Prepare SQL query */\n    rc = SQLAllocStmt(hDbc,&amp;hStmt);\n\n    if(!SQL_SUCCEEDED(rc)){\n        wprintf(L\"SQLAllocStmt failed\\n\");\n        return FALSE;\n    }\n\n    rc = SQLPrepare(hStmt, query, SQL_NTS);   \n\n    if(!SQL_SUCCEEDED(rc)){\n        wprintf(L\"SQLPrepare failed\\n\");\n        SQLFreeHandle(SQL_HANDLE_STMT,hStmt);\n        return FALSE;\n    }\n\n    /* Excecute the query */\n    rc = SQLExecute(hStmt); \n\n    if (SQL_SUCCEEDED(rc)) {\n        wprintf(L\"SQL Success\\n\");\n        result = TRUE;\n    }\n    else{       \n        SQLGetDiagRec(SQL_HANDLE_STMT,hStmt,1,bufstate,&amp;i,buferr,sizeof(buferr)/sizeof(buferr[0]),&amp;cch);\n        wprintf(L\"SQL Error. Code: %d; Message: %s\\n\",i,buferr);    \n        result = FALSE;\n    }\n\n    SQLFreeHandle(SQL_HANDLE_STMT,hStmt);\n    return result;\n}\n\nint _tmain(int argc, _TCHAR* argv[])\n{    \nsetlocale(LC_ALL,\"Russian\");\nHENV    hEnv;\nHDBC    hDbc;\n\n/* ODBC API return status */\nRETCODE rc;\n\nint     iConnStrLength2Ptr;\nWCHAR    szConnStrOut[256];\n\n/* Allocate an environment handle */\nrc = SQLAllocEnv(&amp;hEnv);\n/* Allocate a connection handle */\nrc = SQLAllocConnect(hEnv, &amp;hDbc);\n\n/* Connect to the database */\nrc = SQLDriverConnect(hDbc, NULL, (WCHAR*)szDSN, \n    SQL_NTS, (WCHAR*)szConnStrOut, \n    255, (SQLSMALLINT*)&amp;iConnStrLength2Ptr, SQL_DRIVER_NOPROMPT);\n\nif (SQL_SUCCEEDED(rc)) \n{\n    wprintf(L\"Successfully connected to database. Data source name: \\n  %s\\n\", \n        szConnStrOut);  \n\n    ExecuteSql(hDbc,L\"CREATE TABLE [Test] ([Имя] TEXT, [Фамилия] TEXT)\");   \n    ExecuteSql(hDbc,L\"INSERT INTO [Test] VALUES ('Иван','Иванов')\");    \n}\nelse\n{\n    wprintf(L\"Couldn't connect to %s.\\n\",szDSN);\n}\n\n/* Disconnect and free up allocated handles */\nSQLDisconnect(hDbc);\nSQLFreeHandle(SQL_HANDLE_DBC, hDbc);\nSQLFreeHandle(SQL_HANDLE_ENV, hEnv);\n\ngetchar();\nreturn 0;\n}\n</code></pre>\n"}