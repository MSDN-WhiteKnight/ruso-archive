{"owner":{"reputation":16068,"user_id":240512,"user_type":"registered","profile_image":"https://i.stack.imgur.com/Ew6lG.png?s=128&g=1","display_name":"MSDN.WhiteKnight","link":"https://ru.stackoverflow.com/users/240512/msdn-whiteknight"},"is_accepted":true,"score":2,"last_activity_date":1525327832,"last_edit_date":1525327832,"creation_date":1525326755,"answer_id":822465,"question_id":822344,"body":"<p>Имя для виртуального каталога проводника можно получить с помощью интерфейса <em>IShellItem</em>:</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Text;\nusing System.Runtime.InteropServices;\n\nnamespace WindowsFormsTest1\n{\n    class ShellFolder\n    {\n        //Получает локализованное имя для системной папки\n        public static string GetKnownFolderName(ref Guid FolderID)\n        {\n            //https://stackoverflow.com/questions/41423491/how-to-get-localized-name-of-known-folder\n            IntPtr p = IntPtr.Zero;\n            IShellItem pItem = null;\n            IntPtr pString = IntPtr.Zero;\n\n            Guid guid = new Guid(\"43826D1E-E718-42EE-BC55-A1E261C37BFE\");//IShellItem\n            int hr;    \n\n            hr = SHGetKnownFolderIDList(ref FolderID, 0, IntPtr.Zero, out p);\n            if (hr != 0) throw Marshal.GetExceptionForHR(hr);\n\n            try\n            {\n\n                hr = SHCreateItemFromIDList(p, ref guid, out pItem);\n                if (hr != 0) throw Marshal.GetExceptionForHR(hr);\n\n                hr = pItem.GetDisplayName(0, out pString);\n                if (hr != 0) throw Marshal.GetExceptionForHR(hr);\n\n                string s = Marshal.PtrToStringUni(pString);\n\n                return s;\n            }\n            finally\n            {\n                if (p != IntPtr.Zero) IlFree(p);\n                if (pString != IntPtr.Zero) CoTaskMemFree(pString);\n                if (pItem != null) Marshal.ReleaseComObject(pItem);\n            }\n        }\n\n\n        //Получает локализованное имя для системной папки (устаревший вариант)       \n        public static string GetKnownFolderName(uint csidl)\n        {\n            //https://stackoverflow.com/questions/41423491/how-to-get-localized-name-of-known-folder\n            IntPtr p = IntPtr.Zero;\n            IShellItem pItem = null;\n            IntPtr pString = IntPtr.Zero;\n\n            Guid guid = new Guid(\"43826D1E-E718-42EE-BC55-A1E261C37BFE\");//IShellItem\n            int hr;\n\n            hr = SHGetFolderLocation(IntPtr.Zero, (int)csidl, IntPtr.Zero, 0, out p);\n            if (hr != 0) throw Marshal.GetExceptionForHR(hr);\n\n            try\n            {\n\n                hr = SHCreateItemFromIDList(p, ref guid, out pItem);\n                if (hr != 0) throw Marshal.GetExceptionForHR(hr);\n\n                hr = pItem.GetDisplayName(0, out pString);\n                if (hr != 0) throw Marshal.GetExceptionForHR(hr);\n\n                string s = Marshal.PtrToStringUni(pString);\n\n                return s;\n            }\n            finally\n            {\n                if (p != IntPtr.Zero) IlFree(p);\n                if (pString != IntPtr.Zero) CoTaskMemFree(pString);\n                if (pItem != null) Marshal.ReleaseComObject(pItem);\n            }\n        }                \n\n        public static Guid FOLDERID_ComputerFolder = new Guid(\"0AC0837C-BBF8-452A-850D-79D08E667CA7\");\n        public static Guid FOLDERID_NetworkFolder = new Guid(\"D20BEEC4-5CA8-4905-AE3B-BF251EA09B53\");\n        //https://www.pinvoke.net/default.aspx/shell32.shgetknownfolderpath\n\n        //CSIDL Folder Constants\n        public const uint CSIDL_DESKTOP = 0x00;//Рабочий стол\n        public const uint CSIDL_NETWORK = 0x12;//Сетевое окружение\n        public const uint CSIDL_DRIVES = 0x0011;//Компьютер\n        //...\n        //https://github.com/lxn/win/blob/master/shell32.go\n\n        [DllImport(\"shell32.dll\")]\n        static extern int SHCreateItemFromIDList(\n            /*PCIDLIST_ABSOLUTE*/ IntPtr pidl,\n            ref Guid riid,\n            [Out, MarshalAs(UnmanagedType.Interface)] out IShellItem ppv);\n\n        [DllImport(\"shell32.dll\")]\n        public static extern int SHGetKnownFolderIDList(ref Guid rfid, int dwFlags, IntPtr hToken, out IntPtr ppidl);\n\n        [DllImport(\"shell32.dll\")]\n        static extern int SHGetFolderLocation(IntPtr hwndOwner, int nFolder,\n           IntPtr hToken, uint dwReserved, out IntPtr ppidl);\n\n        [DllImport(\"shell32.dll\", EntryPoint = \"ILFree\")]\n        static extern void IlFree(IntPtr p);\n\n        [DllImport(\"ole32.dll\")]\n        static extern void CoTaskMemFree(IntPtr pv);\n    }\n\n    [ComImport,\n    Guid(\"43826D1E-E718-42EE-BC55-A1E261C37BFE\"),\n    InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]\n    public interface IShellItem\n    {\n        int a();\n        int b();\n\n        [PreserveSig]\n        int GetDisplayName([In] uint sigdnName, out IntPtr ppszName); //SIGDN_NORMALDISPLAY = 0x00000000\n\n        int c();\n        int d();\n    }\n\n\n}\n</code></pre>\n\n<p>Использование:</p>\n\n<pre><code>private void button1_Click(object sender, EventArgs e)\n{\n    string name = ShellFolder.GetKnownFolderName(ref ShellFolder.FOLDERID_ComputerFolder);\n    MessageBox.Show(name);\n}\n</code></pre>\n"}