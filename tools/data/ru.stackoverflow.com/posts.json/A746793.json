{"owner":{"reputation":16058,"user_id":240512,"user_type":"registered","profile_image":"https://i.stack.imgur.com/Ew6lG.png?s=128&g=1","display_name":"MSDN.WhiteKnight","link":"https://ru.stackoverflow.com/users/240512/msdn-whiteknight"},"is_accepted":false,"score":1,"last_activity_date":1511110031,"creation_date":1511110031,"answer_id":746793,"question_id":676450,"body":"<p>Для получения графического представления звука нужно использовать метод <a href=\"http://bass.radio42.com/help/html/a13cfef0-1056-bb94-81c4-a4fdf21bd463.htm\" rel=\"nofollow noreferrer\">BASS_ChannelGetData</a> с флагом <code>BASS_DATA_FFT...</code> Метод возвращает массив амплитуд для набора диапазонов частот. Из него нужно отбросить первый элемент (0 Гц - это постоянная составляющая), и построить график по относительным значениям амплитуды и частоты. </p>\n\n<p>Пример кода для вывода графика в Windows Forms (на форме нужно поместить элементы Button, Panel и Timer):</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.Drawing;\nusing System.Text;\nusing System.Windows.Forms;\nusing Un4seen.Bass;\n\nnamespace BassTest\n{\n    public partial class Form1 : Form\n    {\n        public Form1()\n        {\n            InitializeComponent();\n        }\n\n        int chan = 0;//номер потока\n        Single[] fft=null;//массив данных спектра\n\n        private void button1_Click(object sender, EventArgs e)\n        {\n            int n=Bass.BASS_GetDevice();//получаем устройство по умолчанию\n            if (Bass.BASS_Init(n, 44100, 0, IntPtr.Zero) == false)\n            {\n                MessageBox.Show(\"BASS_Init failed\");\n                return;\n            }\n\n            chan = Bass.BASS_StreamCreateFile(@\"C:\\MP3\\file.mp3\",\n                0, 0, BASSFlag.BASS_SAMPLE_FLOAT | BASSFlag.BASS_SAMPLE_LOOP);//создаем поток в режиме FLOAT\n\n            if (chan == 0)\n            {\n                MessageBox.Show(\"BASS_StreamCreateFile failed\");\n                return;\n            }\n\n            bool f;\n            f = Bass.BASS_ChannelPlay(chan, false);//воспроизводим поток\n            if (f == false)\n            {\n                MessageBox.Show(\"BASS_ChannelPlay failed\");\n                return;\n            }\n\n        }\n\n        private void timer1_Tick(object sender, EventArgs e)//запускаем каждые 500 мс\n        {\n            if (chan == 0) return;\n            if (Bass.BASS_ChannelIsActive(chan) != BASSActive.BASS_ACTIVE_PLAYING) return;\n\n            fft = new Single[2048];//выделяем массив для данных            \n            Bass.BASS_ChannelGetData(chan, fft, (int)BASSData.BASS_DATA_FFT4096);//получаем спектр потока\n            fft[0] = 0.0f;//избавляемся от постоянной составляющей            \n\n            panel1.Refresh();//перерисовка графика\n        }\n\n        private void panel1_Paint(object sender, PaintEventArgs e)//построение графика\n        {\n            if (fft == null) return;            \n\n            PointF p1,p2;            \n            float max_y = 0;//максимальное значение амплитуды\n            float min_y=Single.MaxValue;//минимальное значение амплитуды\n            float max_x = fft.Length - 1;//максимальная частота, для которой амплитуда ненулевая\n\n            int i = 0;\n            max_x = 0;\n            foreach(float f in fft)//находим максимальные и минимальные значения\n            {\n                if (f &gt; max_y) max_y = f;\n                if (f &lt; min_y) min_y = f;\n\n                if (f &gt; 0.001f) max_x = (float)i;\n                i++;\n            }             \n\n            /*меняем направление оси Y, чтобы она смотрела вверх*/\n            e.Graphics.ScaleTransform(1.0f,-1.0f);\n            e.Graphics.TranslateTransform(0.0f, -1.0f * panel1.Height);\n\n            System.Drawing.Drawing2D.GraphicsPath path = new System.Drawing.Drawing2D.GraphicsPath();\n\n            float y;\n            p1 = new PointF(0.0f, 0.0f);//начальная точка\n\n            for (float x = 1; x &lt;= max_x; x++)\n            {                \n                y = fft[(int)x];\n\n                /*вычисляем координату следующей точки по относительной амплитуде*/\n                p2 = new PointF((x / max_x) * panel1.Width, panel1.Height * (y - min_y) / (max_y - min_y));\n\n                path.AddLine(p1, p2);//добавляем линию в график\n                p1 = p2;\n            }\n            e.Graphics.DrawPath(Pens.Black, path);\n\n        }\n    }\n}\n</code></pre>\n\n<p>Выглядит так (не настолько красиво, как в WMP, но уже что-то):</p>\n\n<p><a href=\"https://i.stack.imgur.com/1fI0P.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1fI0P.png\" alt=\"BASS FFT\"></a></p>\n"}