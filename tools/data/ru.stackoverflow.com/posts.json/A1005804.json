{"owner":{"reputation":6054,"user_id":17974,"user_type":"registered","accept_rate":83,"profile_image":"https://www.gravatar.com/avatar/e65c04f96eb45f1dec239d85c76d6afa?s=128&d=identicon&r=PG","display_name":"nick_n_a","link":"https://ru.stackoverflow.com/users/17974/nick-n-a"},"is_accepted":true,"score":3,"last_activity_date":1563875006,"last_edit_date":1563875006,"creation_date":1563873612,"answer_id":1005804,"question_id":1005799,"body":"<p>По шапке. Файлы нового экселя xlsx начинаются PK - сигнатурой zip-а <code>50 4B</code>. С такой сигнатурой могут быть не только xlsx а ещё и docx да и zip архивы, нужно вычитывать список упакованых файлов, для уточнения.</p>\n\n<p>Файлы .xls - бывают двух типов, \"новые\" xls (обычно именно такие встречаются).\nОни имеют сигнатуру <code>D0 CF 1 E0 A1 B1 1A E1</code> (на самом деле это сигнатура документа офис, для полее подробной идентификации, т.е. doc и xls будут иметь одинаковую сигнатуру, нужно искать \"главное\" вложение в biff обвертке, и проверять там сигнатуру, либо по списку файлов biff-обвертки), и соовсем старые (до 7 версии, 6-тая не была в обиходе) имеют сигнатуру <code>09 08</code></p>\n\n<p>Например можно так</p>\n\n<pre><code> byte[] xlsDoc = f(); // Загрузили документ в байты\n if ((xlsDoc[0]==0x50) &amp;&amp; (xlsDoc[1]==0x4B)) {\n     // Новый ексель\n      } \n else if ((xlsDoc[0]==0xD0) &amp;&amp; (xlsDoc[1]==0xCF) /*...*/) {\n    // Офис 97\n }\n else if ((xlsDoc[0]==9) &amp;&amp; (xlsDoc[1]==8)) {\n    // Старый одностраничный\n } else {\n    // В других случаях - думаю что мусор\n }\n</code></pre>\n\n<p>Т.к. файл может быть большой, то лучше вычитать первые 16 байт, и их проанализировать, а потом вернуть <code>Stream.Position</code> в ноль.</p>\n\n<p>Ещё с excel мне попадались приколы</p>\n\n<ul>\n<li>xml <code>&lt;?xml</code> - файл с excel (если в excel сохранить файл как xml)</li>\n<li>html excel <code>&lt;html</code>  - часто советуют такой файл делать в интернете javascipt-ом php и т п, - таблица с <code>&lt;td&gt;</code> <code>&lt;tr&gt;</code> тегами и определенными приписками.</li>\n</ul>\n\n<p>Ссылки на сигнатуры</p>\n\n<ol>\n<li><a href=\"http://uk.wikipedia.org/wiki/%D0%A1%D0%B8%D0%B3%D0%BD%D0%B0%D1%82%D1%83%D1%80%D0%B0_%D1%84%D0%B0%D0%B9%D0%BB%D1%83_(%D0%BF%D0%B5%D1%80%D0%B5%D0%BB%D1%96%D0%BA)\" rel=\"nofollow noreferrer\">http://uk.wikipedia.org/wiki/%D0%A1%D0%B8%D0%B3%D0%BD%D0%B0%D1%82%D1%83%D1%80%D0%B0_%D1%84%D0%B0%D0%B9%D0%BB%D1%83_(%D0%BF%D0%B5%D1%80%D0%B5%D0%BB%D1%96%D0%BA)</a></li>\n<li><a href=\"http://www.filesignatures.net/index.php?page=search&amp;search=XLS&amp;mode=EXT\" rel=\"nofollow noreferrer\">http://www.filesignatures.net/index.php?page=search&amp;search=XLS&amp;mode=EXT</a></li>\n<li><a href=\"http://www.filesignatures.net/index.php?page=search&amp;search=XLSX&amp;mode=EXT\" rel=\"nofollow noreferrer\">http://www.filesignatures.net/index.php?page=search&amp;search=XLSX&amp;mode=EXT</a></li>\n<li><a href=\"http://en.wikipedia.org/wiki/Microsoft_Excel\" rel=\"nofollow noreferrer\">http://en.wikipedia.org/wiki/Microsoft_Excel</a></li>\n</ol>\n"}