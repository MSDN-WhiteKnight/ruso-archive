{"tags":["c#","wpf","windows","clickonce","keyboardhook"],"owner":{"reputation":2673,"user_id":195735,"user_type":"registered","accept_rate":93,"profile_image":"https://i.stack.imgur.com/2XXyN.jpg?s=128&g=1","display_name":"klutch1991","link":"https://ru.stackoverflow.com/users/195735/klutch1991"},"is_answered":true,"view_count":530,"answer_count":1,"score":5,"last_activity_date":1573210869,"creation_date":1514451727,"last_edit_date":1573210869,"question_id":764352,"link":"https://ru.stackoverflow.com/questions/764352/%d0%9a%d0%b0%d0%ba-%d0%be%d1%82%d0%bb%d0%be%d0%b2%d0%b8%d1%82%d1%8c-%d0%bd%d0%b0%d0%b6%d0%b0%d1%82%d0%b8%d0%b5-%d0%ba%d0%bb%d0%b0%d0%b2%d0%b8%d1%88-%d0%b2-wpf-%d0%bf%d1%80%d0%b8%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d0%b8-%d0%ba%d0%be%d0%b3%d0%b4%d0%b0-%d0%be%d0%bd%d0%be-%d1%81%d0%b2%d1%91%d1%80%d0%bd%d1%83%d1%82%d0%be","title":"Как отловить нажатие клавиш в WPF-приложении, когда оно свёрнуто?","body":"<p>Имеется <strong>WPF</strong>-приложение (аудио-проигрыватель). Необходимо добавить возможность отлавливать нажатие определённых клавиш, даже когда приложение свёрнуто. Например, при нажатии <em>Num4</em> - останавливать вопроизведение, при нажатии других клавиш (в зависимости от настроек - продолжать воспроизведение музыки и т.п.). \nПробовал реализовать через функцию <code>GetAsyncKeyState(int vkey)</code> из <code>user32.dll</code>, но мне это не совсем подходит, вот пример кода:</p>\n\n<pre><code>public static class KeyState\n{\n    public static void Wait(Key key, Action&lt;KeyStates&gt; action)\n    {\n        var asyncOperation = AsyncOperationManager.CreateOperation(null);\n        SendOrPostCallback callBack = state =&gt; action((KeyStates) state);\n        ThreadPool.QueueUserWorkItem(state =&gt;\n        {\n            var vk = KeyInterop.VirtualKeyFromKey(key);                \n            var prev = ((GetAsyncKeyState(vk) &amp; 0x8000) == 0x8000);\n            if (prev)\n            {\n                asyncOperation.Post(callBack, KeyStates.Down);\n            }\n            while (true)\n            {\n                var res = ((GetAsyncKeyState(vk) &amp; 0x8000) == 0x8000);\n                if (res != prev &amp;&amp; res)\n                {\n                    asyncOperation.Post(callBack, KeyStates.Down);\n                }\n                prev = res;\n            }\n        });\n    }\n\n    [DllImport(\"user32.dll\", CharSet = CharSet.Auto, ExactSpelling = true)]\n    private static extern short GetAsyncKeyState(int vkey);\n}\n</code></pre>\n\n<p>Проблема здесь в том, что мне не только нужно <strong>отловить</strong> нажатие клавиши, но и п<strong>редотвратить \"продвижение\"</strong> нажатия клавиши далее. Т.е. нажатие клавиши должно перехватываться моим приложением и не попадать в другие (например, в текстовый редактор).\nБуду благодарен за помощь. Если кто-нибудь ещё и подскажет как это корректно реализовать для приложения, которое развертывается через <em>ClickOnce</em>, было бы вообще шикарно. Спасибо! </p>\n"}