{"tags":["c#",".net","struct","com-port"],"owner":{"reputation":23,"user_id":290522,"user_type":"registered","profile_image":"https://graph.facebook.com/1818200591564425/picture?type=large","display_name":"Igor Kassir","link":"https://ru.stackoverflow.com/users/290522/igor-kassir"},"is_answered":true,"view_count":120,"accepted_answer_id":801807,"answer_count":2,"score":2,"last_activity_date":1521556357,"creation_date":1521473380,"last_edit_date":1521480689,"question_id":801587,"link":"https://ru.stackoverflow.com/questions/801587/%d0%9f%d0%be%d0%b1%d0%b0%d0%b9%d1%82%d0%bd%d0%b0%d1%8f-%d0%b7%d0%b0%d0%bf%d0%b8%d1%81%d1%8c-%d0%b4%d0%b0%d0%bd%d0%bd%d1%8b%d1%85-%d0%b2-%d1%81%d1%82%d1%80%d1%83%d0%ba%d1%82%d1%83%d1%80%d1%83-%d0%a1","title":"Побайтная запись данных в структуру С#","body":"<p>Есть структура данных (С#) необходимо принимая данные из SerialPort записать их в  структуру побайтно.</p>\n\n<p>Код объявления структуры (VS2010)\nСтруктура упакована побайтно, размер соответствует. </p>\n\n<p>:</p>\n\n<p>// ------------------ telemetry data structures</p>\n\n<pre><code>    [StructLayout(LayoutKind.Sequential, Pack = 1)]\n    public struct BMS //  BMS telemetry data\n    {\n        public ushort voltage;\n        public short current;\n        public sbyte temperature;\n        public byte status;\n    }\n\n    [StructLayout(LayoutKind.Sequential, Pack = 1)]\n    public struct MOTOR //  Traction MOTOR telemetry data\n    {\n        sbyte acceleration;\n        short current;\n        short speed;\n        sbyte motor_temp;\n        sbyte controller_temp;\n        byte status;\n    }\n\n    [StructLayout(LayoutKind.Sequential, Pack = 1)]\n    public struct GENERATOR //  Gasoline GENERATOR telemetry data\n    {\n        byte fuel_level;\n        short speed; \n        short current;\n        ushort voltage;\n        sbyte motor_temp;\n        sbyte generator_temp;\n        sbyte controller_temp;\n        byte status;\n    }\n\n    [StructLayout(LayoutKind.Sequential, Pack = 1)]\n    public struct CABLE_REEL //  CABLE REEL telemetry data\n    {\n        sbyte force;\n        short speed;\n        sbyte motor_temp;\n        sbyte controller_temp;\n        byte status;\n    }\n\n    [StructLayout(LayoutKind.Sequential, Pack = 1)]\n    public struct UTP_TELEMETRY // UTP-1 telemetry packet struct\n    {\n        public BMS bms1;\n        public BMS bms2;\n        public MOTOR left_motor;\n        public MOTOR right_motor;\n        public GENERATOR generator;\n        public CABLE_REEL reel;\n    }\n\n    //UTP_TELEMETRY packet;\n\n    int packet_data_len = Marshal.SizeOf(typeof(UTP_TELEMETRY));  // number of bytes for data (45 bytes at the moment)\n\n    // defines exactly as union in C++\n\n    [StructLayout(LayoutKind.Explicit, Size=45)]\n    public struct UNION_BUFF\n    {\n        [FieldOffset(0)]\n        public byte buff;\n        //public byte[] buff;\n\n        [FieldOffset(0)]\n        public UTP_TELEMETRY data_packet;\n    }\n\n   public UNION_BUFF data_buffer;\n</code></pre>\n\n<p>проект unsafe, разные способы испытал, но не знаю тонкостей работы с указателями С#, ничего не получается. пробовал запись по указателю, по индексу buff[index], еще несколько разных идей и все никак.\nКак необходимо организовать запись побайтно в данную структуру?</p>\n"}