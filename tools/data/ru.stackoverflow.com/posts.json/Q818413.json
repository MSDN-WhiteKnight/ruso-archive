{"tags":["c#","c++","dll"],"owner":{"reputation":866,"user_id":239394,"user_type":"registered","accept_rate":68,"profile_image":"https://i.stack.imgur.com/pbywC.png?s=128&g=1","display_name":"Александр Ли","link":"https://ru.stackoverflow.com/users/239394/%d0%90%d0%bb%d0%b5%d0%ba%d1%81%d0%b0%d0%bd%d0%b4%d1%80-%d0%9b%d0%b8"},"is_answered":true,"view_count":183,"accepted_answer_id":818490,"answer_count":1,"score":1,"last_activity_date":1524550413,"creation_date":1524512328,"last_edit_date":1524548115,"question_id":818413,"link":"https://ru.stackoverflow.com/questions/818413/%d0%9a%d0%b0%d0%ba-%d0%bf%d0%be%d0%b4%d0%ba%d0%bb%d1%8e%d1%87%d0%b8%d1%82%d1%8c-dllc-%d0%ba-%d1%81","title":"Как подключить dll(c++) к с#?","body":"<p>Знаю, что популярная проблема. Но нужно срочно, а я вообще не бум-бум.</p>\n\n<p>Нужно подключить вот эту функцию:</p>\n\n<pre><code>DLL_EXPORT int __stdcall EvalCRC(IStream* Data, IStream* Params, IStream* Output)\n{\n    if (!Data) return ERROR_NULL_DATA;\n\n    // Data - это входной поток с прошивкой, контрольку в которой нужно пересчитать\n    // Params и Output пока не используются и зарезервированы на будущее\n    int Result = PLUGIN_SUCCESS; // По-умолчанию возвращаем результат успешного выполнения\n\n    ULARGE_INTEGER size_;\n    LARGE_INTEGER larg_;\n\n    //ENCODE_START\n\n    larg_.QuadPart = 0;\n    Data-&gt;Seek(larg_, STREAM_SEEK_END, &amp;size_);\n\n    // Считаем КС прошивки\n    if (size_.QuadPart == VALIDFWSIZE1 || size_.QuadPart == VALIDFWSIZE2)\n    {\n        try\n        {\n            char arr[IDLEN+1];\n            ULONG ulong;\n            unsigned int caloffset;\n\n            switch(size_.QuadPart)\n            {\n                case VALIDFWSIZE1:\n                {\n                    // Калибровки\n                    larg_.QuadPart = CAL_POS1;\n                    Data-&gt;Seek(larg_ ,STREAM_SEEK_SET, &amp;size_);\n                    Data-&gt;Read(&amp;arr, sizeof(arr), &amp;ulong); // Вычитываем идентификатор\n                    arr[IDLEN]=0x00;\n\n                    if (CheckNumber(arr)) caloffset=CAL_POS1;\n                    else return ERROR_SIGNATURE;\n                }\n                break;\n                case VALIDFWSIZE2:\n                {\n                    // Фулл\n                    larg_.QuadPart = CAL_POS2;\n                    Data-&gt;Seek(larg_ ,STREAM_SEEK_SET, &amp;size_);\n                    Data-&gt;Read(&amp;arr, sizeof(arr), &amp;ulong); // Вычитываем идентификатор\n                    arr[IDLEN]=0x00;\n\n                    if (CheckNumber(arr)) caloffset=CAL_POS2;\n                    else\n                    {\n                        larg_.QuadPart = CAL_POS3;\n                        Data-&gt;Seek(larg_ ,STREAM_SEEK_SET, &amp;size_);\n                        Data-&gt;Read(&amp;arr, sizeof(arr), &amp;ulong); // Вычитываем идентификатор\n                        arr[IDLEN]=0x00;\n\n                        if (CheckNumber(arr)) caloffset=CAL_POS3;\n                        else return ERROR_SIGNATURE;\n                    }\n                }\n                break;\n            }\n\n            larg_.QuadPart = caloffset;\n            Data-&gt;Seek(larg_ ,STREAM_SEEK_SET, &amp;size_);\n            WORD wval=0;\n            for(unsigned int i=0;i&lt;(cRangeSize/2)-1;i++)\n            {\n                WORD wword;\n                Data-&gt;Read(&amp;wword, sizeof(WORD), &amp;ulong);\n                wword = (wword &gt;&gt; 8) | (wword &lt;&lt; 8); // Переворачиваем\n                if (i!=cCSPos/2) wval += wword; // Считаем все, кроме контрольных сумм\n            }\n\n            wval=0-wval;\n            larg_.QuadPart = caloffset+cCSPos;\n            Data-&gt;Seek(larg_ ,STREAM_SEEK_SET, &amp;size_);\n            wval = (wval &gt;&gt; 8) | (wval &lt;&lt; 8); // Переворачиваем\n            Data-&gt;Write(&amp;wval, sizeof(WORD), &amp;ulong);\n        }\n        catch(...)\n        {\n            Result = ERROR_EXCEPTION;\n        }\n    }\n    else Result = ERROR_INVALID_SIZE;\n\n    return Result;\n}\n</code></pre>\n\n<p>Пробовал по всякому, то типы данных не совпадают, то просто какие-то вылеты без ошибок и результатов. \nЕсли это не сложно, подскажите, как должна выглядеть строка подключения?</p>\n"}