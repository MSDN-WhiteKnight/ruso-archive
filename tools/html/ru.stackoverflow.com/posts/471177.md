---
title: "Как узнать тип стороннего приложения C#?"
---
<p><i><a href="https://github.com/MSDN-WhiteKnight/ruso-archive/">RuSO Archive</a></i></p>
<h1>Как узнать тип стороннего приложения C#?</h1>
<p><a href="https://ru.stackoverflow.com/questions/471177/%d0%9a%d0%b0%d0%ba-%d1%83%d0%b7%d0%bd%d0%b0%d1%82%d1%8c-%d1%82%d0%b8%d0%bf-%d1%81%d1%82%d0%be%d1%80%d0%be%d0%bd%d0%bd%d0%b5%d0%b3%d0%be-%d0%bf%d1%80%d0%b8%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d1%8f-c">Source</a> - by <a href="https://ru.stackoverflow.com/users/193362/imlejn">imlejn</a></p>
<blockquote>
<p>Как узнать тип стороннего приложения на C# - Консольное приложения или Windows Forms? Полез в Reflection - ничего не нашёл.</p>

<p><strong>UPD:</strong></p>

<p>Спасибо @PavelMayorov за подсказку, решение получилось таким:</p>

<pre><code>using (Stream Stream = new FileStream(@"путь к файлу",FileMode.Open))
{
    using (BinaryReader BReader = new BinaryReader(Stream))
    {
        Stream.Position = 0x3C;
        uint peHeader = BReader.ReadUInt32();
        Stream.Position = peHeader+0x5C;
        ushort machine = BReader.ReadUInt16();
        Console.WriteLine(machine);
    }
} 
</code></pre>

</blockquote>
<h2>Answer 471184</h2>
<p><a href="https://ru.stackoverflow.com/a/471184/">Source</a> - by <a href="https://ru.stackoverflow.com/users/178779/pavel-mayorov">Pavel Mayorov</a></p>
<blockquote>
<p>По смещению 0x3C от начала файла записано смещение заголовка PE (4 байта). Относительно начала PE заголовка по смещению 0x5C записан код подсистемы (2 байта). Если там 2 - это графическое приложение. Если 3 - консольное. Если что-то другое - это вообще не приложение win32.</p>

<p>Подробности можно узнать здесь: <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms680547(v=vs.85).aspx#windows_subsystem" rel="nofollow noreferrer">https://msdn.microsoft.com/en-us/library/windows/desktop/ms680547(v=vs.85).aspx#windows_subsystem</a></p>

</blockquote>
<h2>Answer 471194</h2>
<p><a href="https://ru.stackoverflow.com/a/471194/">Source</a> - by <a href="https://ru.stackoverflow.com/users/22836/4per">4per</a></p>
<blockquote>
<p>Не скажу что способ хороший, но вдруг</p>

<pre><code>    private void TestIsWindowExe()
    {
        MessageBox.Show(IsWindowExe("notepad.exe", TimeSpan.FromSeconds(10)).ToString());
        MessageBox.Show(IsWindowExe("cmd.exe", TimeSpan.FromSeconds(10)).ToString());
    }

    /// &lt;summary&gt;
    /// Проверка исполняемого файла, является ли он оконным
    /// &lt;/summary&gt;
    /// &lt;param name="exepath"&gt;путь к исполняемому файлу&lt;/param&gt;
    /// &lt;param name="timeout"&gt;время ожидания загрузки программы&lt;/param&gt;
    /// &lt;returns&gt;Является ли оконным&lt;/returns&gt;
    private bool IsWindowExe(string exepath, TimeSpan timeout)
    {
        var process = new System.Diagnostics.Process();
        var startInfo = new System.Diagnostics.ProcessStartInfo();
        startInfo.FileName = exepath;            
        process.StartInfo = startInfo;
        process.Start();
        bool iswindow;
        try
        {               
            if (process.WaitForInputIdle(Convert.ToInt32(timeout.TotalMilliseconds)))
               iswindow = true;
            else
               throw new TimeoutException("Превышен таймаут ожидания загрузки процесса");
        }
        catch (InvalidOperationException ex)
        {
            iswindow = false;
        }
        process.Kill();
        return iswindow;
    }
</code></pre>

</blockquote>
<h2>Answer 765851</h2>
<p><a href="https://ru.stackoverflow.com/a/765851/">Source</a> - by <a href="https://ru.stackoverflow.com/users/240512/msdn-whiteknight">MSDN.WhiteKnight</a></p>
<blockquote>
<p>Можно использовать функцию <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/bb762179%28v=vs.85%29.aspx?f=255&amp;MSPPError=-2147217396" rel="nofollow noreferrer">SHGetFileInfo</a> с параметром SHGFI_EXETYPE:</p>

<pre><code>public const uint SHGFI_EXETYPE = 0x000002000;

[DllImport("shell32.dll", CharSet = CharSet.Auto)]
public static extern int SHGetFileInfo(string pszPath, uint dwFileAttributes, IntPtr psfi, 
        uint cbFileInfo, uint uFlags);

public static void PrintExeType(string file)
{            
        int res = SHGetFileInfo(file, 0, IntPtr.Zero, 0, SHGFI_EXETYPE);

        int lowWord = res &amp; 0xffff;
        int hiWord = res &gt;&gt; 16;

        if (res != 0)
        {
            if (hiWord == 0x0000 &amp;&amp; lowWord == 0x5a4d /*MZ*/) 
            {
                MessageBox.Show("DOS application");
            }
            else if (hiWord == 0x0000 &amp;&amp; lowWord == 0x4550 /*PE*/)
            {
                MessageBox.Show("Console application");
            }
            else if ((hiWord != 0x0000) &amp;&amp; (lowWord == 0x454E/*NE*/ || lowWord == 0x4550 /*PE*/))
            {
                MessageBox.Show("GUI application");
            }
            else MessageBox.Show("Unknown");
        }
        else MessageBox.Show("Not executable");            
}
</code></pre>

</blockquote>
<hr/>
<p><i>Content is retrieved from StackExchange API. </i></p>
<p><i>Auto-generated by ruso-archive tools. </i></p>
