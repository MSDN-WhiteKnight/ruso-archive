---
title: "Post 763170"
---
<p><i><a href="https://github.com/MSDN-WhiteKnight/ruso-archive/">RuSO Archive</a></i></p>
<h1>Post 763170</h1>
<h2>Answer 763170</h2>
<p><a href="https://ru.stackoverflow.com/a/763170/">Source</a> - by <a href="https://ru.stackoverflow.com/users/240512/msdn-whiteknight">MSDN.WhiteKnight</a></p>
<blockquote>
<blockquote>
  <p>На более мощном ПК не работает, на стареньком все отрабатывает</p>
</blockquote>

<p>Если проблема проявляется только на отдельных машинах, вам нужно смотреть, что отличается на проблемной машине в конфигурации DirectShow. Видимо какой-то кодек вызывает проблему, генерируя поток неподходящего формата. AForge использует DirectShow, беглый просмотр исходников <a href="https://github.com/cureos/aforge/blob/master/Sources/Video.DirectShow/FileVideoSource.cs" rel="nofollow noreferrer">FileVideoSource</a> показывает следующую методику построения графа:</p>

<ul>
<li><p>Автоматически вставляется выбранный системой source filter (через <code>AddSourceFilter</code>)</p></li>
<li><p>Создается Sample Grabber, настроенный на формат видео <code>MediaSubType.RGB24</code></p></li>
<li><p>Sample Grabber подцепляется к первому найденному видео-выходу source filter</p></li>
</ul>

<p>Слабое место в этой схеме - явное указание <code>MediaSubType</code>. Насколько я знаю, если в видеопотоке SubType будет несовместимым с RGB24 (например YUY2), ошибки не выведется, но событие нового кадра никогда не вызовется. Поэтому работоспособность этого класса полностью зависит от того, какой формат будет генерировать декодер видео для конкретного файла на целевой машине.</p>

<p>Вы можете попробовать следующее:</p>

<ul>
<li><p>Распространять вместе с программой кодеки, которые гарантированно выдают формат RGB для выходного потока видео, и настраивать их так, чтобы они автоматически выбирались системой (имели наивысший приоритет).</p></li>
<li><p>Вместо иcпользования AForge, напрямую использовать DirectShow.NET (или модифицировать AForge, пользуясь тем, что это Open Source), и исправить данный недостаток. Нужно при вызове <code>SetMediaType</code> вместо явного SubType указывать нулевой GUID - тогда Sample Grabber будет принимать все форматы. И, соответственно, нужно предусмотреть преобразование из других форматов в RGB.</p></li>
</ul>

</blockquote>
<hr/>
<p><i>Content is retrieved from StackExchange API. </i></p>
<p><i>Auto-generated by ruso-archive tools. </i></p>
