---
title: "Как правильно задать строку подключения к БД"
---
<p><i><a href="https://github.com/MSDN-WhiteKnight/ruso-archive/">RuSO Archive</a></i></p>
<h1>Как правильно задать строку подключения к БД</h1>
<p><a href="https://ru.stackoverflow.com/questions/776652/%d0%9a%d0%b0%d0%ba-%d0%bf%d1%80%d0%b0%d0%b2%d0%b8%d0%bb%d1%8c%d0%bd%d0%be-%d0%b7%d0%b0%d0%b4%d0%b0%d1%82%d1%8c-%d1%81%d1%82%d1%80%d0%be%d0%ba%d1%83-%d0%bf%d0%be%d0%b4%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d1%8f-%d0%ba-%d0%91%d0%94">Source</a> - by <a href="https://ru.stackoverflow.com/users/282842/cuurjol">Cuurjol</a></p>
<blockquote>
<p>Как правильно задать строку подключения к локальной БД так, чтобы каждый раз вручную не менять путь?</p>

<p>Есть такая строка подключения:</p>

<pre><code>&lt;connectionStrings&gt;
&lt;add name="LibraryModelContainer" connectionString="metadata=res://*/LibraryModel.csdl|res://*/LibraryModel.ssdl|res://*/LibraryModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=(LocalDB)\MSSQLLocalDB;attachdbfilename=|DataDirectory|\LibrarySystem.mdf;integrated security=True;connect timeout=30;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;" providerName="System.Data.EntityClient" /&gt;
&lt;/connectionStrings&gt;
</code></pre>

<p>Строка подключения была создана автоматически. Если запускать мой проект с такой вот строкой подключения, то возникает исключение в программе:</p>

<p>Внутреннее исключение 1:
SqlException: An attempt to attach an auto-named database for file C:\Users\Cuurjol\Desktop\123\BACKUP LIBRARY\Library\Library\bin\Debug\LibrarySystem.mdf failed. A database with the same name exists, or specified file cannot be opened, or it is located on UNC share.</p>

<p>Я в интернете долго искал решение этой проблемы, нашёл, нужно вместо attachdbfilename=|DataDirectory|\LibrarySystem.mdf писать целиком весь путь к файлу, ну например так:</p>

<pre><code>attachdbfilename=C:\Users\Cuurjol\Desktop\123\BACKUP LIBRARY\Library\Library\LibrarySystem.mdf
</code></pre>

<p>Но я так не хочу писать путь, поскольку папка с проектом может быть располагаться где угодно, а мне нужно как-то в App.config написать так, чтобы всегда было подключение к БД вне зависимости от расположения самого проекта на жёстком диске.</p>

<p>Как это можно сделать? И почему всё-таки сгенерированная строка подключения к БД не работает при запуске проекта?</p>

</blockquote>
<h2>Answer 777174</h2>
<p><a href="https://ru.stackoverflow.com/a/777174/">Source</a> - by <a href="https://ru.stackoverflow.com/users/240512/msdn-whiteknight">MSDN.WhiteKnight</a></p>
<blockquote>
<p>Задать относительный путь к БД с помощью подстановочной переменной |DataDirectory|, конечно, можно. Ее значение зависит от типа проекта:</p>

<ul>
<li>Для обычного настольного приложения - путь к папке с EXE-файлом</li>
<li>Для приложения ClickOnce - путь к специальной папке данных</li>
<li>Для ASP.NET приложений - путь к папке App_Data</li>
</ul>

<p>Можно переопределить значение в коде:</p>

<pre><code>AppDomain.CurrentDomain.SetData("DataDirectory", newpath)
</code></pre>

<p>См. <a href="https://blogs.msdn.microsoft.com/smartclientdata/2005/08/26/working-with-local-databases/" rel="nofollow noreferrer">данную статью</a>, <a href="https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/ef/connection-strings" rel="nofollow noreferrer">документацию</a>.</p>

<p>Что касается ошибки <em>An attempt to attach an auto-named database for file ... failed.</em>, у нее может быть много причин. Файл не существует, у учетной записи службы SQL не хватает прав, чтобы его открыть, БД с таким именем уже существует и т.п. Обычно использовать свойство <code>AttachDbFileName</code>, тем более с автогенерированным именем БД - не лучшая практика. Лучше создать программу или скрипт развертывания, который будет однократно присоединять БД с явно заданным именем, а в программе задать свойство <code>Initial Catalog</code>. Так будет куда проще обслуживать программу.</p>

</blockquote>
<hr/>
<p><i>Content is retrieved from StackExchange API. </i></p>
<p><i>Auto-generated by ruso-archive tools. </i></p>
