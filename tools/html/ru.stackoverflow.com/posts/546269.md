---
title: "Магия шрифтов по умолчанию в WPF"
---
<p><i><a href="https://github.com/MSDN-WhiteKnight/ruso-archive/">RuSO Archive</a></i></p>
<h1>Магия шрифтов по умолчанию в WPF</h1>
<p><a href="https://ru.stackoverflow.com/questions/546269/%d0%9c%d0%b0%d0%b3%d0%b8%d1%8f-%d1%88%d1%80%d0%b8%d1%84%d1%82%d0%be%d0%b2-%d0%bf%d0%be-%d1%83%d0%bc%d0%be%d0%bb%d1%87%d0%b0%d0%bd%d0%b8%d1%8e-%d0%b2-wpf">Source</a> - by <a href="https://ru.stackoverflow.com/users/214629/vitaliy">Vitaliy</a></p>
<blockquote>
<p>Я заметил, что если при создании шрифта указать пустую строку, то используется шрифт <code>Arial</code>, но он почему-то отрисовывается на несколько пикселей выше, чем <code>Arial</code>, хотя <code>Baseline</code> у них одинаковый и равен 0,921630859375. (VS2015, Windows 10)
С чем это может быть связано и как исправить такое поведение?</p>

<pre><code>textBlock1.FontFamily = new FontFamily("Arial"); // Red,   Baseline = 0,921630859375
textBlock2.FontFamily = new FontFamily("");      // Green, Baseline = 0,921630859375
</code></pre>

<p><a href="https://i.stack.imgur.com/6Aikn.png" rel="noreferrer"><img src="https://i.stack.imgur.com/6Aikn.png" alt="Шрифт &quot;Arial&quot; и &quot;&quot;"></a></p>

<p>Также заметил, что если при создании шрифта указать несуществующий шрифт, то используется уже шрифт <code>Segoe UI</code> и отрисовывается уже прилично выше, чем <code>Segoe UI</code>. Причиной тому скорей всего отличия в <code>Baseline</code>.
Почему <code>Baseline</code> отличаются? Как его можно задать вручную?</p>

<pre><code>textBlock1.FontFamily = new FontFamily("Segoe UI");     // Red,   Baseline = 1,0791015625
textBlock2.FontFamily = new FontFamily("non-existent"); // Green, Baseline = 0,921630859375
</code></pre>

<p>или то же самое в XAML</p>

<pre><code>&lt;Grid&gt;
    &lt;TextBlock Text="Hello World"
               FontSize="160"
               FontFamily="Segoe UI"
               Foreground="Red" /&gt;
    &lt;TextBlock Text="Hello World"
               FontSize="160"
               FontFamily="non-existent"
               Foreground="Green" /&gt;
&lt;/Grid&gt;
</code></pre>

<p><a href="https://i.stack.imgur.com/TDajp.png" rel="noreferrer"><img src="https://i.stack.imgur.com/TDajp.png" alt="Шрифт &quot;Segoe UI&quot; и &quot;non-existent&quot;"></a></p>

</blockquote>
<h2>Answer 702282</h2>
<p><a href="https://ru.stackoverflow.com/a/702282/">Source</a> - by <a href="https://ru.stackoverflow.com/users/240512/msdn-whiteknight">MSDN.WhiteKnight</a></p>
<blockquote>
<p>В WPF существует механизм автоматического замещения (fallback) шрифтов. (См. <a href="https://msdn.microsoft.com/en-us/library/system.windows.media.fontfamily.aspx" rel="noreferrer">MSDN: FontFamily</a>.) Если указанный физический шрифт не удается найти на целевой системе, вместо него используется составной (composite) шрифт Global User Interface. По сути это XML-файл, который содержит параметры шрифта (в т.ч. и Baseline) и сопоставления диапазонов символов физическим шрифтам. Этот файл лежит в</p>

<blockquote>
  <p>%WINDIR%\MICROSOFT.NET\Framework\версия\WPF\Fonts\GlobalUserInterface.COMPOSITEFONT</p>
</blockquote>

<p>Диапазону символов 0000-052F (куда и входят английские буквы) в нем сопоставлены следующие шрифты: </p>

<blockquote>
  <p>Segoe UI, Tahoma, Arial, Simplified Arabic, Traditional Arabic, Arial
  Unicode MS, Microsoft Sans Serif, Lucida Sans Unicode</p>
</blockquote>

<p>Параметры шрифта по умолчанию следующие:</p>

<p><strong>Baseline:</strong> 0.9</p>

<p><strong>Line spacing:</strong> 1.2</p>

<p>Таким образом, как Segoe UI, так и Arial могут, в зависимости от ситуации, замещать не найденные шрифты (при этом вид будет отличаться от соответствующих "нормальных" шрифтов, из-за отличающихся LineSpacing и BaseLine). При указании пустой строки вместо шрифта используется Arial, поскольку он прописан как NullFontFamilyCanonicalName в коде модуля <a href="http://referencesource.microsoft.com/#PresentationCore/Core/CSharp/System/Windows/Media/FontFamily.cs,d652308aa7fc6dd3" rel="noreferrer">FontFamily.cs</a>:</p>

<pre><code>internal static readonly CanonicalFontFamilyReference NullFontFamilyCanonicalName = CanonicalFontFamilyReference.Create(null, "#ARIAL"); 
</code></pre>

<p>При указании несуществующего шрифта используется Segoe UI, так как он является шрифтом по умолчанию для GUI в Windows Vista и всех более поздних ОC. См. <a href="https://blog.davidpadbury.com/2008/08/30/change-the-default-font-of-a-wpf-application/" rel="noreferrer">Change the Default Font of a WPF Application</a>.</p>

<p>Если вас не устраивают параметры Composite Font по умолчанию, можно отредактировать XML-файл (там несколько секций, надо брать соответствующую вашей ОС). Но лучше, я полагаю, этого не делать, и просто не ошибаться в шрифтах.</p>

</blockquote>
<hr/>
<p><i>Content is retrieved from StackExchange API. </i></p>
<p><i>Auto-generated by ruso-archive tools. </i></p>
