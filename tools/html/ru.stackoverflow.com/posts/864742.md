---
title: "Почему разнятся значения Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData) в разных приложениях?"
---
<p><i><a href="https://github.com/MSDN-WhiteKnight/ruso-archive/">RuSO Archive</a></i></p>
<h1>Почему разнятся значения Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData) в разных приложениях?</h1>
<p><a href="https://ru.stackoverflow.com/questions/864742/%d0%9f%d0%be%d1%87%d0%b5%d0%bc%d1%83-%d1%80%d0%b0%d0%b7%d0%bd%d1%8f%d1%82%d1%81%d1%8f-%d0%b7%d0%bd%d0%b0%d1%87%d0%b5%d0%bd%d0%b8%d1%8f-environment-getfolderpathenvironment-specialfolder-app">Source</a> - by <a href="https://ru.stackoverflow.com/users/289076/oleg-lylok">Oleg Lylok</a></p>
<blockquote>
<p>Я пишу сервис, где мне необходимо получить папку AppData\Roaming. Пользуюсь следующей конструкцией <code>Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);</code>
Но получаю следующее значение: <code>C:\WINDOWS\system32\config\systemprofile\AppData\Roaming\</code>
Но если я запускаю консольное приложение и проделываю все тоже самое - получаю правильный результат. Может кто-нибудь, пожалуйста, объяснить в чем дело. Бьюсь несколько часов над проблемой и не могу никак решить.</p>

</blockquote>
<h2>Answer 865353</h2>
<p><a href="https://ru.stackoverflow.com/a/865353/">Source</a> - by <a href="https://ru.stackoverflow.com/users/240512/msdn-whiteknight">MSDN.WhiteKnight</a></p>
<blockquote>
<p><code>C:\WINDOWS\system32\config\systemprofile</code> - это путь к профилю для пользователя SYSTEM. Если вам нужен профиль другого пользователя, запускайте сервис от его имени, или найдите путь для конкретного пользователя (у SYSTEM для этого достаточно прав). Это можно сделать как-то так:</p>

<ol>
<li><p>Получить токен пользователя через <a href="https://msdn.microsoft.com/a6d880a0-0aed-4bdb-89c9-4f667ecb510e" rel="nofollow noreferrer">LogonUser</a></p></li>
<li><p>Загрузить его профиль через <a href="https://docs.microsoft.com/ru-ru/windows/desktop/api/userenv/nf-userenv-loaduserprofilew" rel="nofollow noreferrer">LoadUserProfile</a></p></li>
<li><p>Получить путь к нужной папке с помощью <a href="https://docs.microsoft.com/ru-ru/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetknownfolderpath" rel="nofollow noreferrer">SHGetKnownFolderPath</a>, передав ей полученный токен</p></li>
</ol>

</blockquote>
<hr/>
<p><i>Content is retrieved from StackExchange API. </i></p>
<p><i>Auto-generated by ruso-archive tools. </i></p>
