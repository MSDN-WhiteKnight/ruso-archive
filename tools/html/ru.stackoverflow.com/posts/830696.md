---
title: "Post 830696"
---
<p><i><a href="https://github.com/MSDN-WhiteKnight/ruso-archive/">RuSO Archive</a></i></p>
<h1>Post 830696</h1>
<h2>Answer 830696</h2>
<p><a href="https://ru.stackoverflow.com/a/830696/">Source</a> - by <a href="https://ru.stackoverflow.com/users/240512/msdn-whiteknight">MSDN.WhiteKnight</a></p>
<blockquote>
<p>Добавьте ссылку на System.Management и используйте WMI-запрос к классу <em>Win32_NetworkAdapter</em>, у реальных интерфейсов должно быть <em>PhysicalAdapter=true</em>. Для получения Guid интерфейса можно использовать <code>NetworkInterface.GetAllNetworkInterfaces()</code>. Как-то так:</p>

<pre><code>using System.Net;
using System.Net.Sockets;
using System.Net.NetworkInformation;
using System.Management;

...

//Определяет, является ли адаптер физическим
public static bool IsAdapterPhysical(string guid)
{
    ManagementObjectCollection mbsList = null;            

    ManagementObjectSearcher mbs = new ManagementObjectSearcher(
    "SELECT PhysicalAdapter FROM Win32_NetworkAdapter WHERE GUID = '" + guid + "'"
    );
    bool res = false;

    using (mbs)
    {
        mbsList = mbs.Get();

        foreach (ManagementObject mo in mbsList)
        {                  
            foreach (var p in mo.Properties)
            {                        
                if (p.Value != null)
                {
                    res = (bool)p.Value;
                    break;
                }
                else res = false;                        
            }                    
        }
        return res;
    }

}

//Получает все локальные IP-адреса
public static List&lt;IPAddress&gt; GetIpAddresses()
{
    List&lt;IPAddress&gt; res = new List&lt;IPAddress&gt;(10);

    var ifs = NetworkInterface.GetAllNetworkInterfaces();

    foreach (var interf in ifs)
    {
        var ipprop=interf.GetIPProperties();
        if (ipprop == null) continue;
        var unicast = ipprop.UnicastAddresses;
        if (unicast == null) continue;

        if (IsAdapterPhysical(interf.Id.ToString()))
        {
            //находим первый Unicast-адрес
            foreach (var addr in unicast)
            {
                if (addr.Address.AddressFamily != AddressFamily.InterNetwork) continue;
                res.Add(addr.Address);
                break;
            }
        }
    }

    return res;
}
</code></pre>

</blockquote>
<hr/>
<p><i>Content is retrieved from StackExchange API. </i></p>
<p><i>Auto-generated by ruso-archive tools. </i></p>
