---
title: "Команда подключения к MS SQL"
---
<p><i><a href="https://github.com/MSDN-WhiteKnight/ruso-archive/">RuSO Archive</a></i></p>
<h1>Команда подключения к MS SQL</h1>
<p><a href="https://ru.stackoverflow.com/questions/964230/%d0%9a%d0%be%d0%bc%d0%b0%d0%bd%d0%b4%d0%b0-%d0%bf%d0%be%d0%b4%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d1%8f-%d0%ba-ms-sql">Source</a> - by <a href="https://ru.stackoverflow.com/users/22253/sergd29">SergD29</a></p>
<blockquote>
<p>Глупый вопрос ну все же, пытаюсь в приложении подключиться к экземпляру SQL Express</p>

<pre><code>"Data Source=.\\SQLEXPRESS; Initial Catalog=SiteASAM; Integrated Security=True;";
</code></pre>

<p><strong>работает</strong>, переношу ПО на другой компьютер и пытаюсь подключиться к похожему экземпляру MSSQL Express уже <strong>не работает</strong>, меняю на эту строку снова <strong>работает</strong></p>

<pre><code>"Data Source=localhost; Initial Catalog=SiteASAM; Integrated Security=True;";
</code></pre>

<p>возвращаюсь обратно на первый ПК с этой строкой, <strong>не работает</strong>, меняю обратно на  </p>

<pre><code>"Data Source=.\\SQLEXPRESS; Initial Catalog=SiteASAM; Integrated Security=True;";
</code></pre>

<p><strong>работает</strong>, ЕСТЬ УНИВЕРСАЛЬНЫЙ СПОСОБ ПОДКЛЮЧЕНИЯ К ЭКЗЕМПЛЯРУ SQL Server Express</p>

</blockquote>
<h2>Answer 964375</h2>
<p><a href="https://ru.stackoverflow.com/a/964375/">Source</a> - by <a href="https://ru.stackoverflow.com/users/183614/%d0%93%d0%b5%d1%80%d0%bc%d0%b0%d0%bd-%d0%91%d0%be%d1%80%d0%b8%d1%81%d0%be%d0%b2">Герман Борисов</a></p>
<blockquote>
<p>Замечал, что при установке MS SQL Server'а имя экземпляра различается на разных машинах. В моем случае на одной это было "SQLEXPRESS.1"</p>

<p>Подозреваю, что имена всех экземпляров можно найти в реестре и вывести при старте программы окно выбора. Если экземпляр один, то можно сразу использовать его.</p>

<p>В какой конкретно ветке реестра - не знаю. Вероятнее всего внутри <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft</code>. Можно поискать строку SQLEXPRESS или изучить документацию.</p>

<p>UPD.</p>

<p>Несколько способов перечислены на английском SO: <a href="https://stackoverflow.com/questions/141154/how-can-i-determine-installed-sql-server-instances-and-their-versions">https://stackoverflow.com/questions/141154/how-can-i-determine-installed-sql-server-instances-and-their-versions</a></p>

</blockquote>
<h2>Answer 964542</h2>
<p><a href="https://ru.stackoverflow.com/a/964542/">Source</a> - by <a href="https://ru.stackoverflow.com/users/240512/msdn-whiteknight">MSDN.WhiteKnight</a></p>
<blockquote>
<p>Как вариант, использовать WMI. Каждый экземпляр имеет свою службу с именем вида <code>MSSQL$&lt;instance&gt;</code> для именованных экземпляров или <code>MSSQLSERVER</code> для экземпляра по умолчанию (Документировано здесь: <a href="https://docs.microsoft.com/ru-ru/sql/database-engine/configure-windows/manage-the-database-engine-services?view=sql-server-2017#using-the-sql-server-service" rel="nofollow noreferrer">Использование службы SQL Server</a>). Это приводит нас к такому коду для получения имени экземпляра:</p>

<pre><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Management;
//Reference: System.Management

public static IEnumerable&lt;string&gt; GetSqlServers()
{
    var mos = new ManagementObjectSearcher(
        "SELECT Name FROM Win32_Service WHERE Name LIKE 'MSSQL$%' OR Name='MSSQLSERVER'");
    using (mos)
    {
        var moc = mos.Get();
        using (moc)
        {
            foreach (ManagementObject mo in moc)
            {
                string res = mo.Properties["Name"].Value as string;
                if (res == null) continue;

                int index = res.IndexOf('$');
                if (index &lt; 0) yield return "";
                else yield return res.Substring(index + 1);
            }
        }
    }
}

//...

string DataSource = ".\\" + GetSqlServers().First();
</code></pre>

</blockquote>
<hr/>
<p><i>Content is retrieved from StackExchange API. </i></p>
<p><i>Auto-generated by ruso-archive tools. </i></p>
